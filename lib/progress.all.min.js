!function(){var e=!1,t=!1;function r(){this._data={}}if(r.prototype.setItem=function(e,t){return this._data[e]=String(t)},r.prototype.getItem=function(e){return this._data.hasOwnProperty(e)?this._data[e]:void 0},r.prototype.removeItem=function(e){return delete this._data[e]},r.prototype.clear=function(){return this._data={}},"undefined"==typeof XMLHttpRequest){t=!0;try{XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest}catch(e){console.error("Error: JSDO library requires XMLHttpRequest object in Node.js.\nPlease install xmlhttprequest package.")}}if(!t&&("undefined"==typeof localStorage||"undefined"==typeof sessionStorage))try{require("file-system/file-system-access"),e=!0}catch(t){e=!1}if(e){try{"undefined"==typeof sessionStorage&&(sessionStorage=require("nativescript-localstorage")),"undefined"==typeof localStorage&&(localStorage=require("nativescript-localstorage"))}catch(e){console.error("Error: JSDO library requires localStorage and sessionStorage objects in NativeScript.\nPlease install nativescript-localstorage package.")}try{"undefined"==typeof btoa&&(btoa=require("base-64").encode)}catch(e){console.error("Error: JSDO library requires btoa() function in NativeScript.\nPlease install base-64 package.")}}if(t){"undefined"==typeof localStorage&&(localStorage=new r),"undefined"==typeof sessionStorage&&(sessionStorage=new r);try{"undefined"==typeof btoa&&(btoa=require("base-64").encode)}catch(e){console.error("Error: JSDO library requires btoa() function in Node.js.\nPlease install base-64 package.")}}}(),function(){"undefined"==typeof progress&&(progress={}),void 0===progress.data&&(progress.data={}),progress.util={};progress.util.Deferred=function(){function e(){this._deferred={}}return e.prototype.promise=function(){var e=this;if(progress.util.Deferred.useJQueryPromises){if("undefined"==typeof $||"function"!=typeof $.Deferred)throw new Error("JQuery Promises not found in environment.");this._deferred._jQuerydeferred=$.Deferred(),this._promise=this._deferred._jQuerydeferred.promise()}else this._promise=new Promise(function(t,r){e._deferred.resolve=t,e._deferred.reject=r});return(this._resolveArguments||this._rejectArguments)&&setTimeout(function(){e._resolveArguments?e.resolve.apply(e,e._resolveArguments):e._rejectArguments&&e.reject.apply(e,e._rejectArguments)},500),this._promise},e.prototype.resolve=function(e,t,r){if(this._promise)if(this._deferred._jQuerydeferred)this._deferred._jQuerydeferred.resolve.apply(this,arguments);else{var s=progress.util.Deferred.getParamObject1(e,t,r);this._deferred.resolve(s)}else this._resolveArguments=arguments},e.prototype.reject=function(e,t,r){if(this._promise)if(this._deferred._jQuerydeferred)this._deferred._jQuerydeferred.reject.apply(this,arguments);else{var s=progress.util.Deferred.getParamObject1(e,t,r);this._deferred.reject(s)}else this._rejectArguments=arguments},e.useJQueryPromises=!1,e.when=function(e){return progress.util.Deferred.useJQueryPromises?$.when.apply($,e):Promise.all(e)},e.getParamObject1=function(e,t,r){var s,o={};try{if(null==e)o.result=t,o.info=r;else{switch((s=e.constructor.name.toLowerCase())||(s=typeof e),s){case"authenticationprovider":s="provider";break;case"number":s="result"}o[s]=e,"jsdo"===s?(o.success=t,r&&r.xhr?o.request=r:o.info=r):"result"===s?(o.info=t,r&&(o.info2=r)):(o.result=t,o.info=r)}}catch(e){console.log("Error: Undetermined argument in getParamObject() call.")}return o},e.getParamObject=function(e,t,r){var s={};return progress.util.Deferred.useJQueryPromises?s=progress.util.Deferred.getParamObject1(e,t,r):(void 0===e&&(s.result=t,s.info=r,e=s),e)},e}(),progress.util.Observable=function(){function e(e,t,r,s){return e.filter(function(e){if(e.fn!==t||e.scope!==r||e.operation!==s)return e},this)}this.validateSubscribe=function(e,t,r){if(e.length>=2&&"string"==typeof e[0]&&"string"==typeof e[1])r.operation=e[1],r.fn=e[2],r.scope=e[3];else{if(!(e.length>=2&&"string"==typeof e[0]&&"function"==typeof e[1]))throw new Error;r.operation=void 0,r.scope=e[2],r.fn=e[1]}},this.subscribe=function(t,r,s,o){var i,a;if(!t)throw new Error(progress.data._getMsgText("jsdoMSG037",this.toString(),"subscribe"));if("string"!=typeof t)throw new Error(progress.data._getMsgText("jsdoMSG033",this.toString(),"subscribe",progress.data._getMsgText("jsdoMSG039")));this._events=this._events||{},t=t.toLowerCase(),i={fn:void 0,scope:void 0,operation:void 0};try{this.validateSubscribe(arguments,t,i)}catch(e){throw new Error(progress.data._getMsgText("jsdoMSG033",this.toString(),"subscribe",e.message))}return(a=e(a=this._events[t]||[],i.fn,i.scope,i.operation)).push(i),this._events[t]=a,this},this.unsubscribe=function(t,r,s,o){var i,a;if(!t)throw new Error(progress.data._getMsgText("jsdoMSG037",this.toString(),"unsubscribe"));if("string"!=typeof t)throw new Error(progress.data._getMsgText("jsdoMSG033",this.toString(),"unsubscribe",progress.data._getMsgText("jsdoMSG037")));this._events=this._events||{},t=t.toLowerCase(),i={fn:void 0,scope:void 0,operation:void 0};try{this.validateSubscribe(arguments,t,i)}catch(e){throw new Error(progress.data._getMsgText("jsdoMSG033",this.toString(),"unsubscribe",e.message))}return(a=this._events[t]||[]).length>0&&(this._events[t]=e(a,i.fn,i.scope,i.operation)),this},this.trigger=function(e,t,r){var s,o;if(!e)throw new Error(progress.data._getMsgText("jsdoMSG037",this.toString(),"trigger"));if(this._events=this._events||{},e=e.toLowerCase(),(s=this._events[e]||[]).length>0){if(r=Array.prototype.slice.call(arguments),arguments.length>=2&&"string"==typeof e&&"string"==typeof t)o=t,r=r.length>2?r.slice(2):[];else{if(!(arguments.length>=1&&"string"==typeof e))throw new Error(progress.data._getMsgText("jsdoMSG033",this.toString(),"trigger"));o=void 0,r=r.length>1?r.slice(1):[]}s.forEach(function(e){e.operation===o&&e.fn.apply(e.scope,r)})}return this},this.unsubscribeAll=function(e,t){return e?(this._events=this._events||{},"string"==typeof e&&(e=e.toLowerCase(),(this._events[e]||[]).forEach(function(t){t.operation?this.unsubscribe(e,t.operation,t.fn,t.scope):this.unsubscribe(e,t.fn,t.scope)},this))):this._events={},this}},progress.data.LocalStorage=function(){if("undefined"==typeof localStorage)throw new Error(progress.data._getMsgText("jsdoMSG126","progress.data.LocalStorage","localStorage"));this.saveToLocalStorage=function(e,t){localStorage.setItem(e,JSON.stringify(t))},this.readFromLocalStorage=function(e){var t=localStorage.getItem(e),r=null;if(null!==t)try{r=JSON.parse(t)}catch(e){r=null}return r},this.clearLocalStorage=function(e){localStorage.removeItem(e)}},progress.util._convertToABLWhereString=function(e,t){var r,s,o,i,a,n,d,h,l,c=[],f=t.logic||"and",u=t.filters||[t],_={eq:"=",neq:"<>",gt:">",gte:">=",lt:"<",lte:"<=",contains:"INDEX",doesnotcontain:"INDEX",endswith:"R-INDEX",startswith:"BEGINS",isnull:"ISNULL",isnotnull:"ISNOTNULL",isempty:"ISEMPTY",isnotempty:"ISNOTEMPTY"};for(r=0,s=u.length;r<s;r+=1){if(o=(t=u[r]).field,h=t.value,t.filters)t=progress.util._convertToABLWhereString(e,t);else{if(o&&e._name&&(i=e._jsdo[e._name]._fields[o.toLowerCase()])&&i.origName&&(o=i.origName),void 0===(d=_[t.operator]))throw new Error("The operator "+t.operator+" is not valid.");switch(t.operator){case"isnull":case"isnotnull":case"isempty":case"isnotempty":h=void 0}if(d&&void 0!==h){if("String"===(a=progress.util._getObjectType(h))?(n="'{1}'",h=h.replace(/'/g,"~'")):n="Date"===a?"DATE"===(l=e._getABLType(o))?"DATE({1:MM, dd, yyyy})":"DATETIME-TZ"===l?"DATETIME-TZ({1:MM, dd, yyyy, hh, mm, ss, fff, zzz})":"DATETIME({1:MM, dd, yyyy, hh, mm, ss, fff})":"{1}","INDEX"===d||"R-INDEX"===d){if("String"!==a)throw new Error("Error parsing filter object. The operator "+t.operator+" requires a string value");n="doesnotcontain"===t.operator?"{0}({2}, "+n+") = 0":"contains"===t.operator?"{0}({2}, "+n+") > 0":"{2} MATCHES '*{1}'"}else n="{2} {0} "+n;t=progress.util._format(n,d,h,o)}else if(d&&void 0===h){if("isempty"===t.operator||"isnotempty"===t.operator){if("CHARACTER"!==(l=e._getABLType(o)))throw new Error("Error parsing filter object. The operator "+t.operator+" requires a CHARACTER field");"isempty"===t.operator?n="{2} = ''":"isnotempty"===t.operator&&(n="{2} <> ''")}else n="isnull"===t.operator?"{2} = ?":"isnotnull"===t.operator?"{2} <> ?":"{2} {0} ?";t=progress.util._format(n,d,h,o)}}c.push(t)}return t=c.join(" "+f+" "),c.length>1&&(t="("+t+")"),t},progress.util._convertToSQLQueryString=function(e,t,r){var s,o,i,a,n,d,h,l,c,f=[],u=t.logic||"and",_=t.filters||[t],g=!0,p={eq:"=",neq:"!=",gt:">",gte:">=",lt:"<",lte:"<=",contains:"LIKE",doesnotcontain:"NOT LIKE",endswith:"LIKE",startswith:"LIKE",isnull:"ISNULL",isnotnull:"ISNOTNULL",isempty:"ISEMPTY",isnotempty:"ISNOTEMPTY"};for(void 0===r&&(r=!1),s=0,o=_.length;s<o;s+=1){if(i=(t=_[s]).field,h=t.value,t.filters)c=progress.util._convertToSQLQueryString(e,t,!1);else{if(void 0===(d=p[t.operator]))throw new Error("The operator "+t.operator+" is not valid.");switch(t.operator){case"isnull":case"isnotnull":case"isempty":case"isnotempty":h=void 0}if(d&&void 0!==h){if(a=progress.util._getObjectType(h),("LIKE"===d||"NOT LIKE"===d)&&"String"!==a)throw new Error("Error parsing filter object. The operator "+t.operator+" requires a string value");"String"===a?(n="'{1}'",h=h.replace(/'/g,"''")):"Date"===a?"date"===(l=e._getFormat(i))?n="'{1:yyyy-MM-dd}'":"date-time"===l?n="{1:#ISO(iso)}":"time"===l&&(n="'{1:FFF}'"):n="{1}","startswith"===t.operator?n="'{1}%'":"endswith"===t.operator?n="'%{1}'":"contains"===t.operator||"doesnotcontain"===t.operator?n="'%{1}%'":g=!1,g&&(h=(h=h.replace(/%/g,"\\%")).replace(/_/g,"\\_")),n="{2} {0} "+n,c=progress.util._format(n,d,h,i)}else if(d&&void 0===h){if("isempty"===t.operator||"isnotempty"===t.operator){if((a=e._fields[i.toLowerCase()].type)!=="String".toLowerCase())throw new Error("Error parsing filter object. The operator "+t.operator+" requires a string field");"isempty"===t.operator?n="{2} = ''":"isnotempty"===t.operator&&(n="{2} != ''")}else n="isnull"===t.operator?"{2} IS NULL":"isnotnull"===t.operator?"{2} IS NOT NULL":"{2} {0} NULL";c=progress.util._format(n,d,h,i)}}f.push(c)}return c=f.join(" "+u+" "),f.length>1&&(c="("+c+")"),!0===r&&(c="SELECT * FROM "+e._name+" WHERE "+c),c},progress.util._getObjectType=function(e){return Object.prototype.toString.call(e).slice(8,-1)},progress.util._format=function(e){var t=arguments;return e.replace(/\{(\d+)(:[^\}]+)?\}/g,function(e,r,s){var o=t[parseInt(r,10)+1];return progress.util._toString(o,s?s.substring(1):"")})},progress.util._toString=function(e,t){return t&&"Date"===progress.util._getObjectType(e)?progress.util._formatDate(e,t):"number"==typeof e?e.toString():void 0!==e?e:""},progress.util._pad=function(e,t){var r;return(r=(t=t||2)-(e=String(e)).length)?["","0","00","000","0000"][t].substring(0,r)+e:e},progress.util._formatDate=function(e,t){return t.replace(/dd|MM|yyyy|hh|mm|fff|FFF|ss|zzz|iso|"[^"]*"|'[^']*'/g,function(t){var r,s;return"dd"===t?s=progress.util._pad(e.getDate()):"MM"===t?s=progress.util._pad(e.getMonth()+1):"yyyy"===t?s=progress.util._pad(e.getFullYear(),4):"hh"===t?s=progress.util._pad(e.getHours()):"mm"===t?s=progress.util._pad(e.getMinutes()):"ss"===t?s=progress.util._pad(e.getSeconds()):"fff"===t?s=progress.util._pad(e.getMilliseconds(),3):"FFF"===t?s=String(e.getTime()):"zzz"===t?s=((r=e.getTimezoneOffset())<0?"+":"-")+r:"iso"===t&&(s=e.toISOString()),void 0!==s?s:t.slice(1,t.length-1)})},progress.util.jsdoSettingsProcessor=function(e){"object"==typeof e&&(void 0!==e.authenticationModel&&""!==e.authenticationModel||(e.authenticationModel="ANONYMOUS"))}}(),function(){var e=["none","create","read","update","delete","submit"],t=["","created","","modified","deleted"];"undefined"==typeof progress&&(progress={}),void 0===progress.data&&(progress.data={}),progress.data._nextid=0,progress.data._uidprefix=""+(Date.now?Date.now():(new Date).getTime());progress.data._getNextId=function(){var e=++progress.data._nextid;return e>=999999999999999&&(progress.data._nextid=e=1,progress.data._uidprefix=""+(Date.now?Date.now():(new Date).getTime())),progress.data._uidprefix+"-"+e};var r={msgs:{}};r.msgs.jsdoMSG000="JSDO, Internal Error: {1}",r.msgs.jsdoMSG001="JSDO: JSDO has multiple tables. Please use {1} at the table reference level.",r.msgs.jsdoMSG002="JSDO: Working record for '{1}' is undefined.",r.msgs.jsdoMSG003="JSDO: {1} function requires a function as a parameter.",r.msgs.jsdoMSG004="JSDO: Unable to find resource '{1}' in the catalog.",r.msgs.jsdoMSG005="JSDO: Data for table '{1}' was not specified in addRecords() call.",r.msgs.jsdoMSG006="JSDO: Data for JSDO was not specified in addRecords() call.",r.msgs.jsdoMSG007="JSDO: Test function in {1} must return a boolean.",r.msgs.jsdoMSG008="JSDO: Invalid keyFields parameter in addRecords() call.",r.msgs.jsdoMSG009="JSDO: KeyField '{1}' in addRecords() call was not found in the schema.",r.msgs.jsdoMSG010="JSDO: Field '{1}' in relationship was not found in the schema.",r.msgs.jsdoMSG011="UIHelper: JSDO has multiple tables. Please use {1} at the table reference level.",r.msgs.jsdoMSG012="UIHelper: Invalid {2} parameter in {1} call.",r.msgs.jsdoMSG020="JSDO: tableName parameter must be a string in addRecords() call.",r.msgs.jsdoMSG021="JSDO: addMode parameter must be specified in addRecords() call.",r.msgs.jsdoMSG022="JSDO: Invalid addMode specified in addRecords() call.",r.msgs.jsdoMSG023="JSDO: Duplicate found in addRecords() call using APPEND mode.",r.msgs.jsdoMSG024="{1}: Unexpected signature in call to {2} function.",r.msgs.jsdoMSG025="{1}: Invalid parameters in call to {2} function.",r.msgs.jsdoMSG026="JSDO: saveChanges requires a CREATE, UPDATE, DELETE or SUBMIT operation to be defined.",r.msgs.jsdoMSG030="JSDO: Invalid {1}, expected {2}.",r.msgs.jsdoMSG031="JSDO: Specified sort field name '{1}' was not found in the schema.",r.msgs.jsdoMSG032="JSDO: Before-image data already exists for record in addRecords() call.",r.msgs.jsdoMSG033="{1}: Invalid signature for {2}. {3}",r.msgs.jsdoMSG034="JSDO: In '{1}' function, JSON data is missing _id",r.msgs.jsdoMSG035="JSDO: In '{1}' function, before-image JSON data is missing prods:clientId",r.msgs.jsdoMSG036="JSDO: '{1}' can only be called for a dataset",r.msgs.jsdoMSG037="{1}: Event name must be provided for {2}.",r.msgs.jsdoMSG038="Too few arguments. There must be at least {1}.",r.msgs.jsdoMSG039="The name of the event is not a string.",r.msgs.jsdoMSG040="The event listener is not a function.",r.msgs.jsdoMSG041="The event listener scope is not an object.",r.msgs.jsdoMSG042="'{1}' is not a defined event for this object.",r.msgs.jsdoMSG043="{1}: A session object was requested to check the status of a Mobile Service named '{2}', but it has not loaded the definition of that service.",r.msgs.jsdoMSG044="JSDO: In '{1}' function, {2} is missing {3} property.",r.msgs.jsdoMSG045="JSDO: {1} function: {2} is missing {3} property.",r.msgs.jsdoMSG046="JSDO: {1} operation is not defined.",r.msgs.jsdoMSG047="{1} timeout expired.",r.msgs.jsdoMSG048="{1}: {2} method has argument '{3}' that is missing property '{4}'.",r.msgs.jsdoMSG049="{1}: Unexpected error calling {2}: {3}",r.msgs.jsdoMSG050="No token returned from server",r.msgs.jsdoMSG051="{1} The login method was not executed because the AuthenticationProvider is already logged in.",r.msgs.jsdoMSG052="{1}: The login method was not executed because no credentials were supplied.",r.msgs.jsdoMSG053="{1}: {2} was not executed because the AuthenticationProvider is not logged in.",r.msgs.jsdoMSG054="{1}: Token refresh was not executed because the AuthenticationProvider does not have a refresh token.",r.msgs.jsdoMSG055="{1}: Token refresh was not executed  because the authentication model is not sso.",r.msgs.jsdoMSG056="{1}: Already logged in.",r.msgs.jsdoMSG057="{1}: Cannot call {2} when authenticationModel is SSO. Please use the AuthenticationProvider object instead.",r.msgs.jsdoMSG058="{1}: Cannot pass username and password to addCatalog when authenticationModel is sso. Pass an AuthenticationProvider instead.",r.msgs.jsdoMSG059="{1}: Error in constructor. The authenticationModels of the AuthenticationProvider ({2}) and the JSDOSession ({3}) were not compatible.",r.msgs.jsdoMSG060="AuthenticationProvider: AuthenticationProvider is no longer logged in. Tried to refresh SSO token but failed due to authentication error at token server.",r.msgs.jsdoMSG061="{1}: Attempted to set {2} property to an invalid value.",r.msgs.jsdoMSG062="{1}: Cannot call {2} when an AuthenticationProvider is already available and logged in.",r.msgs.jsdoMSG100="JSDO: Unexpected HTTP response. Too many records.",r.msgs.jsdoMSG101="Network error while executing HTTP request.",r.msgs.jsdoMSG110="Catalog error: idProperty not specified for resource '{1}'. idProperty is required {2}.",r.msgs.jsdoMSG111="Catalog error: Schema '{1}' was not found in catalog.",r.msgs.jsdoMSG112="Catalog error: Output parameter '{1}' was not found for operation '{2}'.",r.msgs.jsdoMSG113="Catalog error: Found xType '{1}' for output parameter '{2}' for operation '{3}' but xType DATASET, TABLE or ARRAY was expected.",r.msgs.jsdoMSG114="JSDO: idProperty '{1}' is missing from '{2}' record.",r.msgs.jsdoMSG115="JSDO: Invalid option specified in {1}() call.",r.msgs.jsdoMSG116="JSDO: {1} parameter must be a string in {2} call.",r.msgs.jsdoMSG117="JSDO: Schema from storage area '{1}' does not match JSDO schema",r.msgs.jsdoMSG118="JSDO: Plugin '{1}' was not found.",r.msgs.jsdoMSG119="JSDO: A mappingType is expected when 'capabilities' is set. Please specify a plugin (ex: JFP).",r.msgs.jsdoMSG120="JSDO: Parameter '{2}' requires capability '{1}' in the catalog.",r.msgs.jsdoMSG121="{1}: Argument {2} must be of type {3} in {4} call.",r.msgs.jsdoMSG122="{1}: Incorrect number of arguments in {2} call. There should be {3}.",r.msgs.jsdoMSG123="{1}: A server response included an invalid '{2}' header.",r.msgs.jsdoMSG124="JSDO: autoApplyChanges is not supported for saveChanges(true) with a temp-table. Use jsdo.autoApplyChanges = false.",r.msgs.jsdoMSG125="{1}: The AuthenticationProvider is not managing valid credentials.",r.msgs.jsdoMSG126="{1}: No support for {2}.",r.msgs.jsdoMSG127="JSDO: acceptRowChanges() cannot be called for record with _rejected === true.",r.msgs.jsdoMSG500="{1}: '{2}' objects must contain a '{3}' property.",r.msgs.jsdoMSG501="{1}: '{2}' in '{3}' function cannot be an empty string.",r.msgs.jsdoMSG502="{1}: The '{2}' parameter passed to the '{3}' function has an invalid value for its '{4}' property.",r.msgs.jsdoMSG503="{1}: '{2}' must be of type '{3}'.",r.msgs.jsdoMSG504="{1}: {2} has an invalid value for the '{3}' property.",r.msgs.jsdoMSG505="{1}: '{2}' objects must have a '{3}' method.",r.msgs.jsdoMSG506="{1}: Invalid argument for the {2} parameter in {3} call.",r.msgs.jsdoMSG507="{1}: '{2}' is an invalid value for the {3} parameter in {4} call.",r.msgs.jsdoMSG508="JSDOSession: If a JSDOSession object is using the SSO authentication model, the options object passed to its constructor must include an authProvider property.",r.msgs.jsdoMSG509="progress.data.getSession: If the authenticationModel is AUTH_TYPE_SSO, authenticationURI and authProviderAuthenticationModel are required parameters.",r.msgs.jsdoMSG510="{1}: This session has been invalidated and cannot be used.",r.msgs.jsdoMSG511="JSDOSession: addCatalog() can only be called if an AuthenticationProvider was passed as an argument or connect() has been successfully called.",r.msgs.jsdoMSG512="JSDOSession: Error while loading multiple catalogs.",r.msgs.jsdoMSG998="JSDO: JSON object in addRecords() must be DataSet or Temp-Table data.",r.getMsgText=function(e,t){var s,o=r.msgs[e];if(!o)throw new Error("Message text was not found by getMsgText()");for(s=1;s<arguments.length;s+=1)o=o.replace(new RegExp("\\{"+s+"\\}","g"),arguments[s]);return o},progress.data._getMsgText=r.getMsgText,progress.data.PluginManager={},progress.data.PluginManager._plugins={},progress.data.PluginManager.addPlugin=function(e,t){if(void 0!==progress.data.PluginManager._plugins[e])throw new Error("A plugin named '"+e+"' is already registered.");progress.data.PluginManager._plugins[e]=t},progress.data.PluginManager.getPlugin=function(e){return progress.data.PluginManager._plugins[e]},progress.data.JSIndexEntry=function(e){this.index=e},progress.data.JSTableRef=function(e,s){this._jsdo=e,this._name=s,this._schema=null,this._primaryKeys=null,this._fields=null,this._processed={},this._visited=!1,this.record=null,this._data=[],this._index={},this._tmpIndex={},this._hasEmptyBlocks=!1,this._beforeImage={},this._added=[],this._changed={},this._deleted=[],this._lastErrors=[],this._convertForServer,this._createIndex=function(){var e,t,s;for(this._index={},this._tmpIndex={},this._hasEmptyBlocks=!1,e=0;e<this._data.length;e+=1)if(this._data[e]){if(!(t=this._data[e]._id)){if("string"==typeof(s=this._jsdo._resource.idProperty)){if(void 0===(t=this._data[e][s]))throw new Error(r.getMsgText("jsdoMSG114",s,this._name));t+=""}else t=progress.data._getNextId();t+="",this._data[e]._id=t}this._index[t]=new progress.data.JSIndexEntry(e)}else this._hasEmptyBlocks=!0;this._needCompaction=!1},this._compact=function(){var e,t,r=[];for(e=0;e<this._data.length;e+=1)(t=this._data[e])&&r.push(t);this._data=r,this._createIndex()},this._loadBeforeImageData=function(e,t,s){var o,i,a,n,d,h,l,c,f=e[this._jsdo._dataSetName]["prods:before"],u={};if(f&&f[this._name]){if(0!==Object.keys(this._beforeImage).length&&s&&0!==s.length)for(d in n={},this._beforeImage)(p=this._findById(d,!1))&&(n[a=this._getKey(p.data,s)]=p.data);for(c=0;c<f[this._name].length;c++)if(u[(o=f[this._name][c])["prods:id"]]=o,"deleted"==o["prods:rowState"]){if(a=void 0,s&&0!==s.length&&(a=this._getKey(o,s)),n&&void 0!==n[a])throw new Error(r.getMsgText("jsdoMSG032"));if(void 0===h&&s&&0!==s.length){h={},l={};for(var _=0;_<this._data.length;_++){if(i=this._data[_])h[this._getKey(i,s)]=i}for(_=0;_<this._deleted.length;_++){if(i=this._deleted[_].data)l[this._getKey(i,s)]=i}}if(void 0!==a&&void 0!==(i=l[a]))continue;if(void 0!==a)if(void 0!==(i=h[a]))(p=this._findById(i._id,!1))&&p._remove(!1),o._id=i._id;void 0===o._id&&(o._id=progress.data._getNextId());var g={};this._jsdo._copyRecord(this._tableRef,o,g),this._jsdo._deleteProdsProperties(g),this._beforeImage[o._id]=g;var p=new progress.data.JSRecord(this,g);this._deleted.push(p)}}if(e[this._jsdo._dataSetName][this._name])for(c=0;c<e[this._jsdo._dataSetName][this._name].length;c++)switch(o=e[this._jsdo._dataSetName][this._name][c],b=void 0,t&&o["prods:id"]&&(b=t[o["prods:id"]]),o["prods:rowState"]){case"created":void 0===b&&(b=o._id),void 0!==b&&(this._beforeImage[b]=null,this._added.push(b));break;case"modified":var S=u[o["prods:id"]];if(void 0===S&&(S={}),void 0===b&&(b=o._id),void 0!==b){S._id=o._id;g={};this._jsdo._copyRecord(this._tableRef,S,g),this._jsdo._deleteProdsProperties(g),this._beforeImage[b]=g,this._changed[b]=o,this._beforeImage[S._id]=g,this._changed[S._id]=o}break;case void 0:break;default:throw new Error(r.getMsgText("jsdoMSG030","rowState value in before-image data","'created' or 'modified'"))}var m=e[this._jsdo._dataSetName]["prods:errors"];if(m)for(c=0;c<m[this._name].length;c++){var v=m[this._name][c],b=t[v["prods:id"]];(p=this._findById(b,!1))&&(p.data._errorString=v["prods:error"])}u=null},this._clearData=function(){this._setRecord(null),this._data=[],this._index={},this._tmpIndex={},this._createIndex(),this._beforeImage={},this._added=[],this._changed={},this._deleted=[]},this.hasData=function(){var e;if(e=this._jsdo._nestChildren?this._getDataWithNestedChildren(this._data):this._getRelatedData(),this._hasEmptyBlocks)for(var t=0;t<e.length;t++){if(!e[t])return!0}return 0!==e.length},this.getData=function(e){return(this._needCompaction||this._hasEmptyBlocks)&&this._compact(),this._getData(e)},this._getData=function(e){var t,r,s,o,i,a;if(this._needCompaction&&this._compact(),e&&e.filter)throw new Error("Not implemented in current version");if(r=this._jsdo._nestChildren?this._getDataWithNestedChildren(this._data):this._getRelatedData(),this._hasEmptyBlocks){for(s=0,o=[],t=0;t<r.length;t+=1)(i=r[t])?o.push(i):s++;100*s/this._data.length>=20&&(this._needCompaction=!0),r=o}else if(e&&(e.sort||e.top)){for(o=[],t=0;t<r.length;t+=1)o.push(r[t]);r=o}if(e&&(e.sort||e.top)){if(e.sort){var n=[];for(t=0;t<e.sort.length;t+=1)a=e.sort[t].field,"desc"==e.sort[t].dir&&(a+=":DESC"),n.push(a);var d=this._processSortFields(n);d.sortFields&&d.sortFields.length>0&&(d.tableRef=this,r.sort(this._getCompareFn(d)))}e.top&&(void 0===e.skip&&(e.skip=0),r=r.splice(e.skip,e.top))}return r},this._recToDataObject=function(e,t){var r=[e],s=r;if(void 0===t&&(t=!1),this._jsdo._dataSetName){if((s={})[this._jsdo._dataSetName]={},s[this._jsdo._dataSetName][this._name]=r,t&&this._children.length>0){var o=this._findById(e._id,!1);if(o)for(var i=0;i<this._children.length;i++){var a=this._children[i];s[this._jsdo._dataSetName][a]=this._jsdo._buffers[a]._getRelatedData(o)}}}else this._jsdo._dataProperty&&((s={})[this._jsdo._dataProperty]=r);return s},this._recFromDataObject=function(e){var t={};return e&&(this._jsdo._dataSetName?e[this._jsdo._dataSetName]&&(t=e[this._jsdo._dataSetName][this._name]):this._jsdo._dataProperty?e[this._jsdo._dataProperty]&&(t=e[this._jsdo._dataProperty]):t=e.data?e.data:e),t instanceof Array?t[0]:t},this.getSchema=function(){return this._schema},this.setSchema=function(e){this._schema=e},this._getABLType=function(e){var t,r;for(r=this.getSchema(),t=0;t<r.length;t++)if(r[t].name==e)return r[t].ablType},this._getFormat=function(e){var t,r;for(r=this.getSchema(),t=0;t<r.length;t++)if(r[t].name==e)return r[t].format},this.add=function(e){return this._add(e,!0,!0)},this.create=this.add,this._add=function(e,t,s){void 0===t&&(t=!0),void 0===s&&(s=!0);var o,i,a,n,d,h={};void 0===e&&(e={});var l,c,f=this.getSchema();for(o=0;o<f.length;o++){var u=f[o].name;if("array"==f[o].type){if(h[u]=[],f[o].maxItems)for(i=0;i<f[o].maxItems;i++)h[u][i]=this._jsdo._getDefaultValue(f[o]);for(void 0!==(a=e[u])&&(h[u]=a,delete e[u]),n=this._jsdo._getArrayField(u),h[u]||(h[u]=[]),i=0;i<f[o].maxItems;i+=1)void 0!==(a=e[d=n.name+(i+1)])&&(this._fields[d.toLowerCase()]||(delete e[n.name+(i+1)],"string"==typeof a&&"string"!=f[o].items.type&&(a=this._jsdo._convertType(a,f[o].items.type,null)),h[u][i]=a))}else h[u]=this._jsdo._getDefaultValue(f[o])}if(this._jsdo.useRelationships&&this._relationship&&this._parent){if(!this._jsdo._buffers[this._parent].record)throw new Error(r.getMsgText("jsdoMSG002",this._parent));for(i=0;i<this._relationship.length;i++)h[this._relationship[i].childFieldName]=this._jsdo._buffers[this._parent].record.data[this._relationship[i].parentFieldName]}for(var _ in e)h[_]=e[_];if(void 0!==(c=this._jsdo._resource.idProperty)&&(l=h[c]),l?l+="":l=progress.data._getNextId(),l+="",h._id=l,this.autoSort&&this._sortRecords&&(void 0!==this._sortFn||void 0!==this._sortObject.sortFields)){if(this._needsAutoSorting)this._data.push(h),this._sort();else{for(o=0;o<this._data.length;o++){if(null!==this._data[o])if(-1==(this._sortFn?this._sortFn(h,this._data[o]):this._compareFields(h,this._data[o])))break}this._data.splice(o,0,h)}this._createIndex()}else this._data.push(h),this._index[h._id]=new progress.data.JSIndexEntry(this._data.length-1);var g=new progress.data.JSRecord(this,h);return s&&this._setRecord(g,!0),t&&(this._beforeImage[h._id]=null,this._added.push(h._id)),g},this._getRelatedData=function(e){var t=[];if(0===this._data.length)return t;if(void 0===e&&this._jsdo.useRelationships&&this._relationship&&this._parent&&!(e=this._jsdo._buffers[this._parent].record))throw new Error(r.getMsgText("jsdoMSG002",this._parent));if(e)for(var s=0;s<this._data.length;s++){if(this._data[s]){for(var o=!1,i=0;i<this._relationship.length&&(o=e.data[this._relationship[i].parentFieldName]==this._data[s][this._relationship[i].childFieldName]);i++);o&&t.push(this._data[s])}}else t=this._data;return t},this._getDataWithNestedChildren=function(e){for(var t=0;t<e.length;t++){var r=e[t];if(this._children&&this._children.length>0)for(var s=0;s<this._children.length;s++){var o=this._jsdo._buffers[this._children[s]];if(o._isNested){for(var i=0;i<o._data.length;i++){var a=o._data[i];if(a){for(var n=!1,d=0;d<o._relationship.length&&(n=r[o._relationship[d].parentFieldName]==a[o._relationship[d].childFieldName]);d++);n&&(r[o._name]||(r[o._name]=[]),r[o._name].push(a))}}o._hasNestedChild()&&o._getDataWithNestedChildren(r[o._name])}}}return e},this._findFirst=function(){if(this._jsdo.useRelationships&&this._relationship&&this._parent){if(this._jsdo._buffers[this._parent].record)for(var e=0;e<this._data.length;e++){if(this._data[e]){for(var t,r,s=!1,o=0;o<this._relationship.length&&(t=this._relationship[o].parentFieldName,r=this._relationship[o].childFieldName,s=this._jsdo._buffers[this._parent].record.data[t]==this._data[e][r]);o++);if(s)return new progress.data.JSRecord(this,this._data[e])}}}else for(e=0;e<this._data.length;e++){if(this._data[e])return new progress.data.JSRecord(this,this._data[e])}},this._setRecord=function(e,t){if(this.record=e||void 0,this._jsdo.useRelationships&&(t="boolean"==typeof t&&t,this._children&&this._children.length>0))for(var r=0;r<this._children.length;r++){var s=this._jsdo._buffers[this._children[r]];!t&&this.record&&s._relationship?s._setRecord(s._findFirst()):s._setRecord(void 0,t)}this._jsdo._defaultTableRef&&(this._jsdo.record=this.record)},this.assign=function(e){if(this.record)return this.record.assign(e);throw new Error(r.getMsgText("jsdoMSG002",this._name))},this.update=this.assign,this.remove=function(){if(this.record)return this.record._remove(!0);throw new Error(r.getMsgText("jsdoMSG002",this._name))},this._remove=function(e){if(this.record)return this.record._remove(e);throw new Error(r.getMsgText("jsdoMSG002",this._name))},this.getId=function(){return this.record?this.record.data._id:0},this.getErrors=function(){return this._lastErrors},this.getErrorString=function(){return this.record?this.record.data._errorString:0},this.findById=function(e){return this._findById(e,!0)},this._findById=function(e,t){if(void 0===t&&(t=!0),e&&this._index[e]){var r=this._data[this._index[e].index];return this.record=r?new progress.data.JSRecord(this,r):null,t&&this._setRecord(this.record),this.record}return t&&this._setRecord(null),null},this.find=function(e){if("function"!=typeof e)throw new Error(r.getMsgText("jsdoMSG003","find()"));for(var t=this._getRelatedData(),s=0;s<t.length;s++){if(t[s]){this._setRecord(new progress.data.JSRecord(this,t[s]));var o=e(this.record);if("boolean"!=typeof o)throw new Error(r.getMsgText("jsdoMSG007","find()"));if(o)return this.record}}return this._setRecord(null),null},this.foreach=function(e){if("function"!=typeof e)throw new Error(r.getMsgText("jsdoMSG003","foreach()"));var t=0;this._needCompaction&&this._compact();var s=this._getRelatedData();this._inforeach=!0;for(var o=0;o<s.length;o++){if(s[o]){this._setRecord(new progress.data.JSRecord(this,s[o]));var i=e(this.record);if(void 0!==i&&!i)break}else t++}this._inforeach=!1,100*t/this._data.length>=20&&(this._needCompaction=!0)},this._equalRecord=function(t,r,o){for(var i,a=0;a<o.length;a++){var n=o[a],d=t[n],h=r[n];if(e[s].caseSensitive||(i=e[s]._fields[n.toLowerCase()])&&"string"==i.type&&(null!=d&&(d=d.toUpperCase()),null!=h&&(h=h.toUpperCase())),!(d==h))return!1}return!0},this._getKey=function(t,r){for(var o={},i=0;i<r.length;i++){var a=r[i],n=t[a];if(!e[s].caseSensitive){var d=e[s]._fields[a.toLowerCase()];d&&"string"==d.type&&null!=n&&(n=n.toUpperCase())}o[a]=n}return JSON.stringify(o)},this._getCompareFn=function(e){return"function"==typeof e?function(t,r){if(null===t)return 1;if(null===r)return-1;var s=new progress.data.JSRecord(this,t),o=new progress.data.JSRecord(this,r);return e(s,o)}:function(t,r){var s=e.tableRef,o=e.sortFields;if(!(o instanceof Array))return 0;var i,a=e.sortAscending;if(null===t)return 1;if(null===r)return-1;for(var n=0;n<o.length;n++){var d=o[n],h=t[d],l=r[d];if(s.caseSensitive||(i=s._fields[d.toLowerCase()])&&"string"==i.type&&(null!=h&&(h=h.toUpperCase()),null!=l&&(l=l.toUpperCase())),h>l||null==h)return a[n]?1:-1;if(h<l||void 0===l&&null===l)return a[n]?-1:1}return 0}},this._sortObject={},this._sortObject.tableRef=this,this._sortObject.sortFields=void 0,this._sortObject.sortAscending=void 0,this._compareFields=this._getCompareFn(this._sortObject),this._sortRecords=!0,this._needsAutoSorting=!1,this._sortFn=void 0,"function"==typeof Object.defineProperty?(this._autoSort=!0,Object.defineProperty(this,"autoSort",{get:function(){return this._autoSort},set:function(e){e?(this._autoSort=!0,(this._sortFn||this._sortObject.sortFields)&&(this._sort(),this._createIndex())):this._autoSort=!1},enumerable:!0,writeable:!0}),this._caseSensitive=!1,Object.defineProperty(this,"caseSensitive",{get:function(){return this._caseSensitive},set:function(e){this._caseSensitive=!!e,this.autoSort&&this._sortObject.sortFields&&!this._sortFn&&(this._sort(),this._createIndex())},enumerable:!0,writeable:!0})):(this.autoSort=!0,this.caseSensitive=!1),this._processSortFields=function(e){var t={};if(e instanceof Array){t.sortFields=e,t.sortAscending=[],t.fields={};for(var s=0;s<t.sortFields.length;s++){var o,i,a;if("string"!=typeof t.sortFields[s])throw new Error(r.getMsgText("jsdoMSG030","sort field name","string element"));if(-1!=(o=t.sortFields[s].indexOf(":")))switch(i=t.sortFields[s].substring(0,o),t.sortFields[s].substring(o+1).toUpperCase()){case"ASCENDING":case"ASC":t.sortAscending[s]=!0;break;case"DESCENDING":case"DESC":t.sortAscending[s]=!1;break;default:throw new Error(r.getMsgText("jsdoMSG030","sort order '"+t.sortFields[s].substring(o+1)+"'","ASCENDING or DESCENDING"))}else i=t.sortFields[s],t.sortAscending[s]=!0;if("_id"!=i&&this._fields){if(!(a=this._fields[i.toLowerCase()]))throw new Error(r.getMsgText("jsdoMSG031",i));if("array"==a.type)throw new Error(r.getMsgText("jsdoMSG030","data type found in sort","scalar field"));i=a.name}t.sortFields[s]=i,t.fields[i]=i}}else t.sortFields=void 0,t.sortAscending=void 0,t.fields=void 0;return t},this.setSortFields=function(e){if(null==e)this._sortObject.sortFields=void 0,this._sortObject.sortAscending=void 0;else{if(!(e instanceof Array))throw new Error(r.getMsgText("jsdoMSG024","JSDO","setSortFields()"));var t=this._processSortFields(e);this._sortObject.sortFields=t.sortFields,this._sortObject.sortAscending=t.sortAscending,this._sortObject.fields=t.fields,this.autoSort&&(this._sort(),this._createIndex())}},this.setSortFn=function(e){if(e&&"function"!=typeof e)throw new Error(r.getMsgText("jsdoMSG030","parameter in setSortFn()","function parameter"));this._sortFn=e?this._getCompareFn(e):void 0,this.autoSort&&(this._sort(),this._createIndex())},this.sort=function(e){if(null==e)throw new Error(r.getMsgText("jsdoMSG025","JSDO","sort()"));if(1!==arguments.length||!(e instanceof Array)&&"function"!=typeof e)throw new Error(r.getMsgText("jsdoMSG024","JSDO","sort()"));if(e instanceof Array){var t=this._processSortFields(e);t.sortFields&&t.sortFields.length>0&&this._sort(t)}else this._sort(e);this._createIndex()},this._sort=function(e){(0!==arguments.length||this.autoSort&&(void 0!==this._sortFn||void 0!==this._sortObject.sortFields))&&(0===arguments.length?(this._sortFn?this._data.sort(this._sortFn):this._data.sort(this._compareFields),this._needsAutoSorting=!1):("function"==typeof e?this._data.sort(this._getCompareFn(e)):(e.tableRef=this,this._data.sort(this._getCompareFn(e))),this.autoSort&&(this._needsAutoSorting=!0)))},this.addRecords=function(e,t,r,s,o){this._jsdo._addRecords(this._name,e,t,r,s,o)},this.acceptChanges=function(){for(var e in this._beforeImage){if(null===this._beforeImage[e])null!==(t=this._findById(e,!1))&&this._jsdo._deleteProdsProperties(t.data,!0);else if(void 0!==this._changed[e]){var t;null!==(t=this._findById(e,!1))&&this._jsdo._deleteProdsProperties(t.data,!0)}}this._processed={},this._added=[],this._changed={},this._deleted=[],this._beforeImage={}},this.rejectChanges=function(){for(var e in this._beforeImage)null===this._beforeImage[e]?this._jsdo._undoCreate(this,e):void 0!==this._changed[e]?this._jsdo._undoUpdate(this,e,!0):this._jsdo._undoDelete(this,e,!0);this._processed={},this._added=[],this._changed={},this._deleted=[]},this.hasChanges=function(){return 0!==Object.keys(this._beforeImage).length},this.getChanges=function(){var e=[];for(var r in this._beforeImage){var s={rowState:"",record:null};null===this._beforeImage[r]?(s.rowState=t[progress.data.JSDO._OP_CREATE],s.record=this._findById(r,!1)):void 0!==this._changed[r]?(s.rowState=t[progress.data.JSDO._OP_UPDATE],s.record=this._findById(r,!1)):(s.rowState=t[progress.data.JSDO._OP_DELETE],s.record=new progress.data.JSRecord(this,this._beforeImage[r])),e.push(s)}return e},this._clearErrorStrings=function(){var e=null;for(var t in this._beforeImage)null===this._beforeImage[t]?(e=this._findById(t,!1))&&delete e.data._errorString:(e=this._findById(t,!1))?delete e.data._errorString:delete this._beforeImage[t]._errorString},this._applyChanges=function(){for(var e in this._beforeImage)if(null===this._beforeImage[e]){if(null===(i=this._findById(e,!1))&&void 0!==this._jsdo._resource.idProperty&&this._tmpIndex[e]){var t=this._data[this._tmpIndex[e].index];i=t?new progress.data.JSRecord(this,t):null,delete this._tmpIndex[e]}if(null!==i)i.data._rejected||void 0!==i.data._errorString?this._jsdo._undoCreate(this,e):i.acceptRowChanges();else{for(var s=!1,o=0;o<this._deleted.length&&!(s=this._deleted[o].data._id==e);o++);if(!s)throw new Error(r.getMsgText("jsdoMSG000","Created record appears to be deleted without a delete operation."))}}else if(void 0!==this._changed[e]){var i;if(null!==(i=this._findById(e,!1)))i.data._rejected||void 0!==i.data._errorString?this._jsdo._undoUpdate(this,e):i.acceptRowChanges();else if(this._beforeImage[e]._rejected||void 0!==this._beforeImage[e]._errorString)this._jsdo._undoDelete(this,e);else{s=!1;for(o=0;o<this._deleted.length&&!(s=this._deleted[o].data._id==e);o++);if(!s)throw new Error(r.getMsgText("jsdoMSG000","Updated record appears to be deleted without a delete operation."))}}else(this._beforeImage[e]._rejected||void 0!==this._beforeImage[e]._errorString)&&this._jsdo._undoDelete(this,e);this._processed={},this._added=[],this._changed={},this._deleted=[],this._beforeImage={}},this.acceptRowChanges=function(){if(this.record)return this.record.acceptRowChanges();throw new Error(r.getMsgText("jsdoMSG002",this._name))},this.rejectRowChanges=function(){if(this.record)return this.record.rejectRowChanges();throw new Error(r.getMsgText("jsdoMSG002",this._name))},this._hasNestedChild=function(){var e=!1;if(this._children.length>0)for(var t=0;t<this._children.length;t++)if(this._jsdo._buffers[this._children[t]]._isNested){e=!0;break}return e}},progress.data.JSRecord=function(e,t){this._tableRef=e,this.data=t,this.getId=function(){return this.data._id?this.data._id:null},this.getErrorString=function(){return this.data._errorString},this._saveBeforeImageUpdate=function(){if(void 0===this._tableRef._beforeImage[this.data._id]){var e={};this._tableRef._jsdo._copyRecord(this._tableRef,this.data,e),this._tableRef._beforeImage[this.data._id]=e}void 0===this._tableRef._changed[this.data._id]&&(this._tableRef._changed[this.data._id]=this.data)},this._sortRecord=function(e){var t=this._tableRef._index[this.data._id].index,r=this._tableRef._data[t];if(this._tableRef.autoSort&&this._tableRef._sortRecords&&(void 0!==this._tableRef._sortFn||void 0!==this._tableRef._sortObject.sortFields)){if(this._tableRef._sortObject.fields)if("string"==typeof e){if(void 0===this._tableRef._sortObject.fields[e])return}else if(e instanceof Array){for(var s=!1,o=0;o<e.length;o++)if(void 0!==this._tableRef._sortObject.fields[e[o]]){s=!0;break}if(!s)return}if(this._tableRef._needsAutoSorting)this._tableRef._sort(),this._tableRef._createIndex();else{for(o=0;o<this._tableRef._data.length;o++){if(null!==this._tableRef._data[o])if(o!=t)if(-1==(this._tableRef._sortFn?this._tableRef._sortFn(r,this._tableRef._data[o]):this._tableRef._compareFields(r,this._tableRef._data[o])))break}o>t&&o--,o!=t&&(this._tableRef._data.splice(t,1),this._tableRef._data.splice(o,0,r),this._tableRef._createIndex())}}},this.assign=function(e){if(void 0===e)throw new Error(r.getMsgText("jsdoMSG024","JSDO","assign() or update()"));this._saveBeforeImageUpdate();var t,s,o,i,a,n,d=this._tableRef.getSchema();if(e){for(s=0;s<d.length;s+=1)if(void 0!==(i=e[t=d[s].name])&&("string"==typeof i&&"string"!=d[s].type&&(i=this._tableRef._jsdo._convertType(i,d[s].type,d[s].items?d[s].items.type:null)),this.data[t]=i),"array"===d[s].type)for(a=this._tableRef._jsdo._getArrayField(t),this.data[t]||(this.data[t]=[]),o=0;o<d[s].maxItems;o+=1)void 0!==(i=e[n=a.name+(o+1)])&&(this._tableRef._fields[n.toLowerCase()]||("string"==typeof i&&"string"!=d[s].items.type&&(i=this._tableRef._jsdo._convertType(i,d[s].items.type,null)),this.data[t][o]=i));this._sortRecord()}return!0},this.update=this.assign,this.remove=function(){return this._remove(!0)},this._remove=function(e){void 0===e&&(e=!0);var t=this._tableRef._index[this.data._id].index,r=this._tableRef._findById(this.data._id,!1);if(e){var s=this._tableRef._beforeImage[this.data._id];void 0===s?(this.data._index=t,this._tableRef._beforeImage[this.data._id]=this.data):s&&(s._index=t),this._tableRef._deleted.push(r)}return this._tableRef._data[t]=null,this._tableRef._hasEmptyBlocks=!0,delete this._tableRef._index[this.data._id],this._tableRef._setRecord(null),!0},this.acceptRowChanges=function(){var t=this.data._id;if(void 0!==this._tableRef._beforeImage[t]){if(this.data._rejected)throw new Error(r.getMsgText("jsdoMSG127"));if(null===this._tableRef._beforeImage[t]){for(var s=0;s<this._tableRef._added.length;s++)if(this._tableRef._added[s]==t){this._tableRef._added.splice(s,1);break}this._tableRef._jsdo._deleteProdsProperties(this.data,!0)}else if(void 0!==this._tableRef._changed[t])delete this._tableRef._changed[t],this._tableRef._jsdo._deleteProdsProperties(this.data,!0);else for(s=0;s<this._tableRef._deleted.length;s++)if(this._tableRef._deleted[s].data._id==t){this._tableRef._deleted.splice(s,1);break}delete e._beforeImage[t]}},this.rejectRowChanges=function(){var t=this.data._id;if(void 0!==this._tableRef._beforeImage[t]){if(null===this._tableRef._beforeImage[t]){this._tableRef._jsdo._undoCreate(this._tableRef,t);for(var r=0;r<this._tableRef._added.length;r++)if(this._tableRef._added[r]==t){this._tableRef._added.splice(r,1);break}}else if(void 0!==this._tableRef._changed[t])this._tableRef._jsdo._undoUpdate(this._tableRef,t,!0),delete this._tableRef._changed[t];else{this._tableRef._jsdo._undoDelete(this._tableRef,t,!0);for(r=0;r<this._tableRef._deleted.length;r++)if(this._tableRef._deleted[r].data._id==t){this._tableRef._deleted.splice(r,1);break}}delete e._beforeImage[t]}}},progress.data.JSDO=function(t,s){var o={};if(void 0===progress.data.Session)throw new Error("ERROR: You must include progress.session.js");o.subscribe=this.subscribe,this.subscribe=function(e){var t=Array.prototype.slice.call(arguments);if("string"==typeof e)switch(e.toLowerCase()){case"beforeread":t[0]="beforefill";break;case"afterread":t[0]="afterfill"}o.subscribe.apply(this,t)},this._defineProperty=function(e,t){Object.defineProperty(this._buffers[e],t,{get:function(){var e,r,s,o;return this.record?(r=t.indexOf(progress.data.JSDO.ARRAY_INDEX_SEPARATOR))>0&&!this._fields[t.toLowerCase()]&&(e=t.substring(0,r),s=t.substring(r+progress.data.JSDO.ARRAY_INDEX_SEPARATOR.length),o=this._fields[e.toLowerCase()],!isNaN(s)&&o&&"array"===o.type)?this.record.data[e][s-1]:this.record.data[t]:null},set:function(e){var r,s,o,i=t;if(this.record){this.record._saveBeforeImageUpdate();try{if((r=t.indexOf(progress.data.JSDO.ARRAY_INDEX_SEPARATOR))>0&&!this._fields[t.toLowerCase()]&&(i=t.substring(0,r),s=t.substring(r+progress.data.JSDO.ARRAY_INDEX_SEPARATOR.length),o=this._fields[i.toLowerCase()],!isNaN(s)&&o&&"array"===o.type))return void(this.record.data[i][s-1]=e);this.record.data[t]=e}finally{this.record._sortRecord(i)}}},enumerable:!0,writeable:!0})},Object.defineProperty(this,"hasSubmitOperation",{get:function(){return this._hasSubmitOperation},enumerable:!0}),Object.defineProperty(this,"hasCUDOperations",{get:function(){return this._hasCUDOperations},enumerable:!0}),Object.defineProperty(this,"defaultTableRef",{get:function(){return this._defaultTableRef},enumerable:!0}),this._buffers={},this._numBuffers=0,this._defaultTableRef=null,this._async=!0,this._dataProperty=null,this._dataSetName=null,this.operations=[],this.useRelationships=!0,this._session=null,this._needCompaction=!1,this._hasCUDOperations=!1,this._hasSubmitOperation=!1,this._useSubmit=!1,this.autoApplyChanges=!0,this._lastErrors=[],this._localStorage=null,this._convertForServer,this._fillMergeMode;var i=!1;if(!arguments[0])throw new Error("JSDO: Parameters are required in constructor.");if("string"==typeof arguments[0])this.name=arguments[0];else if("object"==typeof arguments[0]){var a=arguments[0];for(var n in a)switch(n){case"autoFill":i=a[n];break;case"events":for(var d in this._events={},a[n])this._events[d.toLowerCase()]=a[n][d];break;case"dataProperty":this._dataProperty=a[n];break;default:this[n]=a[n]}}if(!this.name)throw new Error("JSDO: JSDO constructor is missing the value for 'name'");if(this._events){if("object"!=typeof this._events)throw new Error("JSDO: JSDO constructor event object is not defined as an object");for(var h in this._events){var l=this._events[h];if(!(l instanceof Array))throw new Error("JSDO: JSDO constructor event object for "+h+" must be an array");l.forEach(function(e){if("object"!=typeof e)throw new Error("JSDO: JSDO constuctor event object for "+h+" is not defined as an object");if("function"!=typeof e.fn)throw new Error("JSDO: JSDO event listener for "+h+" is not a function.");if(e.scope&&"object"!=typeof e.scope)throw new Error("JSDO: JSDO event listener scope for "+h+" is not an object.")})}}if(this.name){if(this._resource=progress.data.ServicesManager.getResource(this.name),!this._resource)throw new Error(r.getMsgText("jsdoMSG004",this.name));if(this.url||(this.url=this._resource.url),!this._dataSetName&&this._resource._dataSetName)if(this._dataSetName=this._resource._dataSetName,this._resource.dataProperty){var c=this[this._resource.dataProperty]=new progress.data.JSTableRef(this,this._resource.dataProperty);this._buffers[this._resource.dataProperty]=c}else for(var f in this._resource.fields){c=this[f]=new progress.data.JSTableRef(this,f);this._buffers[f]=c}if(!this._dataProperty&&this._resource.dataProperty&&(this._dataProperty=this._resource.dataProperty),!this._dataSetName){f=this._dataProperty?this._dataProperty:"";this._buffers[f]=new progress.data.JSTableRef(this,f),f&&(this[f]=this._buffers[f])}var u;for(var _ in this._dataSetName&&this._resource.schema&&this._resource.schema.properties[this._dataSetName]&&(u=this._resource.schema.properties[this._dataSetName].properties,1===Object.keys(u).length&&u[f=Object.keys(u)[0]].idProperty&&(this._resource.idProperty=u[f].idProperty)),this._resource.fn)this[_]=this._resource.fn[_].function;if(this._hasCUDOperations=void 0!==this._resource.generic.create||void 0!==this._resource.generic.update||void 0!==this._resource.generic.delete,this._hasSubmitOperation=void 0!==this._resource.generic.submit,!this._session){var g=progress.data.ServicesManager.getService(this._resource.service.name);this._session=g._session,this._session._pushJSDOs(this)}}else this._buffers[""]=new progress.data.JSTableRef(this,"");if(!this._session)throw new Error("JSDO: Unable to get user session for resource '"+this.name+"'");for(var p in this._buffers)this._buffers[p]._parent=null,this._buffers[p]._children=[],this._buffers[p]._relationship=null,this._buffers[p]._isNested=!1,this._defaultTableRef||(this._defaultTableRef=this._buffers[p]),this._numBuffers++;if(1!=this._numBuffers?this._defaultTableRef=null:this.record=null,"function"==typeof Object.defineProperty&&(this._caseSensitive=!1,Object.defineProperty(this,"caseSensitive",{get:function(){return this._caseSensitive},set:function(e){for(var t in this._caseSensitive=!!e,this._buffers)this._buffers[t].caseSensitive=this._caseSensitive},enumerable:!0,writeable:!0}),this._autoSort=!0,Object.defineProperty(this,"autoSort",{get:function(){return this._autoSort},set:function(e){for(var t in this._autoSort=!!e,this._buffers)this._buffers[t].autoSort=this._autoSort},enumerable:!0,writeable:!0})),this._properties={},"function"==typeof Object.defineProperty&&Object.defineProperty(this,"this._properties",{get:function(){return this._properties},enumerable:!1}),this._resource&&this._resource.fields){for(var p in this._buffers){this._buffers[p]._schema=this._resource.fields[p],this._buffers[p]._primaryKeys=this._resource.primaryKeys[p],this._buffers[p]._fields={};for(var S=this._buffers[p]._schema,m=0;m<S.length;m++)if(this._buffers[p]._fields[S[m].name.toLowerCase()]=S[m],void 0!==S[m].origName&&("string"!=typeof S[m].origName||""===S[m].origName.trim()))throw new Error(r.getMsgText("jsdoMSG504","JSDO","Field '"+S[m].name+"' in resource '"+this._resource.name+"'","origName"));if(this._buffers[p]._schema&&"function"==typeof Object.defineProperty)for(m=0;m<this._buffers[p]._schema.length;m++){var v=this._buffers[p]._schema[m].name,b=this._buffers[p]._schema[m];if(void 0===this._buffers[p][v]&&this._defineProperty(p,v),"array"===b.type)for(var y=0;y<b.maxItems;y+=1){var R=v+progress.data.JSDO.ARRAY_INDEX_SEPARATOR+(y+1);this._buffers[p]._fields[R.toLowerCase()]||this._defineProperty(p,R)}}}this._defaultTableRef&&!this._defaultTableRef._schema&&this._resource.fields[""]&&(this._defaultTableRef._schema=this._resource.fields[""])}else this._defaultTableRef&&(this._defaultTableRef._schema=[]);if(this._numBuffers>1)for(var p in this._buffers){S=[];var E=!1;for(m=0;m<this._buffers[p]._schema.length;m++){(w=this._buffers[p]._schema[m]).items&&"array"==w.type&&w.items.$ref?this._buffers[w.name]&&(E=!0,this._buffers[w.name]._isNested=!0):S.push(w)}E&&(this._buffers[p]._schema=S)}if(this._resource&&this._resource.relations)for(m=0;m<this._resource.relations.length;m++){var j=this._resource.relations[m];if(j.childName&&j.parentName&&j.childName!==j.parentName){if(j.relationFields instanceof Array)for(y=0;y<j.relationFields.length;y++){var w;if(this._buffers[j.parentName]._fields){if(v=j.relationFields[y].parentFieldName,!(w=this._buffers[j.parentName]._fields[v.toLowerCase()]))throw new Error(r.getMsgText("jsdoMSG010",v));j.relationFields[y].parentFieldName=w.name}if(this._buffers[j.childName]._fields){if(v=j.relationFields[y].childFieldName,!(w=this._buffers[j.childName]._fields[v.toLowerCase()]))throw new Error(r.getMsgText("jsdoMSG010",v));j.relationFields[y].childFieldName=w.name}}this._buffers[j.childName]._parent=j.parentName,this._buffers[j.childName]._relationship=j.relationFields,this._buffers[j.parentName]._children.push(j.childName)}}this._getDefaultValue=function(e){var t,r,s,o,i=!1;if("string"===e.type&&e.format&&-1!==e.format.indexOf("date")&&e.default?i=!0:"array"===e.type&&e.ablType&&-1!=e.ablType.indexOf("DATE")&&e.default?i=!0:t=e.default,i)switch(e.default.toUpperCase()){case"NOW":t=(new Date).toISOString();break;case"TODAY":r=new Date,1===(s=String(r.getMonth()+1)).length&&(s="0"+s),1===(o=String(r.getDate())).length&&(o="0"+o),t=r.getFullYear()+"-"+s+"-"+o;break;default:t=e.default}return t},this._getArrayField=function(e,t,r){var s={};return s.name=e+progress.data.JSDO.ARRAY_INDEX_SEPARATOR+(t>=0?t+1:""),s.value=r?r[t]:void 0,s},this.isDataSet=function(){return!!this._dataSetName},this._invokeComplete=function(e,t,r){r.async&&r.fnName&&e.trigger("afterInvoke",r.fnName,e,t,r),r.deferred&&(t?r.deferred.resolve(e,t,r):r.deferred.reject(e,t,r))},this._invokeSuccess=function(){},this._invokeError=function(){},this._httpRequest=function(e,t,r,s,o){if(!e&&((e=new XMLHttpRequest).onCompleteFn=this._invokeComplete,e.onSuccessFn=this._invokeSuccess,e.onErrorFn=this._invokeError,e.onreadystatechange=this.onReadyStateChangeGeneric,o.async&&o.fnName&&this.trigger("beforeInvoke",o.fnName,this,o),s&&this._resource&&this._resource.service)){var i=this._resource.service.useRequest;this._resource.service.settings&&void 0!==this._resource.service.settings.useRequest&&(i=this._resource.service.settings.useRequest),i&&(s={request:s})}return e.request=o,e.jsdo=this,o.jsdo=this,o.xhr=e,this._session._openRequest(e,t,r,o.async,function(){var t=null;s&&(e.setRequestHeader("Content-Type","application/json; charset=utf-8"),t=JSON.stringify(s));try{e.send(t)}catch(t){o.success=!1,o.exception=t,e.jsdo._session._checkServiceResponse(e,o.success,o)}}),o},this._getDataObject=function(){var e={};if(this._dataSetName){e[this._dataSetName]={};var t=this.useRelationships;try{for(var r in this.useRelationships=!1,this._buffers)e[this._dataSetName][r]=this._buffers[r].getData()}finally{this.useRelationships=t}}else{if(!this._dataProperty)return this.getData();e[this._dataProperty]=this.getData()}return e},this._getDataObjectAsNested=function(){var e={};if(this._dataSetName){e[this._dataSetName]={};try{for(var t in this._buffers){var s=this._buffers[t];if(!s._isNested){if(this._nestChildren=!1,s._children.length>0)for(var o=0;o<s._children.length;o++){if(this._buffers[s._children[o]]._isNested){this._nestChildren=!0;break}}e[this._dataSetName][t]=this._buffers[t].getData()}}}catch(e){throw new Error(r.getMsgText("jsdoMSG000",e.message))}finally{this._nestChildren=!1}}else{if(!this._dataProperty)return this.getData();e[this._dataProperty]=this.getData()}return e},this._unnestData=function(){var e,t,r;if(this._dataSetName)for(var s in this._buffers)if((t=this._buffers[s])._hasNestedChild())for(var o=0;o<t._data.length;o++){e=t._data[o];for(var i=0;i<t._children.length;i++)e[(r=this._buffers[t._children[i]])._name]&&delete e[r._name]}},this._recToDataObject=function(e,t){if(this._defaultTableRef)return this._defaultTableRef._recToDataObject(e,t);throw new Error(r.getMsgText("jsdoMSG001","_recToDataObject()"))},this._recFromDataObject=function(e){if(this._defaultTableRef)return this._defaultTableRef._recFromDataObject(e);throw new Error(r.getMsgText("jsdoMSG001","_recFromDataObject()"))},this.add=function(e){if(this._defaultTableRef)return this._defaultTableRef.add(e);throw new Error(r.getMsgText("jsdoMSG001","add() or create()"))},this.create=this.add,this.hasData=function(){for(var e in this._buffers)if(this._buffers[this._buffers[e]._name].hasData())return!0;return!1},this.getData=function(e){if(this._defaultTableRef)return this._defaultTableRef.getData(e);throw new Error(r.getMsgText("jsdoMSG001","getData()"))},this.getSchema=function(){if(this._defaultTableRef)return this._defaultTableRef.getSchema();throw new Error(r.getMsgText("jsdoMSG001","getSchema()"))},this.findById=function(e){if(this._defaultTableRef)return this._defaultTableRef.findById(e);throw new Error(r.getMsgText("jsdoMSG001","findById()"))},this._convertType=function(e,t,s){if("string"!=typeof e||null===t)return e;var o=e;try{if("array"==t){o=[];for(var i=(e=e.slice(1,e.length-1)).split(","),a=s&&"string"!=s,n=0;n<i.length;n++)o[n]=a?this._convertType(i[n],s,null):i[n]}else o="integer"==t?parseInt(e):"number"==t?parseFloat(e):e}catch(e){throw new Error(r.getMsgText("jsdoMSG000","Error converting string to native type: "+e.message))}return o},this.assign=function(e){if(this._defaultTableRef)return this._defaultTableRef.assign(e);throw new Error(r.getMsgText("jsdoMSG001","assign() or update()"))},this.update=this.assign,this.remove=function(){if(this._defaultTableRef)return this._defaultTableRef.remove();throw new Error(r.getMsgText("jsdoMSG001","remove()"))},this.getId=function(){if(this._defaultTableRef)return this._defaultTableRef.getId();throw new Error(r.getMsgText("jsdoMSG001","getId()"))},this.getErrors=function(){if(this._defaultTableRef)return this._defaultTableRef.getErrors();throw new Error(r.getMsgText("jsdoMSG001","getErrors()"))},this.getErrorString=function(){if(this._defaultTableRef)return this._defaultTableRef.getErrorString();throw new Error(r.getMsgText("jsdoMSG001","getErrorString()"))},this.find=function(e){if(this._defaultTableRef)return this._defaultTableRef.find(e);throw new Error(r.getMsgText("jsdoMSG001","find()"))},this.foreach=function(e){if(this._defaultTableRef)return this._defaultTableRef.foreach(e);throw new Error(r.getMsgText("jsdoMSG001","foreach()"))},this.setSortFields=function(e){if(this._defaultTableRef)return this._defaultTableRef.setSortFields(e);throw new Error(r.getMsgText("jsdoMSG001","setSortFields()"))},this.setSortFn=function(e){if(this._defaultTableRef)return this._defaultTableRef.setSortFn(e);throw new Error(r.getMsgText("jsdoMSG001","setSortFn()"))},this.sort=function(e){if(this._defaultTableRef)return this._defaultTableRef.sort(e);throw new Error(r.getMsgText("jsdoMSG001","sort()"))},this._clearErrors=function(e){for(var t in void 0===e&&(e=!1),this._lastErrors=[],this._buffers)this._buffers[t]._lastErrors=[],e&&this._buffers[t]._clearErrorStrings()},this._setAllRecordsRejected=function(e){var t,r,s,o;if(e instanceof Object){if(e instanceof Array){for(var i in t=e,r=!1,this._allRecordsRejected=!1,this._someRecordsRejected=!1,this._buffers)this._buffers[i]._lastErrors.length>0&&(r=!0);if(r){for(this._allRecordsRejected=!0,this._someRecordsRejected=!0,o=0;o<t.length;o+=1)if(t[o].record&&!t[o].record.data._rejected)return void(this._allRecordsRejected=!1)}else if(t.length>0){for(this._allRecordsRejected=!0,this._someRecordsRejected=!1,s=!1,o=0;o<t.length;o+=1)t[o].record&&(t[o].record.data._rejected?this._someRecordsRejected=!0:s=!0);s&&!this._someRecordsRejected&&(this._allRecordsRejected=!1)}}else if(e.operations instanceof Array)if(e.operations.length>0&&!e.operations[0].success){for(this._allRecordsRejected=!0,this._someRecordsRejected=!0,o=0;o<e.operations.length;o+=1)if(e.operations[o].success)return void(this._allRecordsRejected=!1)}else for(this._allRecordsRejected=!1,this._someRecordsRejected=!1,o=0;o<e.operations.length;o+=1)if(!e.operations[o].success)return void(this._someRecordsRejected=!0)}else this._allRecordsRejected=e,this._someRecordsRejected=e},this.fill=function(){var e,t,s,o;try{if(this._clearErrors(),this._setAllRecordsRejected(void 0),0!==arguments.length){if("function"==typeof arguments[0])throw new Error(r.getMsgText("jsdoMSG024","JSDO","fill() or read()"));if((s=this.getMethodProperties("read"))&&s.mappingType&&!(o=progress.data.PluginManager.getPlugin(s.mappingType)))throw new Error(r.getMsgText("jsdoMSG118",s.mappingType));if(null===arguments[0]||void 0===arguments[0])"";else if("string"==typeof arguments[0])e={filter:arguments[0]};else{if("object"!=typeof arguments[0])throw new Error(r.getMsgText("jsdoMSG025","JSDO","fill() or read()"));if(arguments[0].mergeMode)switch(this._fillMergeMode=arguments[0].mergeMode,arguments[0].mergeMode){case progress.data.JSDO.MODE_APPEND:case progress.data.JSDO.MODE_EMPTY:case progress.data.JSDO.MODE_MERGE:case progress.data.JSDO.MODE_REPLACE:break;default:throw new Error(r.getMsgText("jsdoMSG022"))}if(o)e="function"==typeof o.requestMapping?o.requestMapping(this,arguments[0],{operation:"read"}):arguments[0];else{if(s.capabilities)throw new Error(r.getMsgText("jsdoMSG119"));e=arguments[0]}}}else e=null;var i=new XMLHttpRequest,a={xhr:i,jsdo:this,objParam:e};if(i.request=a,i.jsdo=this,i.onSuccessFn=this._fillSuccess,i.onErrorFn=this._fillError,i.onCompleteFn=this._fillComplete,i.onreadystatechange=this.onReadyStateChangeGeneric,this.trigger("beforeFill",this,a),this._resource){if("function"!=typeof this._resource.generic.read)throw new Error("JSDO: READ operation is not defined.");i.objParam=e,this._resource.generic.read.call(this,i,this._async),i.request.deferred&&(t=i.request.deferred.promise())}else{this._session._openRequest(i,"GET",this.url,this._async);try{i.send(null)}catch(e){a.exception=e,i.jsdo._session._checkServiceResponse(i,a.success,a)}}0==a.success&&a.exception&&("function"==typeof i.onErrorFn&&i.onErrorFn(i.jsdo,a.success,a),i.jsdo._session._checkServiceResponse(i,a.success,a),"function"==typeof i.onCompleteFn&&i.onCompleteFn(i.jsdo,a.success,a))}catch(e){if(progress.util.Deferred.useJQueryPromises)throw e;var n;i&&i.deferred||(t=(n=new progress.util.Deferred).promise()),n.reject(this,!1,{errorObject:e})}return t},this.read=this.fill,this._clearData=function(){for(var e in this._buffers)this._buffers[e]._clearData()},this._execGenericOperation=function(t,s,o,i,a,n){var d,h=new XMLHttpRequest;switch(o.xhr=h,o.jsdo=this,o.objParam=s,o.operation=t,h.jsdo=this,h.onCompleteFn=i,h.onSuccessFn=a,h.onErrorFn=n,h.onreadystatechange=this.onReadyStateChangeGeneric,h.request=o,this._convertRequestData(s),t){case progress.data.JSDO._OP_READ:case progress.data.JSDO._OP_CREATE:case progress.data.JSDO._OP_UPDATE:case progress.data.JSDO._OP_DELETE:case progress.data.JSDO._OP_SUBMIT:d=e[t];break;default:throw new Error("JSDO: Unexpected operation "+t+" in HTTP request.")}if(this._resource){if("function"!=typeof this._resource.generic[d])throw new Error(r.getMsgText("jsdoMSG046",d.toUpperCase()));h.objParam=s,this._resource.generic[d](h,this._async)}},this._initConvertForServer=function(){var e,t,r;if(void 0===this._convertForServer)for(t in this._convertForServer=!1,this._buffers){for(r=this._buffers[t].getSchema(),this._buffers[t]._convertFieldsForServer=[],this._buffers[t]._convertForServer=!1,e=0;e<r.length;e++)r[e].ablType&&this._ablTypeNeedsConversion(r[e].ablType)&&this._buffers[t]._convertFieldsForServer.push({name:r[e].name,ablType:r[e].ablType});this._buffers[t]._convertFieldsForServer.length>0&&(this._convertForServer=!0,this._buffers[t]._convertForServer=!0)}},this._convertRequestData=function(e){var t,r;if(!1!==this._convertForServer)for(t in this._buffers)this._buffers[t]._convertForServer&&(e[this._dataSetName]?(e[this._dataSetName][t]&&this._convertTableData(this._buffers[t],e[this._dataSetName][t]),(r=e[this._dataSetName]["prods:before"])&&r[t]&&this._convertTableData(this._buffers[t],r[t])):e[t]&&this._convertTableData(this._buffers[t],e[t]))},this._convertTableData=function(e,t){var r;for(r=0;r<t.length;r++)this._convertRowData(e,t[r])},this._convertRowData=function(e,t){var r,s;for(r=0;r<e._convertFieldsForServer.length;r+=1)t[(s=e._convertFieldsForServer[r]).name]=this._convertField(t[s.name],s.ablType)},this._convertField=function(e,t){var s;if(null==e)return e;if(e instanceof Array){for(var o=[],i=0;i<e.length;i++)o[i]=this._convertField(e[i],t);return o}try{switch(t.toUpperCase()){case"DATE":case"DATETIME":if("string"==typeof e)s=e;else{if(!(e instanceof Date))throw new Error("Unexpected value for  "+t.toUpperCase()+".");s=this._convertDate(e,t.toUpperCase())}break;default:s=e}}catch(t){throw new Error(r.getMsgText("jsdoMSG000","Error in _convertField for value: "+e+". "+t.message))}return s},this._convertDate=function(e,t){var r=e;return"DATE"!==t&&"DATETIME"!==t||(r=progress.util._pad(e.getFullYear(),4)+"-"+progress.util._pad(e.getMonth()+1)+"-"+progress.util._pad(e.getDate()),"DATETIME"===t&&(r=r+"T"+progress.util._pad(e.getHours())+":"+progress.util._pad(e.getMinutes())+":"+progress.util._pad(e.getSeconds())+"."+progress.util._pad(e.getMilliseconds(),3))),r},this._ablTypeNeedsConversion=function(e){var t=!1;switch(e.toUpperCase()){case"DATE":case"DATETIME":t=!0}return t},this._undefWorkingRecord=function(){for(var e in this._buffers)this._buffers[e]._setRecord(null)},this.saveChanges=function(e){var t,s,o;try{if(void 0===e)e=!1;else if("boolean"!=typeof e)throw new Error(r.getMsgText("jsdoMSG025","JSDO","saveChanges()"));if(this._useSubmit=e,this._checkThatJSDOHasRequiredOperations(),!this._dataSetName&&this._useSubmit&&this.autoApplyChanges)throw new Error(r.getMsgText("jsdoMSG124"));this._initConvertForServer(),this._clearErrors(!0),this._setAllRecordsRejected(void 0),o={jsdo:this},this.trigger("beforeSaveChanges",this,o),s=e?this._syncDataSetForSubmit(o):this._dataSetName?this._syncDataSetForCUD():this._syncSingleTable()}catch(e){if(progress.util.Deferred.useJQueryPromises)throw e;s=(t=new progress.util.Deferred).promise(),t.reject(this,!1,{errorObject:e})}return s},this._checkThatJSDOHasRequiredOperations=function(){var e,t,s=!1,o=!1,i=!1;if(!this._hasCUDOperations&&!this._hasSubmitOperation)throw new Error(r.getMsgText("jsdoMSG026"));if(this._useSubmit){if(this._hasSubmitOperation)return;throw new Error(r.getMsgText("jsdoMSG046","SUBMIT"))}if(this._resource)for(e in this._buffers)if(t=this._buffers[e],!s&&t._deleted.length>0&&(this._confirmOperationExists(progress.data.JSDO._OP_DELETE),s=!0),!o&&t._added.length>0&&(this._confirmOperationExists(progress.data.JSDO._OP_CREATE),o=!0),!i&&Object.keys(t._changed).length>0&&(this._confirmOperationExists(progress.data.JSDO._OP_UPDATE),i=!0),s&&o&&i)break},this._confirmOperationExists=function(t){var s=e[t];if("function"!=typeof this._resource.generic[s])throw new Error(r.getMsgText("jsdoMSG046",s.toUpperCase()))},this.invoke=function(e,t){var r,s;try{var o=this[e](t);o.deferred&&(r=o.deferred,s=o.deferred.promise())}catch(e){if(progress.util.Deferred.useJQueryPromises)throw e;r||(s=(r=new progress.util.Deferred).promise()),r.reject(this,!1,{errorObject:e})}return s},this._syncTableRef=function(e,t,s){var o,i,a,n;if(!t._visited){switch(t._visited=!0,s?s.operations||(s.operations=[]):s={operations:[]},e){case progress.data.JSDO._OP_CREATE:for(var d=0;d<t._added.length;d++){var h=t._added[d];if((u=t._findById(h,!1))&&!t._processed[h]){t._processed[h]=u.data,o={},a={},t._jsdo._copyRecord(t,u.data,o),this.isDataSet()?(a[this._dataSetName]={},n=a[this._dataSetName],this._useBeforeImage("create")?(n["prods:hasChanges"]=!0,n[t._name]=[],o["prods:rowState"]="created",o["prods:clientId"]=u.data._id,delete o._id,n[t._name].push(o)):(n[t._name]=[],n[t._name].push(o))):a=o;var l={operation:e,batch:s,jsrecord:u,jsdo:this};s.operations.push(l),u._tableRef.trigger("beforeCreate",this,u,l),this.trigger("beforeCreate",this,u,l),this._execGenericOperation(progress.data.JSDO._OP_CREATE,a,l,this._createComplete,this._createSuccess,this._createError)}}break;case progress.data.JSDO._OP_UPDATE:for(var h in t._changed){if((u=t._findById(h,!1))&&!t._processed[h]){t._processed[h]=u.data,o={},a={},i={},t._jsdo._copyRecord(t,u.data,o);var c=!1;if(this.isDataSet())if(this._useBeforeImage("update"))c=!0,a[this._dataSetName]={},(n=a[this._dataSetName])["prods:hasChanges"]=!0,n[t._name]=[],o["prods:id"]=u.data._id,o["prods:rowState"]="modified",o["prods:clientId"]=u.data._id,delete o._id,n[t._name].push(o),n["prods:before"]={},(_=n["prods:before"])[t._name]=[],(g={})["prods:id"]=u.data._id,t._jsdo._copyRecord(t,t._beforeImage[u.data._id],g),delete g._id,_[t._name].push(g);if(!c){if(this._resource.service&&this._resource.service.settings&&this._resource.service.settings.sendOnlyChanges){if(t._jsdo._copyRecord(t,u.data,i,t._beforeImage[u.data._id]),!this._resource.idProperty)throw new Error(r.getMsgText("jsdoMSG110",this._resource.name," for sendOnlyChanges property"));i[this._resource.idProperty]=u.data[this._resource.idProperty]}else i=o;this.isDataSet()?(a[this._dataSetName]={},(n=a[this._dataSetName])[t._name]=[],n[t._name].push(i)):a=o}l={jsrecord:u,operation:e,batch:s,jsdo:this};s.operations.push(l),u._tableRef.trigger("beforeUpdate",this,u,l),this.trigger("beforeUpdate",this,u,l),this._execGenericOperation(progress.data.JSDO._OP_UPDATE,a,l,this._updateComplete,this._updateSuccess,this._updateError)}}}for(d=0;d<t._children.length;d++){var f=t._children[d];this._syncTableRef(e,this._buffers[f],s)}if(e==progress.data.JSDO._OP_DELETE)for(d=0;d<t._deleted.length;d++){var u;h=t._deleted[d]._id;if(u=t._deleted[d]){t._processed[h]=u.data,o={},a={},i={},t._jsdo._copyRecord(t,u.data,o);var _,g;c=!1;if(this.isDataSet())if(this._useBeforeImage("delete"))c=!0,a[this._dataSetName]={},(n=a[this._dataSetName])["prods:hasChanges"]=!0,n["prods:before"]={},(_=n["prods:before"])[t._name]=[],(g={"prods:rowState":"deleted"})["prods:clientId"]=u.data._id,t._jsdo._copyRecord(t,t._beforeImage[o._id],g),_[t._name].push(g);if(!c){if(this._resource.service&&this._resource.service.settings&&this._resource.service.settings.sendOnlyChanges){if(!this._resource.idProperty)throw new Error(r.getMsgText("jsdoMSG110",this._resource.name," for sendOnlyChanges property"));i[this._resource.idProperty]=u.data[this._resource.idProperty]}else i=o;this.isDataSet()?(a[this._dataSetName]={},(n=a[this._dataSetName])[t._name]=[],n[t._name].push(i)):a=o}l={batch:s,jsrecord:u,operation:e,jsdo:this};s.operations.push(l),u._tableRef.trigger("beforeDelete",this,u,l),this.trigger("beforeDelete",this,u,l),this._execGenericOperation(progress.data.JSDO._OP_DELETE,a,l,this._deleteComplete,this._deleteSuccess,this._deleteError)}}}},this._useBeforeImage=function(e){for(var t=0;t<this._resource.operations.length;t++)if(this._resource.operations[t].type==e)return this._resource.operations[t].useBeforeImage;return!1},this._syncDataSetForCUD=function(){var e,t,r={operations:[]};for(var s in t=(e=new progress.util.Deferred).promise(),r.deferred=e,this._buffers)this._buffers[s]._visited=!1;for(var s in this._buffers){var o=this._buffers[s];this._syncTableRef(progress.data.JSDO._OP_DELETE,o,r)}for(var s in this._buffers)this._buffers[s]._visited=!1;for(var s in this._buffers){o=this._buffers[s];this._syncTableRef(progress.data.JSDO._OP_CREATE,o,r)}for(var s in this._buffers)this._buffers[s]._visited=!1;for(var s in this._buffers){o=this._buffers[s];this._syncTableRef(progress.data.JSDO._OP_UPDATE,o,r)}if(this.autoApplyChanges)for(var s in this._buffers){(o=this._buffers[s])._processed={},o._added=[],o._changed={},o._deleted=[]}if((!this._async||r.operations&&0===r.operations.length)&&this._isBatchComplete(r)){var i=this._isBatchSuccess(r),a={batch:r,success:i};this._undefWorkingRecord(),this._lastErrors=[],!i&&r.operations&&this._updateLastErrors(this,r,null),this._setAllRecordsRejected(r),this._fireAfterSaveChanges(i,a)}return t},this._syncSingleTable=function(){var e,t;if(this._defaultTableRef){var s=this._defaultTableRef,o={operations:[]};t=(e=new progress.util.Deferred).promise(),o.deferred=e;for(var i=!1,a={},n=0;n<s._added.length;n++){a[l=s._added[n]]=l}for(n=0;n<s._deleted.length;n++){if(u=s._deleted[n])if(a[l=u.data._id]){var d={success:!0,xhr:void 0,operation:progress.data.JSDO._OP_DELETE,batch:o,jsrecord:u,jsdo:this};o.operations.push(d),s._processed[l]=u.data;var h=d.jsdo;try{d.jsrecord._tableRef.trigger("afterDelete",h,d.jsrecord,d.success,d),h.trigger("afterDelete",h,d.jsrecord,d.success,d)}finally{d.complete=!0}i=!0}}a=null;for(n=0;n<s._deleted.length;n++){if(u=s._deleted[n]){var l=u.data._id;if(!s._processed[l]){s._processed[l]=u.data,i=!1,(_=new XMLHttpRequest).jsdo=this;d={xhr:_,operation:progress.data.JSDO._OP_DELETE,batch:o,jsrecord:u,jsdo:this};o.operations.push(d),_.onCompleteFn=this._deleteComplete,_.onSuccessFn=this._deleteSuccess,_.onErrorFn=this._deleteError,_.onreadystatechange=this.onReadyStateChangeGeneric,_.request=d,u._tableRef.trigger("beforeDelete",this,u,d),this.trigger("beforeDelete",this,u,d);var c={};if(this._resource.service&&this._resource.service.settings&&this._resource.service.settings.sendOnlyChanges){if(!this._resource.idProperty)throw new Error(r.getMsgText("jsdoMSG110",this._resource.name," for sendOnlyChanges property"));c[this._resource.idProperty]=u.data[this._resource.idProperty]}else s._jsdo._copyRecord(s,u.data,c);if(s._convertForServer&&this._convertRowData(s,c),this._resource){if("function"!=typeof this._resource.generic.delete)throw new Error("JSDO: DELETE operation is not defined.");_.objParam=c,this._resource.generic.delete.call(this,_,this._async)}else{this._session._openRequest(_,"DELETE",this.url+"/"+l,!0);try{_.send(null)}catch(e){d.success=!1,d.exception=e,_.jsdo._session._checkServiceResponse(_,d.success,d)}}}}}for(n=0;n<s._added.length;n++){l=s._added[n],c={};if((u=s._findById(l,!1))&&!s._processed[l]){s._processed[l]=u.data,i=!1,(_=new XMLHttpRequest).jsdo=this;d={xhr:_,jsrecord:u,batch:o,operation:progress.data.JSDO._OP_CREATE,jsdo:this};if(o.operations.push(d),_.onCompleteFn=this._createComplete,_.onSuccessFn=this._createSuccess,_.onErrorFn=this._createError,_.onreadystatechange=this.onReadyStateChangeGeneric,_.request=d,u._tableRef.trigger("beforeCreate",this,u,d),this.trigger("beforeCreate",this,u,d),this._resource){if("function"!=typeof this._resource.generic.create)throw new Error("JSDO: CREATE operation is not defined.");this._copyRecord(s,u.data,c),void 0!==this._resource.idProperty&&void 0!==u.data._id&&delete c._id,s._convertForServer&&this._convertRowData(s,c),_.objParam=c,this._resource.generic.create.call(this,_,this._async)}else{this._session._openRequest(_,"POST",this.url,!0),_.setRequestHeader("Content-Type","application/json; charset=utf-8"),this._copyRecord(s,u.data,c),s._convertForServer&&this._convertRowData(s,c);var f=JSON.stringify(c);try{_.send(f)}catch(e){d.success=!1,d.exception=e,_.jsdo._session._checkServiceResponse(_,d.success,d)}}}}for(var l in s._changed){var u;if((u=s._findById(l,!1))&&!s._processed[l]){s._processed[l]=u.data,i=!1;var _;d={xhr:_=new XMLHttpRequest,jsrecord:u,operation:progress.data.JSDO._OP_UPDATE,batch:o,jsdo:this};_.request=d,_.jsdo=this,o.operations.push(d),_.onCompleteFn=this._updateComplete,_.onSuccessFn=this._updateSuccess,_.onErrorFn=this._updateError,_.onreadystatechange=this.onReadyStateChangeGeneric,u._tableRef.trigger("beforeUpdate",this,u,d),this.trigger("beforeUpdate",this,u,d);c={};if(this._resource.service&&this._resource.service.settings&&this._resource.service.settings.sendOnlyChanges){if(s._jsdo._copyRecord(s,u.data,c,s._beforeImage[u.data._id]),!this._resource.idProperty)throw new Error(r.getMsgText("jsdoMSG110",this._resource.name," for sendOnlyChanges property"));c[this._resource.idProperty]=u.data[this._resource.idProperty]}else s._jsdo._copyRecord(s,u.data,c);if(s._convertForServer&&this._convertRowData(s,c),this._resource){if("function"!=typeof this._resource.generic.update)throw new Error("JSDO: UPDATE operation is not defined.");_.objParam=c,this._resource.generic.update.call(this,_,this._async)}else{this._session._openRequest(_,"PUT",this.url+"/"+l,this._async),_.setRequestHeader("Content-Type","application/json; charset=utf-8");f=JSON.stringify(c);try{_.send(f)}catch(e){d.success=!1,d.exception=e,_.jsdo._session._checkServiceResponse(_,d.success,d)}}}}if(this.autoApplyChanges&&(s._added=[],s._changed={},s._deleted=[],s._processed={}),this._async||(i=!0),i){d={batch:o,success:!0};(h=this)._lastErrors=[],o.operations&&h._updateLastErrors(h,o,null),h._undefWorkingRecord(),h._fireAfterSaveChanges(d.success,d)}return t}},this._syncDataSetForSubmit=function(e){var t,r,s,o=this._saveChangesComplete,i=this._saveChangesSuccess,a=this._saveChangesError;return r=(t=new progress.util.Deferred).promise(),e.deferred=t,e.jsrecords=[],this._dataSetName?s=this._createChangeSet(this._dataSetName,!1,e):(s=this._createTTChangeSet(this._defaultTableRef,e),i=this._saveChangesSuccessTT),this._execGenericOperation(progress.data.JSDO._OP_SUBMIT,s,e,o,i,a),r},this._createChangeSet=function(e,t,r){var s={};s[e]={};var o=s[e];if(o["prods:hasChanges"]=this._hasChanges()){if(!0===t)for(var i in this._buffers)o[this._buffers[i]._name]=[];for(var i in this._buffers){var a=this._buffers[i];this._addDeletesToChangeSet(a,o,r)}for(var i in this._buffers){a=this._buffers[i];this._addCreatesToChangeSet(a,o,r)}for(var i in this._buffers){a=this._buffers[i];this._addChangesToChangeSet(a,o,r)}for(var i in this._buffers)this._buffers[i]._processed={}}var n=Object.keys(s[e]);if(1==n.length&&"prods:hasChanges"==n[0]){for(var i in this._buffers)o[this._buffers[i]._name]=[];o["prods:hasChanges"]=!1}return s},this._createTTChangeSet=function(e,t){var r,s,o,i,a={};if(a[e._name]=[],r=a[e._name],this._hasChanges()){for(s=0;s<e._added.length;s++)o=e._added[s],(i=e._findById(o,!1))&&(e._processed[i.data._id]||this._addRowToTTChangeSet(e,i,r,t,"beforeCreate"));for(o in e._changed)e._changed.hasOwnProperty(o)&&(i=e._findById(o,!1))&&(e._processed[i.data._id]||this._addRowToTTChangeSet(e,i,r,t,"beforeUpdate"));e._processed={}}return a},this._addRowToTTChangeSet=function(e,t,r,s,o){var i={};e._processed[t.data._id]=t.data,void 0!==s&&(s.jsrecords.push(t),t._tableRef.trigger(o,this,t,s),this.trigger(o,this,t,s)),e._jsdo._copyRecord(e,t.data,i),delete i._id,r.push(i)},this._createDataAndChangeSet=function(e){var t={};t[e]={};var r=t[e];for(var s in this._buffers)r[this._buffers[s]._name]=[];for(var s in this._hasChanges()&&(r["prods:hasChanges"]=!0),this._buffers){var o=this._buffers[s];this._addRecordsToObject(o,r)}for(var s in this._buffers){o=this._buffers[s];this._addDeletesToChangeSet(o,r)}for(var s in this._buffers)this._buffers[s]._processed={};return t},this._addRecordsToObject=function(e,t){e._data.length>0&&!t[e._name]&&(t[e._name]=[]);for(var r=0;r<e._data.length;r++){var s=e._data[r];if(s){if(!0===this._doesRecordHaveCreateBIData(e,s._id)){if(!(o=e._findById(s._id,!1)))continue;if(e._processed[o.data._id])continue;this._addCreatedRowToChangeSet(e,o,t)}if(!0===this._doesRecordHaveUpdateBIData(e,s._id)){var o;if(!(o=e._findById(s._id,!1)))continue;if(e._processed[o.data._id])continue;this._addChangedRowToChangeSet(e,o,t)}else{if(e._processed[s._id])continue;e._processed[s._id]=s;var i={};e._jsdo._copyRecord(e,s,i),delete i._id,t[e._name].push(i)}}}},this._doesRecordHaveCreateBIData=function(e,t){for(var r=0;r<e._added.length;r++)if(e._added[r]===t)return!0;return!1},this._doesRecordHaveUpdateBIData=function(e,t){for(var r in e._changed)if(r===t)return!0;return!1},this._hasChanges=function(){var e=!1;for(var t in this._buffers){var r=this._buffers[t],s=!1;for(var o in r._changed){s=!0;break}if(r._deleted.length>0||r._added.length>0||s){e=!0;break}}return e},this._addDeletesToChangeSet=function(e,t,r){for(var s=0;s<e._deleted.length;s++){var o=e._deleted[s];o&&(o.data&&void 0!==o.data._id&&null===e._beforeImage[o.data._id]||this._addDeletedRowToChangeSet(e,o,t,r))}},this._addDeletedRowToChangeSet=function(e,t,r,s){e._processed[t.data._id]=t.data,t.data["prods:rowState"]="deleted",void 0!==s&&(s.jsrecords.push(t),t._tableRef.trigger("beforeDelete",this,t,s),this.trigger("beforeDelete",this,t,s));var o={};o["prods:clientId"]=t.data._id,o["prods:rowState"]="deleted";var i=this._getTableInBeforeJsonObject(r,e._name);e._jsdo._copyRecord(e,e._beforeImage[t.data._id],o),delete o._id,i.push(o)},this._addCreatesToChangeSet=function(e,t,r){for(var s=0;s<e._added.length;s++){var o=e._added[s],i=e._findById(o,!1);i&&(e._processed[i.data._id]||this._addCreatedRowToChangeSet(e,i,t,r))}},this._addCreatedRowToChangeSet=function(e,t,r,s){e._processed[t.data._id]=t.data,r[e._name]||(r[e._name]=[]),t.data["prods:rowState"]="created",void 0!==s&&(s.jsrecords.push(t),t._tableRef.trigger("beforeCreate",this,t,s),this.trigger("beforeCreate",this,t,s));var o={};o["prods:clientId"]=t.data._id,o["prods:rowState"]="created",e._jsdo._copyRecord(e,t.data,o),delete o._id,r[e._name].push(o)},this._addChangesToChangeSet=function(e,t,r){for(var s in e._changed){var o=e._findById(s,!1);o&&(e._processed[o.data._id]||this._addChangedRowToChangeSet(e,o,t,r))}},this._addChangedRowToChangeSet=function(e,t,r,s){e._processed[t.data._id]=t.data,r[e._name]||(r[e._name]=[]),t.data["prods:rowState"]="modified",void 0!==s&&(s.jsrecords.push(t),t._tableRef.trigger("beforeUpdate",this,t,s),this.trigger("beforeUpdate",this,t,s));var o={};o["prods:id"]=t.data._id,o["prods:clientId"]=t.data._id,o["prods:rowState"]="modified",e._jsdo._copyRecord(e,t.data,o),delete o._id,r[e._name].push(o);var i=this._getTableInBeforeJsonObject(r,e._name),a={};a["prods:id"]=t.data._id,e._jsdo._copyRecord(e,e._beforeImage[t.data._id],a),i.push(a)},this._getTableInBeforeJsonObject=function(e,t){e["prods:before"]||(e["prods:before"]={});var r=e["prods:before"];return r[t]||(r[t]=[]),r[t]},this.addRecords=function(e,t,s,o,i){if(this.isDataSet()){if(e instanceof Array){if(!this._defaultTableRef)throw new Error(r.getMsgText("jsdoMSG998"))}else null==e&&(e={}),e[this._dataSetName]&&(e=e[this._dataSetName]);if(t!=progress.data.JSDO.MODE_EMPTY&&0===Object.keys(e).length)throw new Error(r.getMsgText("jsdoMSG006"));var a=this.useRelationships;this.useRelationships=!1;try{for(var n in this._buffers)e[this._buffers[n]._name]?this._addRecords(this._buffers[n]._name,e,t,s,o,i):t==progress.data.JSDO.MODE_EMPTY&&this._buffers[this._buffers[n]._name]._clearData()}finally{this.useRelationships=a}}else this._defaultTableRef&&this._addRecords(this._defaultTableRef._name,e,t,s,o,i)},this._copyRecord=function(e,t,r,s){for(var o in t)if(void 0===s||t[o]!=s[o])if(void 0===t[o]||null===t[o])r[o]=t[o];else if(t[o]instanceof Date)r[o]=t[o];else if("object"==typeof t[o]){var i=t[o]instanceof Array?[]:{};this._copyRecord(e,t[o],i),r[o]=i}else r[o]=t[o]},this._deleteProdsProperties=function(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=!0),e&&(delete e["prods:id"],delete e["prods:hasErrors"],delete e["prods:clientId"],delete e["prods:rejected"],delete e._rejected,r&&delete e["prods:rowState"],t&&delete e._errorString)},this._addRecords=function(e,t,s,o,i,a){var n=null,d=null;if(t&&void 0!==this._dataSetName&&(t[this._dataSetName]&&t[this._dataSetName]["prods:hasChanges"]?(n=t,d={}):t["prods:hasChanges"]&&((n={})[this._dataSetName]=t,d={})),"string"!=typeof e)throw new Error(r.getMsgText("jsdoMSG020"));if(!s)throw new Error(r.getMsgText("jsdoMSG021"));switch(s){case progress.data.JSDO.MODE_APPEND:case progress.data.JSDO.MODE_EMPTY:case progress.data.JSDO.MODE_MERGE:case progress.data.JSDO.MODE_REPLACE:break;default:throw new Error(r.getMsgText("jsdoMSG022"))}if(o?o instanceof Array||"object"!=typeof o||(o=o[e]?o[e]:[]):o=[],!(o instanceof Array))throw new Error(r.getMsgText("jsdoMSG008"));if(this._buffers[e]._fields)for(var h=0;h<o.length;h++){var l=this._buffers[e]._fields[o[h].toLowerCase()];if(void 0===l)throw new Error(r.getMsgText("jsdoMSG009",o[h]));o[h]=l.name}if(i=!!i,e){if(!(t instanceof Array)){var c=null;null==t&&(t={}),this.isDataSet()?t[this._dataSetName]?c=t[this._dataSetName][e]:t[e]&&(c=t[e]):this._dataProperty?c=t[this._dataProperty]:t.data&&(c=t.data),c instanceof Array?t=c:s==progress.data.JSDO.MODE_EMPTY&&"object"==typeof t&&0===Object.keys(t).length?t=[]:s==progress.data.JSDO.MODE_REPLACE&&"object"==typeof t&&n&&(t=[])}if(!(t instanceof Array))throw new Error(r.getMsgText("jsdoMSG005",e));var f=!1;try{if(this._buffers[e]._sortRecords=!1,0===o.length||s==progress.data.JSDO.MODE_EMPTY){s==progress.data.JSDO.MODE_EMPTY&&this._buffers[e]._clearData();for(h=0;h<t.length;h++){var u=this._buffers[e]._add(t[h],i,!1);t[h]._id=u.data._id,d&&t[h]["prods:id"]&&(d[t[h]["prods:id"]]=u.data._id),n&&this._deleteProdsProperties(u.data)}}else{var _;if(this._buffers[e]._data.length*t.length>=10){_={};for(h=0;h<this._buffers[e]._data.length;h++){if(S=this._buffers[e]._data[h])_[this._buffers[e]._getKey(S,o)]=S}}else _=null;var g=0!==Object.keys(this._buffers[e]._beforeImage).length;for(h=0;h<t.length;h++){var p=!1,S=null;if(_)p=void 0!==(S=_[this._buffers[e]._getKey(t[h],o)]);else for(var m=0;m<this._buffers[e]._data.length&&(!(S=this._buffers[e]._data[m])||!(p=this._buffers[e]._equalRecord(t[h],S,o)));m++);if(p){a&&void 0!==this._resource.idProperty&&void 0===t[h]._id&&(t[h]._id=S._id);var v=this._buffers[e]._beforeImage[S._id];if(g&&void 0!==t[h]["prods:id"]&&void 0!==v){var b=this._sameData(t[h],S),y=!0;if(v){var R=this._getBeforeRecordFromObject(t[h],n,e);R&&(y=this._sameData(R,v))}if(!b||!y)throw new Error(r.getMsgText("jsdoMSG032"))}switch(s){case progress.data.JSDO.MODE_APPEND:throw new Error(r.getMsgText("jsdoMSG023"));case progress.data.JSDO.MODE_MERGE:d&&t[h]["prods:id"]&&(d[t[h]["prods:id"]]=S._id);break;case progress.data.JSDO.MODE_REPLACE:d&&t[h]["prods:id"]&&(d[t[h]["prods:id"]]=S._id),void 0===t[h]._id&&(t[h]._id=S._id),this._copyRecord(this._buffers[e],t[h],S),this._deleteProdsProperties(S)}}else{u=this._buffers[e]._add(t[h],i,!1);if(t[h]._id=u.data._id,d&&t[h]["prods:id"]&&(d[t[h]["prods:id"]]=u.data._id),n&&this._deleteProdsProperties(u.data),_)_[this._buffers[e]._getKey(u.data,o)]=u.data}}_=null}f=!0}finally{this._buffers[e]._sortRecords=!0,this._buffers[e]._sort(),this._buffers[e]._createIndex(),f&&n&&this._buffers[e]._loadBeforeImageData(n,d,o)}}},this._getBeforeRecordFromObject=function(e,t,r){var s,o=t[this._dataSetName]["prods:before"],i=e["prods:id"];if(!o)return s;for(var a=0;a<o[r].length;a++){var n=o[r][a];if(n["prods:id"]&&i==n["prods:id"]){s=n;break}}return s},this._sameData=function(e,t){var r,s;for(var o in e)if("prods"!=o.substring(0,5)&&"_id"!=o){if((r=e[o])>(s=t[o])||null===r)return!1;if(r<s||null===s)return!1}return!0},this._mergeRead=function(e,t){if(this.isDataSet())if(this._dataProperty){var s=this._buffers[this._dataProperty];s._data=e[this._dataSetName][this._dataProperty],s.autoSort&&s._sort(),s._createIndex()}else{for(var o in this._buffers){if(a=(a=e[this._dataSetName]?e[this._dataSetName][o]:null)||[],this._fillMergeMode)switch(this.isDataSet()&&e[this._dataSetName]&&!e[this._dataSetName][this._buffers[o]._name]&&(e[this._dataSetName][this._buffers[o]._name]=[]),this._fillMergeMode){case progress.data.JSDO.MODE_APPEND:this._buffers[o].addRecords(e,progress.data.JSDO.MODE_APPEND);break;case progress.data.JSDO.MODE_MERGE:this._buffers[o].addRecords(e,progress.data.JSDO.MODE_MERGE,this._buffers[o]._primaryKeys);break;case progress.data.JSDO.MODE_REPLACE:this._buffers[o].addRecords(e,progress.data.JSDO.MODE_REPLACE,this._buffers[o]._primaryKeys);break;default:throw new Error(r.getMsgText("jsdoMSG022"))}else this._buffers[o]._data=a;this._buffers[o].autoSort&&this._buffers[o]._sort(),this._buffers[o]._createIndex(),e[this._dataSetName]&&e[this._dataSetName]["prods:hasChanges"]&&this._buffers[o]._loadBeforeImageData(e)}if(this._fillMergeMode=void 0,this._numBuffers>1)for(var o in this._buffers)if(this._buffers[o]._isNested&&this._buffers[o]._parent&&this._buffers[this._buffers[o]._parent]){for(var i=this._buffers[this._buffers[o]._parent]._data,a=[],n=0;n<i.length;n++)if(void 0!==i[n][o]){for(var d=0;d<i[n][o].length;d++)a.push(i[n][o][d]);delete i[n][o]}this._buffers[o]._data=a,this._buffers[o].autoSort&&this._buffers[o]._sort(),this._buffers[o]._createIndex()}}else e instanceof Array?this._defaultTableRef._data=e:this._dataProperty?this._defaultTableRef._data=e[this._dataProperty]:e.data?this._defaultTableRef._data=e.data:(this._defaultTableRef._data=[],this._defaultTableRef._data[0]=e);for(var o in this._buffers)this._buffers[o].autoSort&&this._buffers[o]._sort(),this._buffers[o]._createIndex()},this._mergeUpdateRecord=function(e,t,r){var s=e._index[t].index;if(r._id=t,e._data[s]||(e._data[s]={}),this._copyRecord(this._tableRef,r,e._data[s]),r=e._data[s],void 0!==e._jsdo._resource.idProperty){var o=e._data[s][e._jsdo._resource.idProperty];void 0!==o&&(o+="",delete e._index[t],null===e._beforeImage[t]&&(e._tmpIndex[t]=new progress.data.JSIndexEntry(s)),e._index[o]=new progress.data.JSIndexEntry(s),r._id=o)}return r},this._setErrorString=function(e,t,r,s){if(s)e._beforeImage[t]&&(e._beforeImage[t]._errorString=r);else{var o=e._index[t].index;e._data[o]._errorString=r}},this._arrayFromDataObject=function(e,t){var r;if(void 0!==e)return this._dataSetName?e[this._dataSetName]&&(r=e[this._dataSetName][t._name]):e instanceof Array?r=e:this._dataProperty?r=e[this._dataProperty]:e.data&&(r=e.data),r},this._mergeUpdateForCUD=function(e,t){var s,o=!1;if(this._dataSetName){var i=e[this._dataSetName],a=t.request.jsrecord._tableRef,n=this._arrayFromDataObject(e,a);if(n instanceof Array){if(n.length>1)throw t.request.success=!1,new Error(r.getMsgText("jsdoMSG100"));for(var d=0;d<n.length;d++){if(!(f=t.request.jsrecord.getId()))throw new Error(r.getMsgText("jsdoMSG034","_mergeUpdateForCUD()"));if(s=void 0,n[d]["prods:hasErrors"]){var h=n[d]["prods:id"];s=this._getErrorStringFromJsonObject(i,a,h),o=!0}var l=this._mergeUpdateRecord(a,f,n[d]);s&&this._setErrorString(a,f,s,!1),(n[d]["prods:rejected"]||s)&&(l._rejected=!0,"REJECTED"===s&&delete l._errorString),t.request.jsrecord=new progress.data.JSRecord(a,l)}}}else{a=this._defaultTableRef;var c=this._arrayFromDataObject(e);if(c instanceof Array){if(c.length>1)throw t.request.success=!1,new Error(r.getMsgText("jsdoMSG100"));for(d=0;d<c.length;d++){var f;if(!(f=t.request.jsrecord.getId()))throw new Error(r.getMsgText("jsdoMSG034","_mergeUpdateForCUD()"));l=this._mergeUpdateRecord(a,f,c[d]);t.request.jsrecord=new progress.data.JSRecord(a,l)}}}return o},this._checkForDeleteError=function(e,t){var s=!1,o=t.request.jsrecord._tableRef,i=e["prods:before"];if(i){var a=i[o._name];if(a.length>1)throw t.request.success=!1,new Error(r.getMsgText("jsdoMSG100"));var n=a[0]["prods:clientId"];if(!n)throw new Error(r.getMsgText("jsdoMSG035","_checkForDeleteError()"));if(a[0]["prods:hasErrors"]){var d=a[0]["prods:id"],h=this._getErrorStringFromJsonObject(e,o,d);this._setErrorString(o,n,h,!0),s=!0}}return s},this._mergeUpdateForSubmit=function(e,t){if(!this._dataSetName)throw new Error(r.getMsgText("jsdoMSG036","_mergeUpdateForSubmit()"));var s=e[this._dataSetName];s[this._dataSetName]&&(s=s[this._dataSetName]);var o=s["prods:before"];for(var i in this._buffers){var a=s[(f=this._buffers[i])._name];if(a instanceof Array)for(var n=0;n<a.length;n++){if(!(g=a[n]["prods:clientId"]))throw new Error(r.getMsgText("jsdoMSG035","_mergeUpdateForSubmit()"));if(u=void 0,a[n]["prods:hasErrors"]){var d=a[n]["prods:id"];u=this._getErrorStringFromJsonObject(s,f,d)}var h=this._mergeUpdateRecord(f,g,a[n]);u&&this._setErrorString(f,g,u,!1),(a[n]["prods:rejected"]||u)&&(h._rejected=!0,"REJECTED"===u&&delete h._errorString);for(var l=t.request.jsrecords,c=0;c<l.length;c++)if(l[c].data._id==g){l[c].data=h;break}}}if(o)for(var i in this._buffers){var f,u,_=o[(f=this._buffers[i])._name];if(_ instanceof Array)for(n=0;n<_.length;n++)if("deleted"==_[n]["prods:rowState"]){var g;if(!(g=_[n]["prods:clientId"]))throw new Error(r.getMsgText("jsdoMSG035","_mergeUpdateForSubmit()"));if(u=void 0,_[n]["prods:hasErrors"]){d=_[n]["prods:id"];u=this._getErrorStringFromJsonObject(s,f,d),this._setErrorString(f,g,u,!0)}(_[n]["prods:rejected"]||u)&&f._beforeImage[g]&&(f._beforeImage[g]._rejected=!0,"REJECTED"===u&&delete f._beforeImage[g]._errorString)}}},this._fireCUDTriggersForSubmit=function(e){for(var t=0;t<e.jsrecords.length;t++)this._deleteProdsProperties(e.jsrecords[t].data,!1,!1);for(t=0;t<e.jsrecords.length;t++){var r=e.jsrecords[t];switch(r.data["prods:rowState"]){case"created":r._tableRef.trigger("afterCreate",this,r,e.success,e),this.trigger("afterCreate",this,r,e.success,e);break;case"modified":r._tableRef.trigger("afterUpdate",this,r,e.success,e),this.trigger("afterUpdate",this,r,e.success,e);break;case"deleted":r._tableRef.trigger("afterDelete",this,r,e.success,e),this.trigger("afterDelete",this,r,e.success,e)}}},this._getErrorStringFromJsonObject=function(e,t,r){var s,o=e["prods:errors"];if(o&&(s=o[t._name]),s instanceof Array)for(var i=0;i<s.length;i++){if(s[i]["prods:id"]===r){var a=s[i]["prods:error"];return null===a?"Server returned unspecified error. Please check log files.":a}}},this._fillSuccess=function(e,t,r){var s,o,i=r.xhr;if((s=e.getMethodProperties("read"))&&s.mappingType){if(!(o=progress.data.PluginManager.getPlugin(s.mappingType)))throw new Error(progress.data._getMsgText("jsdoMSG118",s.mappingType));"function"==typeof o.responseMapping&&(r.response=o.responseMapping(e,r.response,{operation:"read"}))}for(var a in r.jsdo._fillMergeMode&&r.jsdo._fillMergeMode!==progress.data.JSDO.MODE_EMPTY||e._clearData(),e._mergeRead(r.response,i),e._buffers)e._buffers[a]._parent&&e.useRelationships||e._buffers[a]._setRecord(e._buffers[a]._findFirst())},this._fillComplete=function(e,t,r){e.trigger("afterFill",e,r.success,r),r.deferred&&(t?r.deferred.resolve(e,t,r):r.deferred.reject(e,t,r))},this._fillError=function(e,t,r){e._clearData(),e._updateLastErrors(e,null,null,r)},this._undoCreate=function(e,t){var r=e._index[t];if(void 0!==r){var s=r.index;e._data[s]=null}e._hasEmptyBlocks=!0,delete e._index[t],delete e._beforeImage[t]},this._undoUpdate=function(e,t,r){void 0===r&&(r=!1);var s=e._beforeImage[t];if(s){var o=e._index[t].index;e._jsdo._copyRecord(e,s,e._data[o]),r&&e._jsdo._deleteProdsProperties(e._data[o],!0)}delete e._beforeImage[t]},this._undoDelete=function(e,t,r){void 0===r&&(r=!1);var s=e._beforeImage[t];if(s){var o=s._index;delete s._index,r&&e._jsdo._deleteProdsProperties(s,!0),void 0!==o&&null===e._data[o]?e._data[o]=s:(e._data.push(s),o=e._data.length-1),e._index[t]=new progress.data.JSIndexEntry(o)}delete e._beforeImage[t]},this._deleteComplete=function(e,t,r){var s=r.xhr,o=r.jsrecord;try{e._deleteProdsProperties(o.data,!1),o._tableRef.trigger("afterDelete",e,o,r.success,r),e.trigger("afterDelete",e,o,r.success,r)}finally{r.complete=!0,e._checkSaveComplete(s)}},this._deleteSuccess=function(e,t,s){var o,i=s.xhr,a=s.response,n=null,d=null,h=!1;if(e._useBeforeImage("delete")?(n=(d=a[e._dataSetName])["prods:before"])&&(o=n[s.jsrecord._tableRef._name]):o=e._arrayFromDataObject(a,s.jsrecord._tableRef),o instanceof Array&&o.length>1)throw s.success=!1,new Error(r.getMsgText("jsdoMSG100"));n&&(h=e._checkForDeleteError(d,i)),h&&(s.success=!1),e.autoApplyChanges&&(h?e._deleteError(e,t,s):delete s.jsrecord._tableRef._beforeImage[s.jsrecord.data._id])},this._deleteError=function(e,t,r){e.autoApplyChanges&&e._undoDelete(r.jsrecord._tableRef,r.jsrecord.data._id)},this._createComplete=function(e,t,r){var s=r.xhr,o=r.jsrecord;try{e._deleteProdsProperties(o.data,!1),o._tableRef.trigger("afterCreate",e,o,r.success,r),e.trigger("afterCreate",e,o,r.success,r)}finally{r.complete=!0,e._checkSaveComplete(s)}},this._createSuccess=function(e,t,r){var s=r.xhr,o=r.response,i=e._mergeUpdateForCUD(o,s);i&&(r.success=!1),e.autoApplyChanges&&(i?e._createError(e,t,r):delete r.jsrecord._tableRef._beforeImage[r.jsrecord.data._id])},this._createError=function(e,t,r){e.autoApplyChanges&&e._undoCreate(r.jsrecord._tableRef,r.jsrecord.data._id)},this._updateComplete=function(e,t,r){var s=r.xhr,o=r.jsrecord;try{e._deleteProdsProperties(o.data,!1),o._tableRef.trigger("afterUpdate",e,o,r.success,r),e.trigger("afterUpdate",e,o,r.success,r)}finally{r.complete=!0,e._checkSaveComplete(s)}},this._updateSuccess=function(e,t,r){var s=r.xhr,o=e._mergeUpdateForCUD(r.response,s);o&&(r.success=!1),e.autoApplyChanges&&(o?e._updateError(e,t,r):(r.success=!0,delete r.jsrecord._tableRef._beforeImage[r.jsrecord.data._id]))},this._updateError=function(e,t,r){e.autoApplyChanges&&(r.success=!1,e._undoUpdate(r.jsrecord._tableRef,r.jsrecord.data._id))},this._saveChangesSuccess=function(e,t,r){var s=r.response;e._mergeUpdateForSubmit(s,r.xhr),e._clearErrors();var o=e.getChanges();e._updateLastErrors(e,null,o),e._setAllRecordsRejected(o),e.autoApplyChanges&&e._applyChanges()},this._saveChangesError=function(e,t,r){e._setAllRecordsRejected(!0),e.autoApplyChanges&&e.rejectChanges(),e._updateLastErrors(e,null,null,r)},this._saveChangesSuccessTT=function(e,t,r){var s;e._clearErrors(),s=e.getChanges(),e._updateLastErrors(e,null,s),e._setAllRecordsRejected(!1)},this._saveChangesComplete=function(e,t,r){r.xhr.status>=200&&r.xhr.status<300&&(e._lastErrors.length>0||e._someRecordsRejected)&&(r.success=!1),!0===e._useSubmit&&e._fireCUDTriggersForSubmit(r),e._undefWorkingRecord(),e._fireAfterSaveChanges(r.success,r)},this._fireAfterSaveChanges=function(e,t){this.trigger("afterSaveChanges",this,e,t),t.jsrecords?t.deferred&&(e?t.deferred.resolve(this,e,t):t.deferred.reject(this,e,t)):t.batch&&t.batch.deferred&&(e?t.batch.deferred.resolve(this,e,t):t.batch.deferred.reject(this,e,t));var r=this.autoApplyChanges;if(t.jsrecords)for(var s=0;s<t.jsrecords.length;s++){var o=t.jsrecords[s];r&&delete o.data._errorString,delete o.data["prods:rowState"]}else if(t.batch&&t.batch.operations)for(s=0;s<t.batch.operations.length;s++){o=t.batch.operations[s].jsrecord;r&&delete o.data._errorString}},this._getErrorsFromRequest=function(e){var t,r,s,o,i=[],a=[];if(e&&!e.success){if(e.xhr.status>=400&&e.xhr.status<600)try{var n=JSON.parse(e.xhr.responseText);for(n instanceof Array?a=n:n instanceof Object&&a.push(n),o=0;o<a.length;o+=1)if((t=a[o])._retVal?(i.push({type:progress.data.JSDO.RETVAL,error:t._retVal}),r=t._retVal):r=null,t._errors instanceof Array)for(s=0;s<t._errors.length;s+=1)0===t._errors[s]._errorNum&&t._errors[s]._errorMsg===r||i.push({type:progress.data.JSDO.APP_ERROR,error:t._errors[s]._errorMsg,errorNum:t._errors[s]._errorNum})}catch(e){}e.exception&&i.push({type:progress.data.JSDO.ERROR,error:e.exception}),0===i.length&&e.xhr&&e.xhr.status>=400&&e.xhr.status<600&&i.push({type:progress.data.JSDO.ERROR,error:"Error: HTTP Status "+e.xhr.status+" "+e.xhr.statusText,responseText:e.xhr.responseText})}return i},this._updateLastErrors=function(e,t,r,s){var o,i,a,n,d;if(t){if(void 0===t.operations)return;for(a=0;a<t.operations.length;a++)if(!(s=t.operations[a]).success&&s.xhr)if(s.xhr.status>=200&&s.xhr.status<300)e._lastErrors.push({errorString:s.jsrecord.data._errorString}),e._buffers[s.jsrecord._tableRef._name]._lastErrors.push({type:progress.data.JSDO.DATA_ERROR,id:s.jsrecord.data._id,error:s.jsrecord.data._errorString});else{for(o=this._getErrorsFromRequest(s),i="",n=0;n<o.length;n+=1)o.length>1&&-1!=o[n].error.indexOf("(7243)")||(!s.jsrecord||o[n].type!==progress.data.JSDO.APP_ERROR&&o[n].type!==progress.data.JSDO.RETVAL||(o[n].id=s.jsrecord.data._id,s.jsrecord._tableRef._lastErrors.push(o[n])),0===i.length?i=o[n].error:i+="\n"+o[n].error);e._lastErrors.push({errorString:i})}}else if(r instanceof Array)for(a=0;a<r.length;a++)r[a].record&&void 0!==r[a].record.data._errorString&&(e._lastErrors.push({errorString:r[a].record.data._errorString}),e._buffers[r[a].record._tableRef._name]._lastErrors.push({type:progress.data.JSDO.DATA_ERROR,id:r[a].record.data._id,error:r[a].record.data._errorString}));else if(s&&!s.success&&s.xhr&&(s.xhr.status>=400&&s.xhr.status<600||0===s.xhr.status)){for(o=this._getErrorsFromRequest(s),i="",n=0;n<o.length;n+=1)if(!(o.length>1&&-1!=o[n].error.indexOf("(7243)"))){for(d in this._buffers)this._buffers[d]._lastErrors.push(o[n]);0===i.length?i=o[n].error:i+="\n"+o[n].error}e._lastErrors.push({errorString:i})}},this._checkSaveComplete=function(e){if(e.request){var t=e.request.jsdo,r=e.request.batch;if(t&&r&&t._async&&t._isBatchComplete(r)){var s=t._isBatchSuccess(r),o={batch:r,success:s};t._undefWorkingRecord(),t._lastErrors=[],!s&&r.operations&&t._updateLastErrors(t,r,null),this._setAllRecordsRejected(r),t._fireAfterSaveChanges(s,o)}}},this._isBatchSuccess=function(e){if(e.operations)for(var t=0;t<e.operations.length;t++)if(!e.operations[t].success)return!1;return!0},this._isBatchComplete=function(e){if(e.operations)for(var t=0;t<e.operations.length;t++){if(!e.operations[t].complete)return!1}return!0},this._mergeInvoke=function(e,t){var s,o;if(void 0===(s=void 0!==t.request.fnName&&void 0!==t.jsdo._resource.fn[t.request.fnName]?t.jsdo._resource.fn[t.request.fnName].operation:null)){for(s=null,o=0;o<t.jsdo._resource.operations.length;o++)if(t.jsdo._resource.operations[o].name==t.request.fnName){s=t.jsdo._resource.operations[o];break}t.jsdo._resource.fn[t.request.fnName].operation=s}if(null!==s&&s.mergeMode)try{var i,a=progress.data.JSDO["MODE_"+s.mergeMode.toUpperCase()];if(null===a)throw new Error(r.getMsgText("jsdoMSG030","mergeMode property","EMPTY, APPEND, MERGE or REPLACE"));if(void 0===t.jsdo._resource.idProperty)throw new Error(r.getMsgText("jsdoMSG110",this._resource.name," by mergeMode property in invoke operation"));if(t.jsdo.isDataSet())i=t.jsdo._resource._dataSetName;else if(void 0!==t.jsdo._resource.dataProperty)i=t.jsdo._resource.dataProperty;else{if(void 0===t.jsdo._resource._tempTableName)throw new Error(r.getMsgText("jsdoMSG111",""));i=t.jsdo._resource._tempTableName}var n=!1;for(o=0;o<s.params.length;o++)if(s.params[o].name==i&&-1!=s.params[o].type.indexOf("RESPONSE_BODY")){if(void 0!==s.params[o].xType&&"DATASET"!=s.params[o].xType&&"TABLE"!=s.params[o].xType&&"ARRAY"!=s.params[o].xType)throw new Error(r.getMsgText("jsdoMSG113",s.params[o].xType,i,t.request.fnName));n=!0;break}if(!n)throw new Error(r.getMsgText("jsdoMSG112",i,t.request.fnName));t.jsdo.addRecords(t.request.response[i],a,[t.jsdo._resource.idProperty],!1,!0)}catch(e){t.request.success=!1,t.request.exception=e}},this.onReadyStateChangeGeneric=function(){var e=this;if(4==e.readyState){var t=e.request;try{t.response=JSON.parse(e.responseText),t.response&&t.response.response&&(t.response=t.response.response)}catch(e){t.response=void 0}try{var s;if(e.status>=200&&e.status<300||0===e.status&&""!==e.responseText){if(t.success=!0,e.jsdo._session._saveClientContextId(e),"function"==typeof e.onSuccessFn)(void 0===(s=void 0!==e.request.fnName&&void 0!==e.jsdo._resource.fn[e.request.fnName]?e.jsdo._resource.fn[e.request.fnName].operation:null)||null!==s&&s.mergeMode)&&e.jsdo._mergeInvoke(t.response,e),t.success?e.onSuccessFn(e.jsdo,t.success,t):"function"==typeof e.onErrorFn&&e.onErrorFn(e.jsdo,t.success,t)}else t.success=!1,0===e.status&&(t.exception=new Error(r.getMsgText("jsdoMSG101"))),"function"==typeof e.onErrorFn&&e.onErrorFn(e.jsdo,t.success,t)}catch(r){t.success=!1,t.exception=r,"function"==typeof e.onErrorFn&&e.onErrorFn(e.jsdo,t.success,t)}e.jsdo._session._checkServiceResponse(e,t.success,t),"function"==typeof e.onCompleteFn&&e.onCompleteFn(e.jsdo,t.success,t)}},this.acceptChanges=function(){for(var e in this._buffers)this._buffers[this._buffers[e]._name].acceptChanges()},this.rejectChanges=function(){for(var e in this._buffers)this._buffers[this._buffers[e]._name].rejectChanges()},this.getChanges=function(){var e=[];for(var t in this._buffers){var r=this._buffers[this._buffers[t]._name].getChanges();e=e.concat(r)}return e},this.hasChanges=function(){for(var e in this._buffers)if(this._buffers[this._buffers[e]._name].hasChanges())return!0;return!1},this._applyChanges=function(){for(var e in this._buffers)this._buffers[this._buffers[e]._name]._applyChanges()},this.acceptRowChanges=function(){if(this._defaultTableRef)return this._defaultTableRef.acceptRowChanges();throw new Error(r.getMsgText("jsdoMSG001","acceptRowChanges()"))},this.rejectRowChanges=function(){if(this._defaultTableRef)return this._defaultTableRef.rejectRowChanges();throw new Error(r.getMsgText("jsdoMSG001","rejectRowChanges()"))},this.setProperties=function(e){var t;if(arguments.length<1)throw new Error(progress.data._getMsgText("jsdoMSG122","JSDO","setProperties",1));if(arguments.length>1)throw new Error(progress.data._getMsgText("jsdoMSG122","JSDO","setProperties",1));if("object"==typeof e)for(t in this._properties={},e)e.hasOwnProperty(t)&&"function"!=typeof e[t]&&(this._properties[t]=e[t]);else{if(null!=e)throw new Error(progress.data._getMsgText("jsdoMSG121","JSDO",1,"Object","setProperties"));this._properties={}}},this.setProperty=function(e,t){if(arguments.length<2)throw new Error(progress.data._getMsgText("jsdoMSG122","JSDO","setProperty",2));if(2!==arguments.length)throw new Error(progress.data._getMsgText("jsdoMSG122","JSDO","setProperty",2));if("string"!=typeof e)throw new Error(progress.data._getMsgText("jsdoMSG121","JSDO",1,"string","setProperty"));void 0===t?delete this._properties[e]:this._properties[e]=t},this.getProperties=function(){if(arguments.length>0)throw new Error(progress.data._getMsgText("jsdoMSG122","JSDO","getProperties",0));return this._properties},this.getProperty=function(e){if(arguments.length<1)throw new Error(progress.data._getMsgText("jsdoMSG122","JSDO","getProperty",1));if(arguments.length>1)throw new Error(progress.data._getMsgText("jsdoMSG122","JSDO","getProperty",1));return this._properties[e]},this.saveLocal=function(e,t){var s,o;if(arguments.length>2)throw new Error(r.getMsgText("jsdoMSG024","JSDO",arguments.callee.name+"()"));if("string"==typeof e||null==e?(s=e,o=t):(s=null,o=e),null!=s&&""!==s||(s="jsdo_"+this._resource.service.name+"_"+this._resource.name),void 0===o)o=progress.data.JSDO.ALL_DATA;else switch(o){case progress.data.JSDO.ALL_DATA:case progress.data.JSDO.CHANGES_ONLY:break;default:throw new Error(r.getMsgText("jsdoMSG115",arguments.callee.name))}null===this._localStorage&&(this._localStorage=new progress.data.LocalStorage);var i=this._prepareDataObjectForLocalStorage(o);this._localStorage.saveToLocalStorage(s,i)},this.readLocal=function(e){if(arguments.length>1)throw new Error(r.getMsgText("jsdoMSG024","JSDO",arguments.callee.name+"()"));if(null==e||""===e)e="jsdo_"+this._resource.service.name+"_"+this._resource.name;else if("string"!=typeof e)throw new Error(r.getMsgText("jsdoMSG116","name",arguments.callee.name+"()"));null===this._localStorage&&(this._localStorage=new progress.data.LocalStorage);var t=this._localStorage.readFromLocalStorage(e);if(t){if(!1===this._hasMatchingSchema(t))throw new Error(r.getMsgText("jsdoMSG117",e));this._restoreFromLocalStorage(t,progress.data.JSDO.MODE_EMPTY)}return null!==t},this.addLocalRecords=function(e,t,s){var o,i,a;if(arguments.length<1)throw new Error(r.getMsgText("jsdoMSG024","JSDO",arguments.callee.name+"()"));if("string"==typeof e?(o=e,i=t,a=s):(o="jsdo_"+this._resource.service.name+"_"+this._resource.name,i=e,a=t),null==o||""===o)o="jsdo_"+this._resource.service.name+"_"+this._resource.name;else if("string"!=typeof o)throw new Error(r.getMsgText("jsdoMSG116","name",arguments.callee.name+"()"));if(i!=progress.data.JSDO.MODE_REPLACE)throw new Error(r.getMsgText("jsdoMSG115",arguments.callee.name));null===this._localStorage&&(this._localStorage=new progress.data.LocalStorage);var n=this._localStorage.readFromLocalStorage(o);if(n){if(!1===this._hasMatchingSchema(n))throw new Error(r.getMsgText("jsdoMSG117",o));try{this._restoreFromLocalStorage(n,i,a)}catch(e){var d=e.message;throw new Error(d.replace(new RegExp("addRecords","g"),"addLocalRecords"))}}return null!==n},this._containsPrimaryKeys=function(){for(var e in this._buffers)if(null===this._buffers[e]._primaryKeys)return!1;return!0},this._hasMatchingSchema=function(e){var t=!0;if(null===e||0===Object.keys(e).length)return!0;if(this._dataSetName)if(e[this._dataSetName]){for(var r in this._buffers)if(void 0===e[this._dataSetName][r]){t=!1;break}}else t=!1;else this._dataProperty?void 0!==(e=e._localStorage)&&void 0!==e[this._dataProperty]||(t=!1):void 0!==(e=e._localStorage)&&void 0!==e[this._defaultTableRef._name]||(t=!1);return t},this.deleteLocal=function(e){if(arguments.length>1)throw new Error(r.getMsgText("jsdoMSG024","JSDO",arguments.callee.name+"()"));if(null==e||""===e)e="jsdo_"+this._resource.service.name+"_"+this._resource.name;else if("string"!=typeof e)throw new Error(r.getMsgText("jsdoMSG116","name",arguments.callee.name+"()"));null===this._localStorage&&(this._localStorage=new progress.data.LocalStorage),this._localStorage.clearLocalStorage(e)},this._prepareDataObjectForLocalStorage=function(e){var t={};if(this._dataSetName)switch(e){case progress.data.JSDO.ALL_DATA:t=this._createDataAndChangeSet(this._dataSetName);break;case progress.data.JSDO.CHANGES_ONLY:t=this._createChangeSet(this._dataSetName,!0)}else if(this._dataProperty)switch(e){case progress.data.JSDO.ALL_DATA:t=this._createDataAndChangeSet("_localStorage");break;case progress.data.JSDO.CHANGES_ONLY:t=this._createChangeSet("_localStorage",!0)}else switch(e){case progress.data.JSDO.ALL_DATA:t=this._createDataAndChangeSet("_localStorage");break;case progress.data.JSDO.CHANGES_ONLY:t=this._createChangeSet("_localStorage",!0)}return t},this._restoreFromLocalStorage=function(e,t,r){if(e&&Object.keys(e).length>0)if(this._dataSetName)for(var s in this._buffers)this._restoreDataForTable(this._buffers[s],e,t,r);else this._restoreDataForTable(this._defaultTableRef,e,t,r);else t===progress.data.JSDO.MODE_EMPTY&&this._clearData()},this._restoreDataForTable=function(e,t,r,s){if(void 0===(s=void 0!==s?s:e._primaryKeys)&&this._resource.idProperty&&((s=[])[0]=this._resource.idProperty),this._dataSetName){var o=this.useRelationships;this.useRelationships=!1;try{e.addRecords(t,r,s)}finally{this.useRelationships=o}}else this._dataSetName="_localStorage",e.addRecords(t,r,s),this._dataSetName=null},this.getMethodProperties=function(e,t){if(this._resource._operations){if(this._resource._operations[e])return this._resource._operations[e]}else this._resource._operations={};for(var r=0;r<this._resource.operations.length;r++)if(this._resource.operations[r].type==e)return this._resource._operations[e]=this._resource.operations[r]},i&&this.fill()},"function"==typeof Object.defineProperty?(Object.defineProperty(progress.data.JSDO,"MODE_APPEND",{value:1,enumerable:!0}),Object.defineProperty(progress.data.JSDO,"MODE_EMPTY",{value:2,enumerable:!0}),Object.defineProperty(progress.data.JSDO,"MODE_MERGE",{value:3,enumerable:!0}),Object.defineProperty(progress.data.JSDO,"MODE_REPLACE",{value:4,enumerable:!0}),Object.defineProperty(progress.data.JSDO,"ERROR",{value:-1,enumerable:!0}),Object.defineProperty(progress.data.JSDO,"APP_ERROR",{value:-2,enumerable:!0}),Object.defineProperty(progress.data.JSDO,"RETVAL",{value:-3,enumerable:!0}),Object.defineProperty(progress.data.JSDO,"DATA_ERROR",{value:-4,enumerable:!0})):(progress.data.JSDO.MODE_APPEND=1,progress.data.JSDO.MODE_EMPTY=2,progress.data.JSDO.MODE_MERGE=3,progress.data.JSDO.MODE_REPLACE=4),progress.data.JSDO._OP_CREATE=1,progress.data.JSDO._OP_READ=2,progress.data.JSDO._OP_UPDATE=3,progress.data.JSDO._OP_DELETE=4,progress.data.JSDO._OP_SUBMIT=5,progress.data.JSDO.ALL_DATA=1,progress.data.JSDO.CHANGES_ONLY=2,progress.data.JSDO.ARRAY_INDEX_SEPARATOR="_",progress.data.JSDO.prototype=new progress.util.Observable,progress.data.JSDO.prototype.constructor=progress.data.JSDO,progress.data.JSDO.prototype.toString=function(e){return"JSDO"},progress.data.JSTableRef.prototype=new progress.util.Observable,progress.data.JSTableRef.prototype.constructor=progress.data.JSTableRef,progress.data.JSTableRef.prototype.toString=function(e){return"JSTableRef"},progress.data.PluginManager.addPlugin("JFP",{requestMapping:function(e,t,s){var o,i,a,n,d,h,l,c,f,u,_,g,p,S,m={filter:{options:["ablFilter","sqlQuery"],mapping:void 0},top:{options:["top"],mapping:void 0},skip:{options:["skip"],mapping:void 0},id:{options:["id"],mapping:void 0},sort:{options:["orderBy"],mapping:void 0}},v=!0;if("read"===s.operation){if(p={},f=e.getMethodProperties(s.operation).capabilities)for(f=f.replace(/\s/g,"").split(","),u=0;u<f.length;u+=1)p[f[u]]=!0;for(S in t)if(S&&void 0!==t[S]&&m[S]){for(u=0;u<m[S].options.length;u+=1)if(p[g=m[S].options[u]]){m[S].mapping=g;break}if(!m[S].mapping)throw new Error(r.getMsgText("jsdoMSG120",m[S].options.join("' or '"),S))}if(d=e._defaultTableRef&&void 0===t.tableRef?e._defaultTableRef._name:t.tableRef,t.sort)for("object"!=typeof t.sort||t.sort instanceof Array||(t.sort=Object.keys(t.sort).length>1?[t.sort]:[]),o="",u=0;u<t.sort.length;u+=1){if(h="","string"==typeof(i=t.sort[u])){if(a=i,-1!==(_=i.indexOf(":")))switch(h=a.substring(_+1),a=a.substring(0,_),h.toLowerCase()){case"desc":case"descending":h="desc"}}else a=i.field,"desc"===t.sort[u].dir&&(h=t.sort[u].dir);d&&(n=e[d]._fields[a.toLowerCase()])&&n.origName&&(a=n.origName),"desc"===h&&(a+=" DESC"),o+=a,u<t.sort.length-1&&(o+=",")}if("object"!=typeof t.filter||t.filter instanceof Array||(t.filter=Object.keys(t.filter).length>=1?t.filter:void 0),t.filter){if("string"==typeof t.filter&&(v=!1),t.tableRef=d,v&&void 0===t.tableRef)throw new Error(r.getMsgText("jsdoMSG045","fill() or read()","params","tableRef"));"ablFilter"===m.filter.mapping?l=v?progress.util._convertToABLWhereString(e._buffers[t.tableRef],t.filter):t.filter:"sqlQuery"===m.filter.mapping&&(c=v?progress.util._convertToSQLQueryString(e._buffers[t.tableRef],t.filter,!0):t.filter)}t={filter:JSON.stringify({ablFilter:l,sqlQuery:c,orderBy:o,skip:t.skip,top:t.top,id:t.id})}}return t}}),void 0===progress.ui&&(progress.ui={}),progress.ui.UITableRef=function(e){this._tableRef=e,this._listview=null,this._detailPage=null,this._listviewContent=void 0,this.addItem=function(e){var t;if(!this._tableRef.record)throw new Error(r.getMsgText("jsdoMSG002",this._name));if(this._listview){e=e||this._listview.format,t=this._detailPage&&this._detailPage.name?this._detailPage.name:"",void 0===this._listviewContent&&this.clearItems();var s=this._listview.itemTemplate?this._listview.itemTemplate:progress.ui.UIHelper._itemTemplate;for(var o in s=(s=(s=s.replace(new RegExp("{__format__}","g"),e)).replace(new RegExp("{__id__}","g"),this._tableRef.record.data._id)).replace(new RegExp("{__page__}","g"),t),this._tableRef.record.data){var i=this._tableRef.record.data[o];s=s.replace(new RegExp("{"+o+"}","g"),null!=i?i:"")}this._listviewContent+=s}},this.clearItems=function(){if(this._listview){this._listviewContent="";var e=document.getElementById(this._listview.name);e&&(e.innerHTML="")}},this._getFormFieldValue=function(e,t){var r,s=null;return void 0===t&&this._detailPage&&this._detailPage.name&&(t=this._detailPage.name),"function"==typeof $&&t?((r=$("#"+t+" #"+e))&&0!==r.length||(r=$("#"+t+' [dsid="'+e+'"]')),r&&1==r.length&&(s=r.val())):(r=document.getElementById(e))&&(s=r.value),s},this._setFormField=function(e,t,r){var s=null;void 0===r&&this._detailPage&&this._detailPage.name&&(r=this._detailPage.name),"function"==typeof $&&r?((s=$("#"+r+" #"+e))&&0!==s.length||(s=$("#"+r+' [dsid="'+e+'"]')),s&&1==s.length&&s.val(t)):(s=document.getElementById(e))&&(s.value=t)},this.assign=function(e){if(!this._tableRef.record)throw new Error(r.getMsgText("jsdoMSG002",this._tableRef._name));if(0!==arguments.length&&"string"!=typeof e)throw new Error(r.getMsgText("jsdoMSG024","UIHelper","assign()"));var t;this._tableRef.record.assign(null);for(var s=this._tableRef.getSchema(),o=0;o<s.length;o++)if("_id"!=(t=s[o].name)){var i=this._getFormFieldValue(t,e);void 0!==i&&("string"==typeof i&&"string"!=s[o].type&&(i=this._tableRef._jsdo._convertType(i,s[o].type,s[o].items?s[o].items.type:null)),this._tableRef.record.data[t]=i)}return this._tableRef.record._sortRecord(),!0},this.display=function(e){if(!this._tableRef.record)throw new Error(r.getMsgText("jsdoMSG002",this._tableRef._name));for(var t=this._tableRef.getSchema(),s=0;s<t.length;s++)this._setFormField(t[s].name,this._tableRef.record.data[t[s].name],e);this._setFormField("_id",this._tableRef.record.data._id,e)},this.showListView=function(){if(this._listview){var e,t=this;if("function"==typeof $){if((e=$("#"+this._listview.name))&&1==e.length){e.html(this._listviewContent?this._listviewContent:"");try{"true"===e.attr("data-filter")&&"function"==typeof e.filterable?e.filterable("refresh"):e.listview("refresh")}catch(e){}}this._listview.autoLink&&$("#"+this._listview.name+" li").each(function(){$(this).bind("click",function(){var e=t.getListViewRecord(this);t.display(),"function"==typeof t._listview.onSelect&&t._listview.onSelect(event,this,e)})})}else if((e=document.getElementById(this._listview.name))&&(e.innerHTML=this._listviewContent),this._listview.autoLink){var r=document.getElementById(this._listview.name);if(r&&r.childElementCount>0)for(var s=0;s<r.children.length;s++)r.children[s].onclick=function(){var e=this.getListViewRecord(this);this.display(),"function"==typeof t._listview.onSelect&&t._listview.onSelect(event,this,e)}}this._listviewContent=void 0}},this.getFormFields=function(e){var t,r;if(!this._tableRef._schema)return"";if(e instanceof Array){var s={};for(t=0;t<e.length;t++)s[e[t]]=e[t];e=s}else e=null;for(r=!e||e._id?'<input type="hidden" id="_id" name="_id" value="" />':"",r+='<fieldset data-role="controlgroup">',t=0;t<this._tableRef._schema.length;t++){var o=this._tableRef._schema[t].name;if("_id"!=o&&!(o.length>0&&"_"==o.charAt(0)||e&&void 0===e[o])){var i=this._tableRef._schema[t].title?this._tableRef._schema[t].title:this._tableRef._schema[t].name,a=this._detailPage&&this._detailPage.fieldTemplate?this._detailPage.fieldTemplate:progress.ui.UIHelper._fieldTemplate;r+=a=(a=a.replace(new RegExp("{__label__}","g"),i)).replace(new RegExp("{__name__}","g"),this._tableRef._schema[t].name)}}return e=null,r+="</fieldset>"},this.getListViewRecord=function(e){var t=e.getAttribute("data-id");return this._tableRef.findById(t)},this.getFormRecord=function(e){var t=this._getFormFieldValue("_id",e);return this._tableRef.findById(t)},this._getIdOfElement=function(e){if("function"==typeof $){var t=$("#"+e);if((!t||0===t.length)&&(t=$('[dsid="'+e+'"]'))&&1==t.length){var r=t.attr("id");if(r)return r}}return e},this.setDetailPage=function(e){if(!e||"object"!=typeof e)throw new Error(r.getMsgText("jsdoMSG012",arguments.callee.name,"object"));if(!e.name||"string"!=typeof e.name)throw new Error(r.getMsgText("jsdoMSG012",arguments.callee.name,"name"));this._detailPage=e,this._detailPage.name=this._getIdOfElement(this._detailPage.name)},this.setListView=function(e){if(!e||"object"!=typeof e)throw new Error(r.getMsgText("jsdoMSG012",arguments.callee.name,"object"));if(!e.name||"string"!=typeof e.name)throw new Error(r.getMsgText("jsdoMSG012",arguments.callee.name,"name"));if(e.format&&"string"!=typeof e.name)throw new Error(r.getMsgText("jsdoMSG012",arguments.callee.name,"format"));if(this._listview=e,this._listview.name=this._getIdOfElement(this._listview.name),!this._listview.format){if("function"==typeof $)for(var t=0;t<this._tableRef._schema.length;t++){var s=this._tableRef._schema[t].name,o=$("#"+this._listview.name+' [dsid="'+s+'"]');o&&1==o.length&&o.html("{"+s+"}")}var i=document.getElementById(this._listview.name).innerHTML,a=i.indexOf("<li ");-1!=a&&(i=i.substring(0,a)+'<li data-id="{__id__}"'+i.substring(a+3)),this._listview.itemTemplate=i}}},progress.ui.UIHelper=function(){if("object"==typeof arguments[0]){var e=arguments[0];for(var t in e)"jsdo"==t?this._jsdo=e[t]:this[t]=e[t]}this._defaultUITableRef=null,this._uiTableRef={};var s=0;for(var o in this._jsdo._buffers)this[o]=this._uiTableRef[o]=new progress.ui.UITableRef(this._jsdo._buffers[o]),this._defaultUITableRef||(this._defaultUITableRef=this._uiTableRef[o]),s++;1!=s&&(this._defaultUITableRef=null),this.addItem=function(e){if(!this._defaultUITableRef)throw new Error(r.getMsgText("jsdoMSG011","addItem()"));this._defaultUITableRef.addItem(e)},this.clearItems=function(){if(!this._defaultUITableRef)throw new Error(r.getMsgText("jsdoMSG011","clearItems()"));this._defaultUITableRef.clearItems()},this.assign=function(e){if(0!==arguments.length)throw new Error(r.getMsgText("jsdoMSG024","UIHelper","assign()"));if(this._defaultUITableRef)return this._defaultUITableRef.assign(e);throw new Error(r.getMsgText("jsdoMSG011","assign()"))},this.display=function(e){if(!this._defaultUITableRef)throw new Error(r.getMsgText("jsdoMSG011","display()"));this._defaultUITableRef.display(e)},this.showListView=function(){if(!this._defaultUITableRef)throw new Error(r.getMsgText("jsdoMSG011","showListView()"));this._defaultUITableRef.showListView()},this.getFormFields=function(e){if(this._defaultUITableRef)return this._defaultUITableRef.getFormFields(e);throw new Error(r.getMsgText("jsdoMSG011","getFormFields()"))},this.getListViewRecord=function(e){if(this._defaultUITableRef)return this._defaultUITableRef.getListViewRecord(e);throw new Error(r.getMsgText("jsdoMSG011","getListViewRecord()"))},this.getFormRecord=function(e){if(this._defaultUITableRef)return this._defaultUITableRef.getFormRecord(e);throw new Error(r.getMsgText("jsdoMSG011","getFormRecord()"))},this.setDetailPage=function(e){if(this._defaultUITableRef)return this._defaultUITableRef.setDetailPage(e);throw new Error(r.getMsgText("jsdoMSG011","setDetailPage()"))},this.setListView=function(e){if(this._defaultUITableRef)return this._defaultUITableRef.setListView(e);throw new Error(r.getMsgText("jsdoMSG011","setListView()"))}},progress.ui.UIHelper._defaultItemTemplate='<li data-theme="c" data-id="{__id__}"><a href="#{__page__}" class="ui-link" data-transition="slide">{__format__}</a></li>',progress.ui.UIHelper._defaultFieldTemplate='<div data-role="fieldcontain"><label for="{__name__}">{__label__}</label><input id="{__name__}" name="{__name__}" placeholder="" value="" type="text" /></div>',progress.ui.UIHelper._itemTemplate=progress.ui.UIHelper._defaultItemTemplate,progress.ui.UIHelper._fieldTemplate=progress.ui.UIHelper._defaultFieldTemplate,progress.ui.UIHelper.setItemTemplate=function(e){progress.ui.UIHelper._itemTemplate=e||progress.ui.UIHelper._defaultItemTemplate},progress.ui.UIHelper.setFieldTemplate=function(e){progress.ui.UIHelper._fieldTemplate=e||progress.ui.UIHelper._defaultFieldTemplate}}(),function(){"use strict";"undefined"==typeof progress&&(progress={}),void 0===progress.data&&(progress.data={}),progress.data.AuthenticationProvider=function(e){var t;if("object"!=typeof e)throw new Error(progress.data._getMsgText("jsdoMSG033","AuthenticationProvider","the constructor","The init-object argument was missing or invalid."));switch(this._checkStringArg("constructor",e.authenticationModel,"initObject.authenticationModel","initObject.authenticationModel"),this._checkStringArg("constructor",e.uri,"init-object.uri","init-object.uri"),e.authenticationModel.toLowerCase()){case progress.data.Session.AUTH_TYPE_ANON:this._initialize(e.uri,progress.data.Session.AUTH_TYPE_ANON,{_loginURI:progress.data.AuthenticationProvider._homeLoginURIBase}),t=this;break;case progress.data.Session.AUTH_TYPE_BASIC:t=new progress.data.AuthenticationProviderBasic(e.uri);break;case progress.data.Session.AUTH_TYPE_FORM:t=new progress.data.AuthenticationProviderForm(e.uri);break;case progress.data.Session.AUTH_TYPE_FORM_SSO:t=new progress.data.AuthenticationProviderSSO(e.uri);break;default:throw new Error(progress.data._getMsgText("jsdoMSG502","AuthenticationProvider","init-object","constructor","authenticationModel"))}return t},progress.data.AuthenticationProvider.prototype._loginProto=function(e){var t,r,s=new progress.util.Deferred,o=this;try{if(this._loggedIn)throw new Error(progress.data._getMsgText("jsdoMSG051","AuthenticationProvider"));(t=new XMLHttpRequest).onreadystatechange=function(){4===t.readyState&&o._processLoginResult(t,s)},r=progress.data.Session._useTimeStamp?progress.data.Session._addTimeStampToURL(this._loginURI):this._loginURI,this._openLoginRequest(t,r),t.setRequestHeader("Accept","application/json"),t.send(e)}catch(e){if(progress.util.Deferred.useJQueryPromises)throw e;s.reject(this,progress.data.Session.GENERAL_FAILURE,{errorObject:e})}return s.promise()},progress.data.AuthenticationProvider.prototype.login=function(){return this._loginProto()},progress.data.AuthenticationProvider.prototype._openLoginRequest=function(e,t){e.open("GET",t,!0),progress.data.Session._setNoCacheHeaders(e)},progress.data.AuthenticationProvider.prototype._processLoginResult=function(e,t){var r;200===e.status?(this._loggedIn=!0,this._storeInfo(),r=progress.data.Session.SUCCESS):r=401===e.status?progress.data.Session.AUTHENTICATION_FAILURE:progress.data.Session.GENERAL_FAILURE,this._settlePromise(t,r,{xhr:e})},progress.data.AuthenticationProvider.prototype.logout=function(){var e=new progress.util.Deferred;try{this._reset(),e.resolve(this,progress.data.Session.SUCCESS,{})}catch(t){if(progress.util.Deferred.useJQueryPromises)throw t;e.reject(this,progress.data.Session.GENERAL_FAILURE,{errorObject:t})}return e.promise()},progress.data.AuthenticationProvider.prototype.hasClientCredentials=function(){return this._loggedIn},progress.data.AuthenticationProvider.prototype.hasRefreshToken=function(){return!1},progress.data.AuthenticationProvider.prototype._openRequestAndAuthorize=function(e,t,r,s,o){this.hasClientCredentials()?(e.open(t,r,s),e.setRequestHeader("Accept","application/json"),o(e)):o(new Error(progress.data._getMsgText("jsdoMSG125","AuthenticationProvider")))},progress.data.AuthenticationProvider.prototype._initialize=function(e,t,r){var s,o;for(o in Object.defineProperty(this,"uri",{get:function(){return this._uri},enumerable:!0}),Object.defineProperty(this,"authenticationModel",{get:function(){return this._authenticationModel},enumerable:!0}),s="/"===e[e.length-1]?e.substring(0,e.length-1):e,r)r.hasOwnProperty(o)&&(this[o]=s+r[o]);if(this._authenticationModel=t,this._uri=e,this._loggedIn=!1,this._dataKeys={uri:".uri",loggedIn:".loggedIn"},"undefined"==typeof sessionStorage)throw new Error(progress.data._getMsgText("jsdoMSG126","AuthenticationProvider","sessionStorage"));this._storage=sessionStorage,this._storageKey=this._uri,this._dataKeys.uri=this._storageKey+this._dataKeys.uri,this._dataKeys.loggedIn=this._storageKey+this._dataKeys.loggedIn,this._retrieveLoggedIn()&&(this._loggedIn=!0)},progress.data.AuthenticationProvider.prototype._storeInfo=function(){this._storage.setItem(this._dataKeys.uri,JSON.stringify(this._uri)),this._storage.setItem(this._dataKeys.loggedIn,JSON.stringify(this._loggedIn))},progress.data.AuthenticationProvider.prototype._retrieveInfoItem=function(e){var t=this._storage.getItem(e),r=null;if(null!==t)try{r=JSON.parse(t)}catch(e){r=null}return r},progress.data.AuthenticationProvider.prototype._retrieveURI=function(){return this._retrieveInfoItem(this._dataKeys.uri)},progress.data.AuthenticationProvider.prototype._retrieveLoggedIn=function(){return this._retrieveInfoItem(this._dataKeys.loggedIn)},progress.data.AuthenticationProvider.prototype._clearInfo=function(e){this._storage.removeItem(this._dataKeys.uri),this._storage.removeItem(this._dataKeys.loggedIn)},progress.data.AuthenticationProvider.prototype._reset=function(){this._clearInfo(),this._loggedIn=!1},progress.data.AuthenticationProvider.prototype._settlePromise=function(e,t,r){t===progress.data.Session.SUCCESS?e.resolve(this,t,r):e.reject(this,t,r)},progress.data.AuthenticationProvider.prototype._checkStringArg=function(e,t,r,s){if("string"!=typeof t)throw new Error(progress.data._getMsgText("jsdoMSG121","AuthenticationProvider",r,"string",e));if(0===t.length)throw new Error(progress.data._getMsgText("jsdoMSG501","AuthenticationProvider",s,e))},progress.data.AuthenticationProvider._getAuthFailureReason=function(e){var t,r=progress.data.Session.AUTHENTICATION_FAILURE;return 401===e.status?(t=e.getResponseHeader("Content-Type"))&&t.indexOf("application/json")>-1&&e.responseText&&"sso.token.expired_token"===JSON.parse(e.responseText).error&&(r=progress.data.Session.EXPIRED_TOKEN):r=null,r},Object.defineProperty(progress.data.AuthenticationProvider,"_homeLoginURIBase",{value:"/static/home.html",enumerable:!0}),Object.defineProperty(progress.data.AuthenticationProvider,"_springLoginURIBase",{value:"/static/auth/j_spring_security_check",enumerable:!0}),Object.defineProperty(progress.data.AuthenticationProvider,"_springLogoutURIBase",{value:"/static/auth/j_spring_security_logout",enumerable:!0}),Object.defineProperty(progress.data.AuthenticationProvider,"_springFormTokenLoginURIBase",{value:progress.data.AuthenticationProvider._springLoginURIBase+"?OECP=yes",enumerable:!0}),Object.defineProperty(progress.data.AuthenticationProvider,"_springFormTokenRefreshURIBase",{value:"/static/auth/token?op=refresh",enumerable:!0})}(),function(){"use strict";function e(){}progress.data.AuthenticationProviderBasic=function(e){var t=null,r=null;function s(e,t){return"Basic "+btoa(e+":"+t)}this._initialize(e,progress.data.Session.AUTH_TYPE_BASIC,{_loginURI:progress.data.AuthenticationProvider._homeLoginURIBase}),this._reset(),this._reset=function(){t=null,r=null,progress.data.AuthenticationProviderBasic.prototype._reset.apply(this)},this._openLoginRequest=function(e,o){var i;e.open("GET",o,!0),t&&(i=s(t,r),e.setRequestHeader("Authorization",i)),progress.data.Session._setNoCacheHeaders(e)},this._processLoginResult=function(e,s){progress.data.AuthenticationProviderBasic.prototype._processLoginResult.apply(this,[e,s]),this._loggedIn||(t=null,r=null)},this.login=function(e,s){return this._checkStringArg("login",e,1,"userName"),this._checkStringArg("login",s,2,"password"),t=e,r=s,this._loginProto()},this._openRequestAndAuthorize=function(e,o,i,a,n){var d;this.hasClientCredentials()?(e.open(o,i,a),t&&(d=s(t,r),e.setRequestHeader("Authorization",d)),progress.data.Session._setNoCacheHeaders(e),n(e)):n(new Error(progress.data._getMsgText("jsdoMSG125","AuthenticationProvider")))}},e.prototype=progress.data.AuthenticationProvider.prototype,progress.data.AuthenticationProviderBasic.prototype=new e,progress.data.AuthenticationProviderBasic.prototype.constructor=progress.data.AuthenticationProviderBasic}(),function(){"use strict";var e;function t(){}progress.data.AuthenticationProviderForm=function(e){this._initialize(e,progress.data.Session.AUTH_TYPE_FORM,{_loginURI:progress.data.AuthenticationProvider._springLoginURIBase,_logoutURI:progress.data.AuthenticationProvider._springLogoutURIBase})},t.prototype=progress.data.AuthenticationProvider.prototype,progress.data.AuthenticationProviderForm.prototype=new t,progress.data.AuthenticationProviderForm.prototype.constructor=progress.data.AuthenticationProviderForm,progress.data.AuthenticationProviderForm.prototype.login=function(e,t){new progress.util.Deferred;return this._checkStringArg("login",e,1,"userName"),this._checkStringArg("login",t,2,"password"),this._loginProto("j_username="+encodeURIComponent(e)+"&j_password="+encodeURIComponent(t)+"&submit=Submit")},progress.data.AuthenticationProviderForm.prototype._openLoginRequest=function(e,t){e.open("POST",t,!0),e.setRequestHeader("Cache-Control","max-age=0"),e.setRequestHeader("Pragma","no-cache"),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.withCredentials=!0},progress.data.AuthenticationProviderForm.prototype.logout=function(){var e,t=new progress.util.Deferred,r=this;try{this._loggedIn?(e=new XMLHttpRequest,this._openLogoutRequest(e),e.onreadystatechange=function(){4===e.readyState&&r._processLogoutResult(e,t)},e.send()):t.resolve(this,progress.data.Session.SUCCESS,{}),this._reset()}catch(e){if(progress.util.Deferred.useJQueryPromises)throw e;t.reject(this,progress.data.Session.GENERAL_FAILURE,{errorObject:e})}return t.promise()},progress.data.AuthenticationProviderForm.prototype._openLogoutRequest=function(e){e.open("GET",this._logoutURI,!0),e.setRequestHeader("Cache-Control","max-age=0"),e.withCredentials=!0,e.setRequestHeader("Accept","application/json")},progress.data.AuthenticationProviderForm.prototype._processLogoutResult=function(e,t){var r;r=200===e.status?progress.data.Session.SUCCESS:401===e.status?progress.data.Session.SUCCESS:progress.data.Session.GENERAL_FAILURE,this._settlePromise(t,r,{xhr:e})},e=progress.data.AuthenticationProviderForm.prototype._openRequestAndAuthorize,progress.data.AuthenticationProviderForm.prototype._openRequestAndAuthorize=function(e,t,r,s,o){try{progress.data.AuthenticationProviderForm.prototype._openRequestAndAuthorize._super.apply(this,[e,t,r,s,function(t){t instanceof Error?o(t):(e.withCredentials=!0,o(e))}])}catch(e){o(e)}},progress.data.AuthenticationProviderForm.prototype._openRequestAndAuthorize._super=e}(),function(){"use strict";var e;function t(){}progress.data.AuthenticationProviderSSO=function(e){var t,r=this,s=null,o={token:".access_token",refreshToken:".refresh_token",tokenType:".token_type",expiration:".expires_in",accessTokenExpiration:".accessTokenExpiration"};function i(e){var t;e.access_token.length&&r._storage.setItem(o.token,JSON.stringify(e.access_token)),e.refresh_token.length?(r._storage.setItem(o.refreshToken,JSON.stringify(e.refresh_token)),t=(new Date).getTime()+1e3*e.expires_in*.75,r._storage.setItem(o.accessTokenExpiration,JSON.stringify(t))):(r._storage.removeItem(o.refreshToken),r._storage.removeItem(o.accessTokenExpiration)),r._storage.setItem(o.tokenType,JSON.stringify(e.token_type)),r._storage.setItem(o.expiration,JSON.stringify(e.expires_in))}function a(e){var t=r._storage.getItem(e),s=null;if(null!==t)try{s=JSON.parse(t)}catch(e){s=null}return s}function n(){return a(o.token)}function d(){return a(o.refreshToken)}this._processLoginResult=function(e,t){var r,o;if(200===e.status){this._loggedIn=!0;try{(s=JSON.parse(e.responseText)).access_token?(i(s),o=progress.data.Session.SUCCESS):(o=progress.data.Session.GENERAL_FAILURE,r=new Error(progress.data._getMsgText("jsdoMSG049","AuthenticationProvider","login",progress.data._getMsgText("jsdoMSG050"))))}catch(e){o=progress.data.Session.GENERAL_FAILURE,r=new Error(progress.data._getMsgText("jsdoMSG049","AuthenticationProvider","login",e.message))}if(o!==progress.data.Session.SUCCESS){var a=function(s){(s=progress.util.Deferred.getParamObject(s)).provider._settlePromise(t,o,{xhr:e,errorObject:r})};return void this.logout().then(a,a)}}else o=401===e.status?progress.data.Session.AUTHENTICATION_FAILURE:progress.data.Session.GENERAL_FAILURE;this._settlePromise(t,o,{xhr:e})},this._reset=function(){progress.data.AuthenticationProviderSSO.prototype._reset.apply(this),r._storage.removeItem(o.token),r._storage.removeItem(o.refreshToken),r._storage.removeItem(o.tokenType),r._storage.removeItem(o.expiration),r._storage.removeItem(o.accessTokenExpiration),s=null},this._openRequestAndAuthorize=function(e,t,r,s,i){var d,h,l=this;function c(o,a,d){a===progress.data.Session.AUTHENTICATION_FAILURE?i(new Error(progress.data._getMsgText("jsdoMSG060"))):progress.data.AuthenticationProviderSSO.prototype._openRequestAndAuthorize.apply(l,[e,t,r,s,function(t){t instanceof Error?i(t):(e.setRequestHeader("Authorization","oecp "+n()),i(e))}])}if(this.hasClientCredentials())if(d=new Date,this.automaticTokenRefresh&&this.hasRefreshToken()&&d.getTime()>a(o.accessTokenExpiration))try{i=function(e,t,r){c((e=progress.util.Deferred.getParamObject(e,t,r)).provider,e.result,e.info)};this.refresh().then(i,i)}catch(e){i(e)}else c(0,progress.data.Session.SUCCESS);else h=new Error(progress.data._getMsgText("jsdoMSG125","AuthenticationProvider")),i(h)},this.hasClientCredentials=function(){return null!==n()},this.refresh=function(){var e,t=new progress.util.Deferred;try{if(!this._loggedIn)throw new Error(progress.data._getMsgText("jsdoMSG053","AuthenticationProvider","refresh"));if(!this.hasRefreshToken())throw new Error(progress.data._getMsgText("jsdoMSG054","AuthenticationProvider"));(function(e){e.open("POST",r._refreshURI,!0),e.setRequestHeader("Cache-Control","max-age=0"),e.withCredentials=!0,e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Accept","application/json")})(e=new XMLHttpRequest),e.onreadystatechange=function(){4===e.readyState&&function(e,t){var o,a;if(200===e.status)try{(s=JSON.parse(e.responseText)).access_token?(i(s),a=progress.data.Session.SUCCESS):(a=progress.data.Session.GENERAL_FAILURE,o=new Error(progress.data._getMsgText("jsdoMSG049","AuthenticationProvider","refresh",progress.data._getMsgText("jsdoMSG050"))))}catch(e){a=progress.data.Session.GENERAL_FAILURE,o=new Error(progress.data._getMsgText("jsdoMSG049","AuthenticationProvider","refresh",e.message))}else 401===e.status?(r._reset(),a=progress.data.Session.AUTHENTICATION_FAILURE):a=progress.data.Session.GENERAL_FAILURE;r._settlePromise(t,a,{xhr:e,errorObject:o})}(e,t)},e.send('{"token_type":"'+a(o.tokenType)+'","refresh_token":"'+d()+'"}')}catch(e){if(progress.util.Deferred.useJQueryPromises)throw e;t.reject(this,progress.data.Session.GENERAL_FAILURE,{errorObject:e})}return t.promise()},this.hasRefreshToken=function(){return null!==d()},this._initialize(e,progress.data.Session.AUTH_TYPE_FORM_SSO,{_loginURI:progress.data.AuthenticationProvider._springFormTokenLoginURIBase,_logoutURI:progress.data.AuthenticationProvider._springLogoutURIBase,_refreshURI:progress.data.AuthenticationProvider._springFormTokenRefreshURIBase}),t=!0,Object.defineProperty(this,"automaticTokenRefresh",{get:function(){return t},set:function(e){if(!0!==e&&!1!==e)throw new Error(progress.data._getMsgText("jsdoMSG061","AuthenticationProvider","automaticTokenRefresh"));t=e},enumerable:!0}),this._dataKeys.automaticTokenRefresh=this._storageKey+".automaticTokenRefresh",!1===this._retrieveInfoItem(this._dataKeys.automaticTokenRefresh)&&(t=!1),o.token=this._storageKey+o.token,o.refreshToken=this._storageKey+o.refreshToken,o.tokenType=this._storageKey+o.tokenType,o.expiration=this._storageKey+o.expiration,o.accessTokenExpiration=this._storageKey+o.accessTokenExpiration,n()&&(this._loggedIn=!0)},t.prototype=progress.data.AuthenticationProviderForm.prototype,progress.data.AuthenticationProviderSSO.prototype=new t,progress.data.AuthenticationProviderSSO.prototype.constructor=progress.data.AuthenticationProviderSSO,e=progress.data.AuthenticationProviderSSO.prototype._storeInfo,progress.data.AuthenticationProviderSSO.prototype._storeInfo=function(){progress.data.AuthenticationProviderSSO.prototype._storeInfo._super.apply(this),this._storage.setItem(this._dataKeys.automaticTokenRefresh,JSON.stringify(this._automaticTokenRefresh))},progress.data.AuthenticationProviderSSO.prototype._storeInfo._super=e,e=progress.data.AuthenticationProviderSSO.prototype._clearInfo,progress.data.AuthenticationProviderSSO.prototype._clearInfo=function(){progress.data.AuthenticationProviderSSO.prototype._clearInfo._super.apply(this),this._storage.removeItem(this._dataKeys.automaticTokenRefresh)},progress.data.AuthenticationProviderSSO.prototype._clearInfo._super=e}(),function(){function e(e){var t=[],r=null;return"string"==typeof e&&e.split("").forEach(function(e){"{"===e?r="":"}"===e?(r&&t.push(r),r=null):null!==r&&(r+=e)}),t}void 0===progress&&(progress={}),void 0===progress.data&&(progress.data={}),progress.data.ServicesManager={},progress.data.ServicesManager._services=[],progress.data.ServicesManager._resources=[],progress.data.ServicesManager._data=[],progress.data.ServicesManager._sessions=[],progress.data.ServicesManager._jsdosessions=[],progress.data.ServicesManager.addResource=function(e,t){if(void 0!==progress.data.ServicesManager._resources[e])throw new Error("A resource named '"+e+"' was already loaded.");progress.data.ServicesManager._resources[e]=t},progress.data.ServicesManager.getResource=function(e){return progress.data.ServicesManager._resources[e]},progress.data.ServicesManager.addService=function(e,t){if(void 0!==progress.data.ServicesManager._services[e])throw new Error("A service named '"+e+"' was already loaded.");progress.data.ServicesManager._services[e]=t},progress.data.ServicesManager.getService=function(e){return progress.data.ServicesManager._services[e]},progress.data.ServicesManager.addSession=function(e,t){if(void 0!==progress.data.ServicesManager._sessions[e])throw new Error("Cannot load catalog '"+e+"' multiple times.");progress.data.ServicesManager._sessions[e]=t},progress.data.ServicesManager.addJSDOSession=function(e,t){if(void 0!==progress.data.ServicesManager._jsdosessions[e])throw new Error("Cannot load catalog '"+e+"' multiple times.");progress.data.ServicesManager._jsdosessions[e]=t},progress.data.ServicesManager.getSession=function(e){try{return progress.data.ServicesManager._sessions[e]}catch(e){return null}},progress.data.ServicesManager.cleanSession=function(e){var t,r,s,o,i=progress.data.ServicesManager._services,a=progress.data.ServicesManager._resources,n=progress.data.ServicesManager._sessions,d=progress.data.ServicesManager._jsdosessions;for(t in i)if(o=null,i[t]._session===e&&(o=i[t],delete i[t]),o)for(r in a)a[r].service===o&&delete a[r];for(s in n)n[s]===e&&(delete n[s],d[s]&&delete d[s])},progress.data.ServicesManager.addCatalog=function(t,r){var s;if(!t)throw new Error("Cannot find 'services' property in catalog file.");if(!(t instanceof Array))throw new Error("Missing 'services' array in catalog.");t.forEach(function(e){if(void 0!==progress.data.ServicesManager.getService(e.name))throw new Error("A service named '"+e.name+"' was already loaded.");if(!(e.resources instanceof Array))throw new Error("Missing 'resources' array in catalog.");e.resources.forEach(function(e){if(void 0!==progress.data.ServicesManager.getResource(e.name))throw new Error("A resource named '"+e.name+"' was already loaded.")})});for(var o=0;o<t.length;o++){t[o]._session=r,this.addService(t[o].name,t[o]);var i=t[o].resources,a=t[o].address;if(i instanceof Array)for(var n=0;n<i.length;n++){var d=i[n];if(d.fn={},d.service=t[o],i[n].url=a+i[n].path,progress.data.ServicesManager.addResource(i[n].name,i[n]),d.fields=null,d.primaryKeys=null,d.schema){d.fields={},d.primaryKeys={},d._dataSetName=void 0,d._tempTableName=void 0;var h,l,c,f=null;try{void 0!==d.schema.properties?(h=Object.keys(d.schema.properties),f=d.schema.properties,1==h.length&&(void 0!==d.schema.properties[h[0]].properties?d._dataSetName=h[0]:void 0!==d.schema.properties[h[0]].items&&(d.dataProperty=h[0],f=d.schema.properties[h[0]].items.properties,d._tempTableName=d.dataProperty,d.primaryKeys[d._tempTableName]=d.schema.properties[h[0]].primaryKey))):1==(h=Object.keys(d.schema)).length&&(d.dataProperty=h[0],void 0!==d.schema[h[0]].items?(f=d.schema[h[0]].items.properties,d._tempTableName=d.dataProperty,d.primaryKeys[d._tempTableName]=d.schema[h[0]].primaryKey):void 0!==d.schema[h[0]].properties&&(d._dataSetName=h[0],d.dataProperty=null,f=d.schema))}catch(e){throw new Error("Error parsing catalog file.")}if(!f)throw new Error("Error parsing catalog file.");if(d._dataSetName)for(c in f=f[d._dataSetName].properties){var u;for(l in d.fields[c]=[],d.primaryKeys[c]=f[c].primaryKey,u=f[c].items&&f[c].items.properties?f[c].items.properties:f[c].properties)u[l].name=l,"_id"!=l&&d.fields[c].push(u[l])}else for(l in c=d.dataProperty?d.dataProperty:"",d.fields[c]=[],f)f[l].name=l,"_id"!=l&&d.fields[c].push(f[l])}else d.fields=null;if(d.relations instanceof Array&&d.relations[0]&&d.relations[0].RelationName)throw new Error("Relationship properties in catalog must begin with lowercase.");if(d.generic={},d.operations)for(var _=0;_<d.operations.length;_++){d.operations[_].path?d.operations[_].url=d.url+d.operations[_].path:d.operations[_].url=d.url,d.operations[_].params||(d.operations[_].params=[]),d.operations[_].type||(d.operations[_].type="INVOKE");var g=d.operations[_].type.toLowerCase();if(!d.operations[_].verb)switch(g){case"create":d.operations[_].verb="POST";break;case"read":d.operations[_].verb="GET";break;case"update":case"invoke":case"submit":case"count":d.operations[_].verb="PUT";break;case"delete":d.operations[_].verb="DELETE"}var p=function t(r,o){var i;if(void 0===t.fnName)return t.fnName=arguments[0],void(t.definition=arguments[1]);var a,n=null,d=t.definition.url,h=this,l=null,c={};if(r){if("object"!=typeof r)throw new Error("Catalog error: Function '"+t.fnName+"' requires an object as a parameter.");var f;r instanceof XMLHttpRequest||r.constructor&&"XMLHttpRequest"===r.constructor.name?(h=r.jsdo,f=(l=r).objParam,c=l.request):f=r,o=void 0===o?this._async:Boolean(o),c.objParam=f;var u="INVOKE"==t.definition.type.toUpperCase();for(a=0;a<t.definition.params.length;a++)switch(s=t.definition.params[a].name,t.definition.params[a].type){case"PATH":case"QUERY":case"MATRIX":var _=null;if(f&&(_=f[s]),_||(_=""),-1==d.indexOf("{"+s+"}"))throw new Error("Catalog error: Reference to "+t.definition.params[a].type+" parameter '"+s+"' is missing in path.");d=d.replace(new RegExp("{"+s+"}","g"),encodeURIComponent(_));break;case"REQUEST_BODY":case"REQUEST_BODY,RESPONSE_BODY":case"RESPONSE_BODY,REQUEST_BODY":if(l&&!n)n=f;else{var g=f[s];if(u&&t.definition.params[a].xType&&-1!="DATASET,TABLE".indexOf(t.definition.params[a].xType))h._resource.service.settings&&h._resource.service.settings.unwrapped?"object"==typeof g&&1==Object.keys(g).length&&"object"==typeof g[s]&&(g=g[s]):"object"==typeof g&&void 0===g[s]&&((g={})[s]=f[s]);n||(n={}),n[s]=g}break;case"RESPONSE_BODY":break;default:throw new Error("Catalog error: Unexpected parameter type '"+t.definition.params[a].type+"'.")}if(-1!=d.indexOf("{")){var p=e(d);for(a=0;a<p.length;a++)s=p[a],_=null,f&&(_=f[s]),_||(_=""),"object"==typeof _&&(_=JSON.stringify(_)),d=d.replace(new RegExp("{"+s+"}","g"),encodeURIComponent(_))}}return c.fnName=t.fnName,c.async=o,void 0===c.deferred&&(i=new progress.util.Deferred,c.deferred=i),h._httpRequest(l,t.definition.verb,d,n,c,o)};switch(d.operations[_].verb.toLowerCase()){case"get":case"post":case"put":case"delete":break;default:throw new Error("Catalog error: Unexpected HTTP verb '"+d.operations[_].verb+"' found while parsing the catalog.")}switch(g){case"invoke":break;case"create":case"read":case"update":case"delete":case"submit":case"count":if("function"==typeof d.generic[g])throw new Error("Catalog error: Multiple '"+d.operations[_].type+"' operations specified in the catalog for resource '"+d.name+"'.");d.generic[g]=p;break;default:throw new Error("Catalog error: Unexpected operation '"+d.operations[_].type+"' found while parsing the catalog.")}s=d.operations[_].name,"invoke"===g||"count"===g?(d.fn[s]={},d.fn[s].function=p):s="_"+g,p(s,d.operations[_])}}}},progress.data.ServicesManager.printDebugInfo=function(e){if(e){var t=progress.data.ServicesManager.getResource(e);if(t){var r="Schema:\n",s="Operations: "+t.operations.length+"\n";for(var o in t.schema.properties)r+="\nName: "+o+"\n";for(var i=0;i<t.operations.length;i++)s+="\n"+i+"\nName: "+t.operations[i].name+"\nURL: "+t.operations[i].url+"\ntype: "+t.operations[i].type+"\nverb: "+t.operations[i].verb+"\nparams: "+t.operations[i].params.length+"\n";console.log("** DEBUG INFO **\nResource name: %s\nURL:%s\n%s\n%s\n\n",t.name,t.url,r,s)}else console.log("Resource not found")}},progress.data.MobileServiceObject=function(e){var t=e.name;Object.defineProperty(this,"name",{get:function(){return t},enumerable:!0});var r=e.uri;Object.defineProperty(this,"uri",{get:function(){return r},enumerable:!0})},progress.data.ContextProperties=function(){var e,t={};Object.defineProperty(this,"contextHeader",{get:function(){var r;return null===e&&(r=JSON.stringify(t),e="{}"===r?void 0:r),e},enumerable:!0}),this.setContextProperty=function(r,s){if(arguments.length<2)throw new Error(progress.data._getMsgText("jsdoMSG122","Session","setContextProperty",2));if(2!==arguments.length)throw new Error(progress.data._getMsgText("jsdoMSG122","Session","setContextProperty",2));if("string"!=typeof r)throw new Error(progress.data._getMsgText("jsdoMSG121","Session",1,"string","setContextProperty"));void 0===s?delete t[r]:t[r]=s,e=null},this.setContext=function(r){var s;if(arguments.length<1)throw new Error(progress.data._getMsgText("jsdoMSG122","Session","setContext",1));if(arguments.length>1)throw new Error(progress.data._getMsgText("jsdoMSG122","Session","setContext",1));if("object"==typeof r)for(s in t={},r)r.hasOwnProperty(s)&&"function"!=typeof r[s]&&(t[s]=r[s]);else{if(null!=r)throw new Error(progress.data._getMsgText("jsdoMSG121","Session",1,"Object","setContextProperty"));t={}}e=null},this.getContext=function(){if(arguments.length>0)throw new Error(progress.data._getMsgText("jsdoMSG122","Session","getContext",0));return t},this.getContextProperty=function(e){if(arguments.length<1)throw new Error(progress.data._getMsgText("jsdoMSG122","Session","getContextProperty",1));if(arguments.length>1)throw new Error(progress.data._getMsgText("jsdoMSG122","Session","getContextProperty",1));return t[e]}},progress.data.Session=function(e){var t=!1;"function"==typeof Object.defineProperty&&(t=!0);var r,s,o,i,a,n=this,d=!1,h=!1,l=!1,c=!1,f=!1,u=!0,_=!1,g=!1,p="/rest/_oeping",S=null,m=!1,v=!1;e&&!0===e._silent||console.warn("Session: As of JSDO 4.4, the Session object has been deprecated. Please use the JSDOSession object instead."),"undefined"!=typeof navigator&&void 0!==navigator.userAgent&&(d=navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)/i),h=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,l=navigator.userAgent.indexOf("Edge/")>-1,c=navigator.userAgent.indexOf("Trident/")>-1||navigator.userAgent.indexOf("MSIE 10")>-1),f=!(h||l||c),this._onlineHandler=function(){X(!0),n.trigger("online",n,null)},this._offlineHandler=function(){X(!1),n.trigger("offline",n,progress.data.Session.DEVICE_OFFLINE,null)},"undefined"!=typeof window&&window.addEventListener&&(window.addEventListener("online",this._onlineHandler,!1),window.addEventListener("offline",this._offlineHandler,!1));var b=[],y=[],R=[];this.onOpenRequest=null;var E=null;if(t){var j=null;Object.defineProperty(this,"userName",{get:function(){return j},enumerable:!0});var w="/static/home.html";Object.defineProperty(this,"loginTarget",{get:function(){return w},enumerable:!0});var T=null;Object.defineProperty(this,"serviceURI",{get:function(){return T},enumerable:!0}),Object.defineProperty(this,"catalogURIs",{get:function(){return b},enumerable:!0}),Object.defineProperty(this,"services",{get:function(){return y},enumerable:!0});var O=null;Object.defineProperty(this,"loginResult",{get:function(){return O},enumerable:!0});var M=null;Object.defineProperty(this,"loginHttpStatus",{get:function(){return M},enumerable:!0});var P=null;Object.defineProperty(this,"clientContextId",{get:function(){return P},enumerable:!0});var A=progress.data.Session.AUTH_TYPE_ANON;Object.defineProperty(this,"authenticationModel",{get:function(){return A},set:function(e){switch(e&&(e=e.toLowerCase()),e){case progress.data.Session.AUTH_TYPE_FORM:case progress.data.Session.AUTH_TYPE_BASIC:case progress.data.Session.AUTH_TYPE_ANON:case progress.data.Session.AUTH_TYPE_SSO:case null:A=e,F("authenticationModel",e);break;default:throw new Error("Error setting Session.authenticationModel. '"+e+"' is an invalid value.")}},enumerable:!0});var I=null;Object.defineProperty(this,"lastSessionXHR",{get:function(){return I},enumerable:!0}),Object.defineProperty(this,"connected",{get:function(){return this.loginResult===progress.data.Session.LOGIN_SUCCESS&&_&&u},enumerable:!0}),Object.defineProperty(this,"JSDOs",{get:function(){return R},enumerable:!0});var C=0,D=null;Object.defineProperty(this,"pingInterval",{get:function(){return C},set:function(e){if(!("number"==typeof e&&e>=0))throw new Error("Error setting Session.pingInterval. '"+e+"' is an invalid value.");C=e,F("pingInterval",e),e>0?this.loginResult===progress.data.Session.LOGIN_SUCCESS&&(D=setTimeout(this._autoping,e)):0===e&&(clearTimeout(D),C=0)},enumerable:!0});var x=new progress.data.ContextProperties;Object.defineProperty(this,"_contextProperties",{get:function(){return x},enumerable:!1});var N=!1;Object.defineProperty(this,"_isInvalidated",{get:function(){return N},enumerable:!1}),Object.defineProperty(this,"_authProvider",{get:function(){return S},set:function(e){if(S)throw new Error("Internal Error setting Session._authProvider. 'The property has already been set.");V(e)},enumerable:!1})}else this.userName=null,this.loginTarget="/static/home.html",this.serviceURI=null,this.catalogURIs=[],this.services=[],this.loginResult=null,this.loginHttpStatus=null,this.clientContextId=null,this.authenticationModel=progress.data.Session.AUTH_TYPE_ANON,this.lastSessionXHR=null;function F(e,t){var r;n.loginResult===progress.data.Session.LOGIN_SUCCESS&&"object"==typeof sessionStorage&&s&&(r=s,e&&(r=r+"."+e),void 0!==t&&sessionStorage.setItem(r,JSON.stringify(t)))}function G(e){var t,r,o=null;if("object"==typeof sessionStorage&&s){if(t=s,e&&(t=t+"."+e),null!==(r=sessionStorage.getItem(t)))try{o=JSON.parse(r)}catch(e){o=null}return o}}function U(e){var t;"object"==typeof sessionStorage&&s&&(t=s,e&&(t=t+"."+e,sessionStorage.removeItem(t)))}function L(){s&&(F("loginResult",n.loginResult),F("userName",n.userName),F("serviceURI",n.serviceURI),F("loginHttpStatus",n.loginHttpStatus),F("authenticationModel",n.authenticationModel),F("pingInterval",n.pingInterval),F("oepingAvailable",g),F("partialPingURI",p),F("clientContextId",n.clientContextId),F("deviceIsOnline",u),F("restApplicationIsOnline",_),n._authProvider&&F("_authProvider.init",{uri:n._authProvider.uri,authenticationModel:n._authProvider.authenticationModel}),F(s,!0))}function J(){s&&G(s)&&(U("loginResult"),U("userName"),U("serviceURI"),U("loginHttpStatus"),U("clientContextId"),U("deviceIsOnline"),U("restApplicationIsOnline"),U("authenticationModel"),U("pingInterval"),U("oepingAvailable"),U("partialPingURI"),U("_authProvider.init"),U(s))}function k(e,r){t?j=e:r.userName=e,F("userName",e)}function H(e,r){t?T=e:r.serviceURI=e,F("serviceURI",e)}function q(e,r){t?O=e:r.loginResult=e,e===progress.data.Session.LOGIN_SUCCESS?F("loginResult",e):J()}function B(e,r){t?M=e:r.loginHttpStatus=e,F("loginHttpStatus",e)}function Y(e,r){t?P=e:r.clientContextId=e,F("clientContextId",e)}function K(e,r){t?I=e:r.lastSessionXHR=e}function X(e){u=e,F("deviceIsOnline",e)}function V(e){S=e||null}function Q(e){_=e,F("restApplicationIsOnline",e)}function z(e){g=e,F("oepingAvailable",e)}function $(e){p=e,F("partialPingURI",e)}function W(e,t){var r,s=e._pdsResponseHeaders;return void 0===s&&(s=e.getAllResponseHeaders(),e._pdsResponseHeaders=s||null),s&&(r=new RegExp("^"+t+":","mi"),s.match(r))?e.getResponseHeader(t):null}this._pushJSDOs=function(e){R.push(e)},this._openRequest=function(e,t,r,s,o){var i,a=this;function n(r){if(r instanceof Error)throw r;if(a.clientContextId&&"0"!==a.clientContextId&&e.setRequestHeader("X-CLIENT-CONTEXT-ID",a.clientContextId),ne(a,e),"function"==typeof a.onOpenRequest){var n={xhr:e,verb:t,uri:i,async:s,formPreTest:!1,session:a};a.onOpenRequest(n)}o&&o()}if(this._isInvalidated)throw new Error(progress.data._getMsgText("jsdoMSG510","Session"));if(this.loginResult!==progress.data.Session.LOGIN_SUCCESS&&!this._authProvider&&this.authenticationModel)throw new Error("Attempted to make server request when there is no active session.");i=this._prependAppURL(r),i=this._addCCIDtoURL(i),progress.data.Session._useTimeStamp&&(i=progress.data.Session._addTimeStampToURL(i)),this._authProvider?this._authProvider._openRequestAndAuthorize(e,t,i,s,n):(this._setXHRCredentials(e,t,i,this.userName,E,s),this.authenticationModel===progress.data.Session.AUTH_TYPE_FORM&&te(e,"application/json"),n(e))},this.pingTestCallback=function(e){z(!!e.pingResult)},this._onReadyStateChangeGeneric=function(){var e,t;if(clearTimeout(this._requestTimeout),4===this.readyState){if(e=null,t=null,"function"==typeof this.onResponseFn)try{e=this.onResponseFn(this)}catch(e){t=e}"function"==typeof this.onResponseProcessedFn&&(e||(e=progress.data.Session.GENERAL_FAILURE),this.onResponseProcessedFn(this.pdsession,e,t,this))}},this._disconnect=function(e){this._processDisconnectResult(null,e)},this._processDisconnectResult=function(e,t){this._reinitializeAfterLogout(this,progress.data.Session.SUCCESS),this._disconnectComplete(this,progress.data.Session.SUCCESS,null,null,t)},this._disconnectComplete=function(e,t,r,s,o){e.trigger("afterDisconnect",e,t,r,s,o)};var Z=null,ee=null;function te(e,t){try{e.withCredentials=!0,e.setRequestHeader("Accept",t)}catch(e){}}this.login=function(e,s,o,i){var a,n,h,l,c,f,u,_=!1,g=[];if(Z=null,ee=null,t||(this.authenticationModel=this.authenticationModel.toLowerCase()),this.authenticationModel===progress.data.Session.AUTH_TYPE_SSO)throw new Error(progress.data._getMsgText("jsdoMSG057","Session","login()"));if(this.loginResult===progress.data.Session.LOGIN_SUCCESS||this._authProvider)throw new Error("Attempted to call login() on a Session object that is already logged in.");if(arguments.length>0)if(arguments[0]&&"object"==typeof arguments[0]){if(g[0]=arguments[0].serviceURI,g[1]=arguments[0].userName,g[2]=arguments[0].password,g[3]=arguments[0].loginTarget,g[4]=arguments[0].async,h=arguments[0].deferred,void 0===(l=arguments[0].iOSBasicAuthTimeout))l=4e3;else if(l&&"number"!=typeof l)throw new Error(progress.data._getMsgText("jsdoMSG033","Session","login","The iOSBasicAuthTimeout argument was invalid."))}else g=arguments;if(!(g.length>0))throw q(progress.data.Session.LOGIN_GENERAL_FAILURE,this),new Error("Session.login() is missing the serviceURI argument.");if(g[0]){var p=g[0];"/"===p[p.length-1]&&(p=p.substring(0,p.length-1)),H(p,this)}else if(!this.serviceURI)throw q(progress.data.Session.LOGIN_GENERAL_FAILURE,this),new Error("Session.login() is missing the serviceURI argument.");if(g[1]&&(a=g[1]),g[2]&&(n=g[2]),g[3]&&(f=g[3],u=this,t?w=f:u.loginTarget=f),g[4]){if("boolean"!=typeof g[4])throw new Error("Session.login() was passed an async setting that is not a boolean.");_=g[4]}ee=a,Z=n,this.authenticationModel!==progress.data.Session.AUTH_TYPE_ANON&&this.authenticationModel!==progress.data.Session.AUTH_TYPE_FORM||(a=null,n=null);var S=new XMLHttpRequest;S.pdsession=this;try{if(c=this.serviceURI+this.loginTarget,progress.data.Session._useTimeStamp&&(c=progress.data.Session._addTimeStampToURL(c)),this._setXHRCredentials(S,"GET",c,a,n,_),progress.data.Session._setNoCacheHeaders(S),ne(this,S),this.authenticationModel===progress.data.Session.AUTH_TYPE_FORM&&te(S,"application/json,text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"),S._isAsync=_,_&&(S.onreadystatechange=this._onReadyStateChangeGeneric,this.authenticationModel===progress.data.Session.AUTH_TYPE_FORM?S.onResponseFn=this._afterFormPretestLogin:(S.onResponseFn=this._processLoginResult,S.onResponseProcessedFn=this._loginComplete),this.authenticationModel===progress.data.Session.AUTH_TYPE_BASIC&&d&&l>0&&(S._requestTimeout=setTimeout(function(){clearTimeout(S._requestTimeout),S._iosTimeOutExpired=!0,S.abort()},l)),S._jsdosession=r,S._deferred=h),"function"==typeof this.onOpenRequest){var m=!1;this.authenticationModel===progress.data.Session.AUTH_TYPE_FORM&&(m=!0),K(S,this);var v={xhr:S,verb:"GET",uri:this.serviceURI+this.loginTarget,async:!1,formPreTest:m,session:this};this.onOpenRequest(v),S=v.xhr}K(S,this),S.send(null)}catch(e){throw clearTimeout(S._requestTimeout),B(S.status,this),q(progress.data.Session.LOGIN_GENERAL_FAILURE,this),ee=null,Z=null,e}return _?progress.data.Session.ASYNC_PENDING:(B(S.status,this),this.authenticationModel===progress.data.Session.AUTH_TYPE_FORM?this._afterFormPretestLogin(S):this._processLoginResult(S))},this._afterFormPretestLogin=function(e){var t=e.pdsession;B(e.status,e.pdsession);var r={xhr:e,pw:Z,uname:ee,theSession:t};try{return function(e){var t,r=e.xhr,s=e.theSession,o=null,i=!1,a={session:s,xhr:r,statusFromjson:null};(o=r.getResponseHeader("Content-Type"))&&o.indexOf("application/json")>=0?(ae(a),!a.statusFromjson||a.statusFromjson>=400&&a.statusFromjson<500?i=!0:B(a.statusFromjson,s)):200===s.loginHttpStatus&&se(r)&&(i=!0);if(i){t=r,r=new XMLHttpRequest,e.xhr=r,a.xhr=r,r.pdsession=t.pdsession,r._isAsync=t._isAsync,r._deferred=t._deferred,r._jsdosession=t._jsdosession,r.open("POST",s.serviceURI+"/static/auth/j_spring_security_check",r._isAsync),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.setRequestHeader("Cache-Control","max-age=0"),ne(s,r),te(r,"application/json");try{if("function"==typeof s.onOpenRequest){var n={xhr:r,verb:"POST",uri:s.serviceURI+"/static/auth/j_spring_security_check",async:r._isAsync,formPreTest:!1,session:s};s.onOpenRequest(n),r=n.xhr}r._isAsync&&(r.onreadystatechange=s._onReadyStateChangeGeneric,r.onResponseFn=s._afterFormLogin,r.onResponseProcessedFn=s._loginComplete),r.send("j_username="+encodeURIComponent(e.uname)+"&j_password="+encodeURIComponent(e.pw)+"&submit=Submit")}catch(e){throw q(progress.data.Session.LOGIN_GENERAL_FAILURE,s),B(r.status,s),ee=null,Z=null,e}}if(r._isAsync&&!i)return r.onResponseProcessedFn=s._loginComplete,s._afterFormLogin(r);if(!r._isAsync)return s._afterFormLogin(r)}(r)}catch(e){throw Z=null,ee=null,e}},this._afterFormLogin=function(e){var t=e.pdsession,r={session:t,xhr:e,statusFromjson:null},s=e.getResponseHeader("Content-Type");if(s&&s.indexOf("application/json")>=0){if(ae(r),!r.statusFromjson)throw new Error("Internal OpenEdge Mobile client error handling login response. HTTP status: "+e.status+".");B(r.statusFromjson,t)}else 200===e.status&&(function(e){return ie(e,oe)}(e)||se(e)?B(401,t):B(e.status,t));return t._processLoginResult(e)},this._processLoginResult=function(e){var t=e.pdsession;if(B(e.status,e.pdsession),200===t.loginHttpStatus){q(progress.data.Session.LOGIN_SUCCESS,t),Q(!0),k(ee,t),E=Z,t._saveClientContextId(e),L();var r={pingURI:null,async:!0,onCompleteFn:null,fireEventIfOfflineChange:!0,onReadyStateFn:t._pingtestOnReadyStateChange};r.pingURI=t._makePingURI(),t._sendPing(r)}else 401===t.loginHttpStatus?q(progress.data.Session.LOGIN_AUTHENTICATION_FAILURE,t):q(progress.data.Session.LOGIN_GENERAL_FAILURE,t);if(K(e,t),he(t,e),ee=null,Z=null,e._iosTimeOutExpired)throw new Error(progress.data._getMsgText("jsdoMSG047","login"));return t.loginResult},this._loginComplete=function(e,t,r,s){e.trigger("afterLogin",e,t,r,s)},this.logout=function(e){var t,s,o,i=!1,a=null;if(this.authenticationModel===progress.data.Session.AUTH_TYPE_SSO)throw new Error(progress.data._getMsgText("jsdoMSG057","Session","logout()"));if(this.loginResult!==progress.data.Session.LOGIN_SUCCESS&&this.authenticationModel)throw new Error("Attempted to call logout when there is no active session.");if("object"==typeof e){if((i=e.async)&&"boolean"!=typeof i)throw new Error(progress.data._getMsgText("jsdoMSG033","Session","logout","The async argument was invalid."));s=e.deferred}(t=new XMLHttpRequest).pdsession=this;try{if(t._jsdosession=r,t._deferred=s,this.authenticationModel===progress.data.Session.AUTH_TYPE_FORM||this.authenticationModel===progress.data.Session.AUTH_TYPE_BASIC){i&&(t.onreadystatechange=this._onReadyStateChangeGeneric,t.onResponseFn=this._processLogoutResult,t.onResponseProcessedFn=this._logoutComplete),t.open("GET",this.serviceURI+"/static/auth/j_spring_security_logout",i);try{t.withCredentials=!0}catch(e){}t.setRequestHeader("Accept","application/json"),ne(this,t),"function"==typeof this.onOpenRequest&&(K(t,this),o={xhr:t,verb:"GET",uri:this.serviceURI+"/static/auth/j_spring_security_logout",async:!1,formPreTest:!1,session:this},this.onOpenRequest(o),t=o.xhr),K(t,this),t.send()}else t._anonymousLogoutOK=!0}catch(e){throw this._reinitializeAfterLogout(this,!1),e}if(!i)try{this._processLogoutResult(t)}catch(e){throw e}if(i&&this.authenticationModel===progress.data.Session.AUTH_TYPE_ANON){try{this._processLogoutResult(t)}catch(e){a=e}this._logoutComplete(this,null,a,t)}},this.invalidate=function(){N=!0,progress.data.ServicesManager.cleanSession(n)},this._logoutComplete=function(e,t,r,s){e.trigger("afterLogout",e,r,s)},this._processLogoutResult=function(e){var t,r=e.pdsession;if(e._anonymousLogoutOK)t=!0;else if(200!==e.status){if(r.authenticationModel!==progress.data.Session.AUTH_TYPE_BASIC)throw t=!1,new Error("Error logging out, HTTP status = "+e.status);if(404!==e.status)throw t=!1,new Error("Error logging out, HTTP status = "+e.status);t=!0}else t=!0;he(r,e),r._reinitializeAfterLogout(r,t)},this._reinitializeAfterLogout=function(e,t){q(null,e),B(null,e),Y(null,e),k(null,e),V(null),E=null,t&&(Q(!1),z(!1),$("/rest/_oeping"),K(null,e),clearTimeout(D))},this.addCatalog=function(e,t,s,o){var i,a,n,h,l,c,f,u,_=!1,g=this;function p(){progress.data.Session._setNoCacheHeaders(h),ne(g,h),_&&(h.onreadystatechange=g._onReadyStateChangeGeneric,h.onResponseFn=g._processAddCatalogResult,h.onResponseProcessedFn=g._addCatalogComplete,g.authenticationModel===progress.data.Session.AUTH_TYPE_BASIC&&d&&c&&(h._requestTimeout=setTimeout(function(){clearTimeout(h._requestTimeout),h._iosTimeOutExpired=!0,h.abort()},c)),h._jsdosession=r,h._deferred=l,h._catalogIndex=f);try{if("function"==typeof g.onOpenRequest){K(h,g);var e={xhr:h,verb:"GET",uri:i,async:!1,formPreTest:!1,session:g};g.onOpenRequest(e),h=e.xhr}K(h,g),h.send(null)}catch(e){throw new Error("Error retrieving catalog '"+i+"'.\n"+e.message)}return _?progress.data.Session.ASYNC_PENDING:g._processAddCatalogResult(h)}if(this._isInvalidated)throw new Error(progress.data._getMsgText("jsdoMSG510","JSDOSession"));if(m=!0,!(arguments.length>0))throw new Error("Session.addCatalog is missing its first argument, the URL of the catalog.");if("object"==typeof e){if(!arguments[0].offlineAddCatalog&&this.loginResult!==progress.data.Session.LOGIN_SUCCESS&&!this._authProvider&&this.authenticationModel)throw new Error("Attempted to call addCatalog when there is no active session.");if(!(i=e.catalogURI)||"string"!=typeof i)throw new Error(progress.data._getMsgText("jsdoMSG033","Session","addCatalog","The catalogURI argument was missing or invalid."));if((a=e.userName)&&"string"!=typeof a)throw new Error(progress.data._getMsgText("jsdoMSG033","Session","addCatalog","The catalogUserName argument was invalid."));if((n=e.password)&&"string"!=typeof n)throw new Error(progress.data._getMsgText("jsdoMSG033","Session","addCatalog","The catalogPassword argument was invalid."));if((_=e.async)&&"boolean"!=typeof _)throw new Error(progress.data._getMsgText("jsdoMSG033","Session","addCatalog","The async argument was invalid."));if(void 0===(c=e.iOSBasicAuthTimeout))c=4e3;else if(c&&"number"!=typeof c)throw new Error(progress.data._getMsgText("jsdoMSG033","Session","addCatalog","The iOSBasicAuthTimeout argument was invalid."));u=e.authProvider,l=e.deferred,f=e.catalogIndex}else{if("string"!=typeof(i=e))throw new Error("First argument to Session.addCatalog must be the URL of the catalog.");if((a=t)&&"string"!=typeof a)throw new Error("Second argument to Session.addCatalog must be a user name string.");if((n=s)&&"string"!=typeof n)throw new Error("Third argument to Session.addCatalog must be a password string.")}return u||(u=this._authProvider,m=!1),a||(a=this.userName),n||(n=E),(h=new XMLHttpRequest).pdsession=this,h._catalogURI=i,void 0!==progress.data.ServicesManager.getSession(i)?_?(h._jsdosession=r,h._deferred=l,h._catalogIndex=f,setTimeout(this._addCatalogComplete,10,this,progress.data.Session.CATALOG_ALREADY_LOADED,null,h),progress.data.Session.ASYNC_PENDING):progress.data.Session.CATALOG_ALREADY_LOADED:u?(u._openRequestAndAuthorize(h,"GET",i,_,p),progress.data.Session.ASYNC_PENDING):(this._setXHRCredentials(h,"GET",i,a,n,_),p())},this._processAddCatalogResult=function(e){var s,o,i,a,n=e.status,d=e.pdsession,h=e._catalogURI,l=r;if(m||de(e),200!==n&&0!==n||!e.responseText){if(401===n)return progress.data.AuthenticationProvider._getAuthFailureReason(e);throw e._iosTimeOutExpired?new Error(progress.data._getMsgText("jsdoMSG047","addCatalog")):new Error("Error retrieving catalog '"+h+"'. Http status: "+n+".")}s=d._parseCatalog(e);try{progress.data.ServicesManager.addCatalog(s,d)}catch(e){if(void 0!==progress.data.ServicesManager.getSession(h))return progress.data.Session.CATALOG_ALREADY_LOADED;throw new Error("Error processing catalog '"+h+"'. \n"+e.message)}return s.forEach(function(e){var r,s;o=d._prependAppURL(e.address),r=new progress.data.MobileServiceObject({name:e.name,uri:o}),s=d,t?y.push(r):s.services.push(r),e.settings&&e.settings.useXClientProps&&!d.xClientProps&&console.warn("Catalog warning: Service settings property 'useXClientProps' is true but 'xClientProps' property has not been set.")}),i=h,a=d,t?b.push(i):a.catalogURIs.push(i),progress.data.ServicesManager.addSession(h,d),l&&progress.data.ServicesManager.addJSDOSession(h,l),progress.data.Session.SUCCESS},this._addCatalogComplete=function(e,t,r,s){e.trigger("afterAddCatalog",e,t,r,s)},this.ping=function(e){var t=!1,r={pingURI:null,async:!0,onCompleteFn:null,fireEventIfOfflineChange:!0,onReadyStateFn:this._onReadyStateChangePing,offlineReason:null};if(this._isInvalidated)throw new Error(progress.data._getMsgText("jsdoMSG510","Session"));if(!this._authProvider&&this.loginResult!==progress.data.Session.LOGIN_SUCCESS)throw new Error("Attempted to call ping when not logged in.");return e&&(void 0!==e.async&&(r.async=e.async),void 0!==e.doNotFireEvent&&(r.fireEventIfOfflineChange=!e.doNotFireEvent),e.onCompleteFn&&"function"==typeof e.onCompleteFn&&(r.onCompleteFn=e.onCompleteFn),r.deferred=e.deferred,r.jsdosession=e.jsdosession),r.pingURI=n._makePingURI(),n._sendPing(r),r.async||(r.xhr?(t=n._processPingResult(r),void 0!==e.offlineReason&&(e.offlineReason=r.offlineReason)):t=!1,void 0!==e.xhr&&(e.xhr=r.xhr)),t},this._isOnlineStateChange=function(e){var t=!1;return e&&!this.connected?t=!0:!e&&this.connected&&(t=!0),t},this._checkServiceResponse=function(e,t,r){var s=null,o=this.connected;if(he(this,e),this._events){var i=this._events.offline||[],a=this._events.online||[];if(0!==i.length||0!==a.length){if(t)Q(!0),X(!0);else if(u){var d={doNotFireEvent:!0,offlineReason:null,async:!1};n.ping(d)?Q(!0):(s=d.offlineReason,Q(!1))}o&&!this.connected?this.trigger("offline",this,s,r):!o&&this.connected&&this.trigger("online",this,r)}}},this._processPingResult=function(e){var t,r,s=e.xhr,o=null,i=this.connected;if(r=e.hasOwnProperty("usingOepingFormat")?e.usingOepingFormat:g,s.status>=200&&s.status<300){if(he(this,s),r)try{o=JSON.parse(s.responseText).AppServerStatus}catch(e){console.error("Unable to parse ping response.")}de(s)}else u?0===s.status?(e.offlineReason=progress.data.Session.SERVER_OFFLINE,Q(!1)):404===s.status||410===s.status?(e.offlineReason=progress.data.Session.WEB_APPLICATION_OFFLINE,Q(!1)):Q(!0):e.offlineReason=progress.data.Session.DEVICE_OFFLINE;return o&&("false"===o.PingStatus?(e.offlineReason=progress.data.Session.APPSERVER_OFFLINE,Q(!1)):Q(!0)),t=this.connected,"function"==typeof s.onCompleteFn&&s.onCompleteFn({pingResult:this.connected,xhr:s,offlineReason:e.offlineReason}),e.fireEventIfOfflineChange&&(i&&!t?n.trigger("offline",n,e.offlineReason,null):!i&&t&&n.trigger("online",n,null)),this.connected},this._onReadyStateChangePing=function(){var e;4===this.readyState&&(e={xhr:this,fireEventIfOfflineChange:!0,offlineReason:null},n._processPingResult(e),C>0&&(D=setTimeout(n._autoping,C)))},this._pingtestOnReadyStateChange=function(){if(4===this.readyState){var e=!1;this.status>=200&&this.status<300?e=!0:($(n.loginTarget),console.warn("Default ping target not available, will use loginTarget instead.")),z(e),C>0&&(D=setTimeout(n._autoping,C))}},this._sendPing=function(e){var t=new XMLHttpRequest,s=this;function o(){e.async&&(t.onreadystatechange=e.onReadyStateFn,t.onCompleteFn=e.onCompleteFn,t._jsdosession=r,t._deferred=e.deferred),progress.data.Session._setNoCacheHeaders(t),ne(s,t),s.authenticationModel===progress.data.Session.AUTH_TYPE_FORM&&te(t,"application/json,text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"),t.send(null)}try{this._authProvider?this._authProvider._openRequestAndAuthorize(t,"GET",e.pingURI,e.async,o):(this._setXHRCredentials(t,"GET",e.pingURI,this.userName,E,e.async),1===t.readyState&&o())}catch(t){e.error=t}e.xhr=t},this._makePingURI=function(){var e=this.serviceURI+p;return progress.data.Session._useTimeStamp&&(e=progress.data.Session._addTimeStampToURL(e)),e},this._autoping=function(){n.ping({async:!0})},this._setXHRCredentials=function(e,t,r,s,o,i){if(s&&this.authenticationModel===progress.data.Session.AUTH_TYPE_BASIC){f?e.open(t,r,i,s,o):e.open(t,r,i);var a="Basic "+btoa(s+":"+o);e.setRequestHeader("Authorization",a)}else e.open(t,r,i)},this._addCCIDtoURL=function(e){var t,r,s,o;return this.clientContextId&&"0"!==this.clientContextId&&e.substring(0,this.serviceURI.length)===this.serviceURI&&(s=";JSESSIONID="+this.clientContextId,-1===(o=e.indexOf("?"))?e+=s:(t=e.substring(0,o),r=e.substring(o),e=t+s+r)),e},this._saveClientContextId=function(e){!function(e,t){e&&Y(W(e,"X-CLIENT-CONTEXT-ID"),t)}(e,this)},this._parseCatalog=function(e){var t;try{t=JSON.parse(e.responseText).services}catch(e){console.error("Unable to parse response. Make sure catalog has correct format."),t=null}return t},this._prependAppURL=function(e){if(!e)return this.serviceURI;var t=e;return/^https?:\/\//i.test(t)||(0!==t.indexOf("/")&&(t="/"+t),t=this.serviceURI+t),t};var re="j_spring_security_check";function se(e){return ie(e,re)}var oe="login failed";function ie(e,t){if(!e.responseText)return!1;var r=e.getResponseHeader("Content-Type");return!!(r&&r.indexOf("text/html")>=0&&e.responseText.indexOf(t)>=0)}function ae(e){var t;e.statusFromjson=null;try{void 0!==(t=JSON.parse(e.xhr.responseText)).status_code&&void 0!==t.status_txt&&(e.statusFromjson=t.status_code)}catch(t){throw q(progress.data.Session.LOGIN_GENERAL_FAILURE,e.session),B(e.xhr.status,e.session),new Error("Unable to parse login response from server.")}}function ne(e,t){e.xClientProps?t.setRequestHeader("X-CLIENT-PROPS",e.xClientProps):void 0!==e._contextProperties.contextHeader&&t.setRequestHeader("X-CLIENT-PROPS",e._contextProperties.contextHeader)}function de(e){var t=n;return B(e.status,t),t.loginHttpStatus>=200&&t.loginHttpStatus<400?(q(progress.data.Session.LOGIN_SUCCESS,t),Q(!0),t._saveClientContextId(e),L()):0===t.loginHttpStatus||400===t.loginHttpStatus||410===t.loginHttpStatus?(Q(!1),q(progress.data.AuthenticationProvider._getAuthFailureReason(e),t)):(Q(!0),q(progress.data.Session.LOGIN_GENERAL_FAILURE,t)),K(e,t),he(t,e),t.loginResult}function he(e,t){var r,s;if(t)if(r=W(t,"X-CLIENT-PROPS")){try{s=JSON.parse(r)}catch(e){}if("object"!=typeof s)throw new Error(progress.data._getMsgText("jsdoMSG123","Session","X-CLIENT-PROPS"));e._contextProperties.setContext(s)}else""===r&&e._contextProperties.setContext({})}"object"==typeof e&&(r=e.jsdosession,a=e.serviceURI,V(e.authProvider),e.authProvider&&e.authProvider.hasClientCredentials()&&(O=progress.data.Session.LOGIN_SUCCESS),a&&"/"===a[a.length-1]&&(a=a.substring(0,a.length-1)),(s=e._storageKey)&&(G(s)&&(o=G("authenticationModel"),i=G("serviceURI"),o!==e.authenticationModel||i!==a?J():(!function(e){var t;G(e)&&(q(G("loginResult"),this),k(G("userName"),this),H(G("serviceURI"),this),B(G("loginHttpStatus"),this),Y(G("clientContextId"),this),X(G("deviceIsOnline")),Q(G("restApplicationIsOnline")),n.authenticationModel=G("authenticationModel"),n.pingInterval=G("pingInterval"),z(G("oepingAvailable")),$(G("partialPingURI")),n._authProvider||(t=G("_authProvider.init"))&&V(new progress.data.AuthenticationProvider(t)))}(s),v=!0)),e.authenticationModel===progress.data.Session.AUTH_TYPE_BASIC&&(s=void 0)),v||(a&&H(a,this),e.authenticationModel&&(this.authenticationModel=e.authenticationModel)))},progress.data.Session._useTimeStamp=!0;var t=999999999999999,r=0,s=0;progress.data.Session._getNextTimeStamp=function(){var e;if((e=t+=1)>=999999999999999){t=1,e=1;var o=Math.floor((Date.now?Date.now():(new Date).getTime())/1e4);r===o?(s+=1)>=999999999999999&&(s=1):(r=o,Math.random(),s=Math.round(1e10*Math.random()))}return r+"-"+s+"-"+e},progress.data.Session._addTimeStampToURL=function(e){var t="_ts="+progress.data.Session._getNextTimeStamp();return e+=(-1===e.indexOf("?")?"?":"&")+t},progress.data.Session._setNoCacheHeaders=function(e){e.setRequestHeader("Cache-Control","no-cache"),e.setRequestHeader("Pragma","no-cache")},"function"==typeof Object.defineProperty?(Object.defineProperty(progress.data.Session,"LOGIN_AUTHENTICATION_REQUIRED",{value:0,enumerable:!0}),Object.defineProperty(progress.data.Session,"LOGIN_SUCCESS",{value:1,enumerable:!0}),Object.defineProperty(progress.data.Session,"LOGIN_AUTHENTICATION_FAILURE",{value:2,enumerable:!0}),Object.defineProperty(progress.data.Session,"LOGIN_GENERAL_FAILURE",{value:3,enumerable:!0}),Object.defineProperty(progress.data.Session,"CATALOG_ALREADY_LOADED",{value:4,enumerable:!0}),Object.defineProperty(progress.data.Session,"ASYNC_PENDING",{value:5,enumerable:!0}),Object.defineProperty(progress.data.Session,"EXPIRED_TOKEN",{value:6,enumerable:!0}),Object.defineProperty(progress.data.Session,"SUCCESS",{value:1,enumerable:!0}),Object.defineProperty(progress.data.Session,"AUTHENTICATION_FAILURE",{value:2,enumerable:!0}),Object.defineProperty(progress.data.Session,"GENERAL_FAILURE",{value:3,enumerable:!0}),Object.defineProperty(progress.data.Session,"AUTH_TYPE_ANON",{value:"anonymous",enumerable:!0}),Object.defineProperty(progress.data.Session,"AUTH_TYPE_BASIC",{value:"basic",enumerable:!0}),Object.defineProperty(progress.data.Session,"AUTH_TYPE_FORM",{value:"form",enumerable:!0}),Object.defineProperty(progress.data.Session,"AUTH_TYPE_SSO",{value:"sso",enumerable:!0}),Object.defineProperty(progress.data.Session,"AUTH_TYPE_FORM_SSO",{value:"form_sso",enumerable:!0}),Object.defineProperty(progress.data.Session,"DEVICE_OFFLINE",{value:"Device is offline",enumerable:!0}),Object.defineProperty(progress.data.Session,"SERVER_OFFLINE",{value:"Cannot contact server",enumerable:!0}),Object.defineProperty(progress.data.Session,"WEB_APPLICATION_OFFLINE",{value:"Mobile Web Application is not available",enumerable:!0}),Object.defineProperty(progress.data.Session,"SERVICE_OFFLINE",{value:"REST web Service is not available",enumerable:!0}),Object.defineProperty(progress.data.Session,"APPSERVER_OFFLINE",{value:"AppServer is not available",enumerable:!0})):(progress.data.Session.LOGIN_SUCCESS=1,progress.data.Session.LOGIN_AUTHENTICATION_FAILURE=2,progress.data.Session.LOGIN_GENERAL_FAILURE=3,progress.data.Session.CATALOG_ALREADY_LOADED=4,progress.data.Session.SUCCESS=1,progress.data.Session.AUTHENTICATION_FAILURE=2,progress.data.Session.GENERAL_FAILURE=3,progress.data.Session.AUTH_TYPE_ANON="anonymous",progress.data.Session.AUTH_TYPE_BASIC="basic",progress.data.Session.AUTH_TYPE_FORM="form",progress.data.Session.AUTH_TYPE_SSO="sso"),progress.data.Session.prototype=new progress.util.Observable,progress.data.Session.prototype.constructor=progress.data.Session,progress.data.Session.prototype._eventNames=["offline","online","afterLogin","afterAddCatalog","afterLogout","afterDisconnect"],progress.data.Session.prototype.validateSubscribe=function(e,t,r){r.operation=void 0;var s=!1;if(this._eventNames.forEach(function(e){t===e.toLowerCase()&&(s=!0)}),!s)throw new Error(progress.data._getMsgText("jsdoMSG042",t));if(e.length<2)throw new Error(progress.data._getMsgText("jsdoMSG038",2));if("string"!=typeof e[0])throw new Error(progress.data._getMsgText("jsdoMSG039"));if("function"!=typeof e[1])throw new Error(progress.data._getMsgText("jsdoMSG040"));if(r.fn=e[1],e.length>2){if("object"!=typeof e[2])throw new Error(progress.data._getMsgText("jsdoMSG041",t));r.scope=e[2]}},progress.data.Session.prototype.toString=function(e){return"progress.data.Session"},progress.data.JSDOSession=function(e){var t,r,s,o=this;function i(e,t,r,s){t?e.resolve(o,r,s):e.reject(o,r,s)}function a(e,t,r,s,o){i(s?s._deferred:o,t===progress.data.Session.SUCCESS,t,{errorObject:r,xhr:s})}function n(e,t,r,s){var o,a,n,d=!1;a=t===progress.data.Session.EXPIRED_TOKEN?progress.data.Session.EXPIRED_TOKEN:t===progress.data.Session.LOGIN_AUTHENTICATION_FAILURE?progress.data.Session.LOGIN_AUTHENTICATION_FAILURE:progress.data.Session.GENERAL_FAILURE,s&&s._deferred&&(o=s._deferred,t!==progress.data.Session.SUCCESS&&t!==progress.data.Session.CATALOG_ALREADY_LOADED&&(t=t||progress.data.Session.GENERAL_FAILURE,o._overallCatalogResult=progress.data.Session.GENERAL_FAILURE),o._results[s._catalogIndex]={catalogURI:s._catalogURI,result:t,errorObject:r,xhr:s},o._numCatalogsProcessed+=1,o._numCatalogsProcessed===o._numCatalogs&&(o._processedPromise=!0,o._overallCatalogResult||(d=!0,a=progress.data.Session.SUCCESS),n=a===progress.data.Session.SUCCESS?1===s._deferred._results.length?s._deferred._results[0]:{xhr:s,result:a,details:s._deferred._results}:1===s._deferred._results.length?s._deferred._results[0]:{xhr:s,result:a,errorObject:new Error(progress.data._getMsgText("jsdoMSG512")),details:s._deferred._results},i(s._deferred,d,a,n)))}function d(e){var t=e.xhr;t&&t._deferred&&i(t._deferred,e.pingResult,e.pingResult,{offlineReason:e.offlineReason,xhr:t})}if(Object.defineProperty(this,"authenticationModel",{get:function(){return t?t.authenticationModel:void 0},enumerable:!0}),Object.defineProperty(this,"authProvider",{get:function(){return t?t._authProvider:null},enumerable:!0}),Object.defineProperty(this,"catalogURIs",{get:function(){return t?t.catalogURIs:void 0},enumerable:!0}),Object.defineProperty(this,"clientContextId",{get:function(){return t?t.clientContextId:void 0},enumerable:!0}),Object.defineProperty(this,"connected",{get:function(){return t?t.connected:void 0},enumerable:!0}),Object.defineProperty(this,"JSDOs",{get:function(){return t?t.JSDOs:void 0},enumerable:!0}),Object.defineProperty(this,"loginResult",{get:function(){return t?t.loginResult:void 0},enumerable:!0}),Object.defineProperty(this,"loginHttpStatus",{get:function(){return t?t.loginHttpStatus:void 0},enumerable:!0}),Object.defineProperty(this,"onOpenRequest",{get:function(){return t?t.onOpenRequest:void 0},set:function(e){t&&(t.onOpenRequest=e)},enumerable:!0}),Object.defineProperty(this,"pingInterval",{get:function(){return t?t.pingInterval:void 0},set:function(e){t&&(t.pingInterval=e)},enumerable:!0}),Object.defineProperty(this,"services",{get:function(){return t?t.services:void 0},enumerable:!0}),Object.defineProperty(this,"serviceURI",{get:function(){return t&&t.serviceURI?t.serviceURI:r},enumerable:!0}),Object.defineProperty(this,"userName",{get:function(){return t?t.userName:void 0},enumerable:!0}),Object.defineProperty(this,"name",{get:function(){return s},enumerable:!0}),Object.defineProperty(this,"_isInvalidated",{get:function(){return t._isInvalidated},enumerable:!1}),this.login=function(e,r,s){var i=new progress.util.Deferred;try{if(this._isInvalidated)throw new Error(progress.data._getMsgText("jsdoMSG510","JSDOSession"));if(this.authenticationModel===progress.data.Session.AUTH_TYPE_SSO)throw new Error(progress.data._getMsgText("jsdoMSG057","JSDOSession","login()"));if("object"==typeof s&&s.iOSBasicAuthTimeout,t._authProvider)throw new Error(progress.data._getMsgText("jsdoMSG062","JSDOSession","login()"));t._authProvider=new progress.data.AuthenticationProvider({uri:this.serviceURI,authenticationModel:this.authenticationModel}),t._authProvider.logout().then(function(){return t._authProvider.login(e,r)}).then(function(){o.isAuthorized().then(function(e,t,r){e=progress.util.Deferred.getParamObject(e,t,r),i.resolve(o,e.result,e.info)},function(e,t,r){e=progress.util.Deferred.getParamObject(e,t,r),i.reject(o,e.result,e.info)})},function(e,t,r){e=progress.util.Deferred.getParamObject(e,t,r),i.reject(o,e.result,e.info)})}catch(e){if(progress.util.Deferred.useJQueryPromises)throw e;i.reject(this,progress.data.Session.GENERAL_FAILURE,{errorObject:e})}return i.promise()},this.disconnect=function(){var e,r=new progress.util.Deferred;try{t.subscribe("afterDisconnect",a,this),t._disconnect(r)}catch(t){e=new Error(progress.data._getMsgText("jsdoMSG049","JSDOSession","disconnect",t.message))}if(!e)return r.promise();if(progress.util.Deferred.useJQueryPromises)throw e;r.reject(this,progress.data.Session.GENERAL_FAILURE,{errorObject:e})},this.addCatalog=function(e,r,s,o){var i,a,d,h,l,c,f,u,_,g=new progress.util.Deferred;try{if(this._isInvalidated)throw new Error(progress.data._getMsgText("jsdoMSG510","JSDOSession"));if("string"==typeof e)i=[e];else{if(!(e instanceof Array))throw new Error(progress.data._getMsgText("jsdoMSG033","JSDOSession","addCatalog","The first argument must be a string or an array of strings specifying the URI of the catalog."));i=e}if(r)if("string"==typeof r){if(this.authenticationModel===progress.data.Session.AUTH_TYPE_SSO)throw new Error(progress.data._getMsgText("jsdoMSG058","Session"));f=r,o&&((u=o).authProvider=void 0)}else{if("object"!=typeof r)throw new Error(progress.data._getMsgText("jsdoMSG121","JSDOSession","2","object","addCatalog"));u=r}if("object"==typeof u&&(c=u.iOSBasicAuthTimeout,u.authProvider?_=u.authProvider:this.authProvider&&(_=this.authProvider)),!_&&!this.authProvider&&!f)throw new Error(progress.data._getMsgText("jsdoMSG511"));for(t.subscribe("afterAddCatalog",n,this),a=i.length,g._numCatalogs=a,g._numCatalogsProcessed=0,g._results=[],g._results.length=a,d=0;d<a;d+=1){l=void 0,h=void 0;try{h=t.addCatalog({catalogURI:i[d],async:!0,userName:f,password:s,deferred:g,catalogIndex:d,iOSBasicAuthTimeout:c,authProvider:_,offlineAddCatalog:!0})}catch(e){l=new Error("JSDOSession: Unable to send addCatalog request. "+e.message)}h!==progress.data.Session.ASYNC_PENDING&&(g._overallCatalogResult=progress.data.Session.GENERAL_FAILURE,l&&(h=progress.data.Session.GENERAL_FAILURE),g._results[d]={catalogURI:i[d],result:h,errorObject:l,xhr:void 0},g._numCatalogsProcessed+=1)}g._numCatalogsProcessed!==a||g._processedPromise||(g._overallCatalogResult===progress.data.Session.GENERAL_FAILURE?g.reject(this,progress.data.Session.GENERAL_FAILURE,g._results):g.resolve(this,progress.data.Session.SUCCESS,g._results))}catch(e){if(progress.util.Deferred.useJQueryPromises)throw e;g.reject(this,progress.data.Session.GENERAL_FAILURE,{errorObject:e})}return g.promise()},this.logout=function(){var e=new progress.util.Deferred,t=this.authProvider;try{if(this.authenticationModel===progress.data.Session.AUTH_TYPE_SSO)throw new Error(progress.data._getMsgText("jsdoMSG057","JSDOSession","logout()"));this.disconnect().then(function(){if(t)return t.logout();e.resolve(o,progress.data.Session.SUCCESS,{})}).then(function(t,r,s){t=progress.util.Deferred.getParamObject(t,r,s),e.resolve(o,t.result,t.info)},function(t,r,s){t=progress.util.Deferred.getParamObject(t,r,s),e.reject(o,t.result,t.info)})}catch(t){if(progress.util.Deferred.useJQueryPromises)throw t;e.reject(o,progress.data.Session.GENERAL_FAILURE,{errorObject:t})}return e.promise()},this.invalidate=function(){return t.invalidate(),this.logout()},this.ping=function(){var e=new progress.util.Deferred;try{if(this._isInvalidated)throw new Error(progress.data._getMsgText("jsdoMSG510","JSDOSession"));try{t.ping({async:!0,deferred:e,onCompleteFn:d})}catch(e){throw new Error("JSDOSession: Unable to send ping request. "+e.message)}}catch(t){if(progress.util.Deferred.useJQueryPromises)throw t;e.reject(this,progress.data.Session.GENERAL_FAILURE,{errorObject:t})}return e.promise()},this.isAuthorized=function(){var e,r=new progress.util.Deferred,s=new XMLHttpRequest,o=this;try{if(this._isInvalidated)throw new Error(progress.data._getMsgText("jsdoMSG510","JSDOSession"));this.loginResult===progress.data.Session.LOGIN_SUCCESS||this.authProvider?t._openRequest(s,"GET",t.loginTarget,!0,function(){s.onreadystatechange=function(){var e,s;4===this.readyState&&(s={xhr:this,offlineReason:void 0,fireEventIfOfflineChange:!0,usingOepingFormat:!1},t._processPingResult(s),this.status>=200&&this.status<300?r.resolve(o,progress.data.Session.SUCCESS,s):(e=401===this.status?progress.data.AuthenticationProvider._getAuthFailureReason(this):progress.data.Session.GENERAL_FAILURE,r.reject(o,e,s)))};try{s.send()}catch(e){throw new Error("JSDOSession: Unable to validate authorization. "+e.message)}}):(e=progress.data.Session.LOGIN_AUTHENTICATION_REQUIRED,r.reject(o,e,{xhr:s}))}catch(e){if(progress.util.Deferred.useJQueryPromises)throw e;r.reject(o,progress.data.Session.GENERAL_FAILURE,{errorObject:e})}return r.promise()},this.setContext=function(e){t._contextProperties.setContext(e)},this.setContextProperty=function(e,r){t._contextProperties.setContextProperty(e,r)},this.getContext=function(){return t._contextProperties.getContext()},this.getContextProperty=function(e){return t._contextProperties.getContextProperty(e)},this._onlineHandler=function(e,t){o.trigger("online",o,t)},this._offlineHandler=function(e,t,r){o.trigger("offline",o,t,r)},!(arguments.length>0&&"object"==typeof arguments[0]))throw new Error(progress.data._getMsgText("jsdoMSG033","JSDOSession","the constructor","The options argument was missing or invalid."));if(!e.serviceURI||"string"!=typeof e.serviceURI)throw new Error(progress.data._getMsgText("jsdoMSG033","JSDOSession","the constructor","The options parameter must include a 'serviceURI' property that is a string."));if(r=e.serviceURI,e.authenticationModel){if("string"!=typeof e.authenticationModel)throw new Error(progress.data._getMsgText("jsdoMSG033","JSDOSession","the constructor","The authenticationModel property of the options parameter must be a string."));e.authenticationModel=e.authenticationModel.toLowerCase()}else e.authenticationModel=progress.data.Session.AUTH_TYPE_ANON;if(e.authProvider){if("object"!=typeof e.authProvider)throw new Error(progress.data._getMsgText("jsdoMSG502","JSDOSession","options","constructor","authProvider"));if(e.authProvider.authenticationModel!==progress.data.Session.AUTH_TYPE_FORM_SSO&&e.authProvider.authenticationModel!==e.authenticationModel||e.authProvider.authenticationModel===progress.data.Session.AUTH_TYPE_FORM_SSO&&e.authenticationModel!==progress.data.Session.AUTH_TYPE_SSO)throw new Error(progress.data._getMsgText("jsdoMSG059","JSDOSession",e.authProvider.authenticationModel,e.authenticationModel));if("function"!=typeof e.authProvider.hasClientCredentials)throw new Error(progress.data._getMsgText("jsdoMSG505","JSDOSession","AuthenticationProvider","hasClientCredentials"));if(!e.authProvider.hasClientCredentials())throw new Error(progress.data._getMsgText("jsdoMSG125","JSDOSession"))}else if(e.authenticationModel===progress.data.Session.AUTH_TYPE_SSO)throw new Error(progress.data._getMsgText("jsdoMSG508"));s=e.name,t=new progress.data.Session({_storageKey:s,_silent:!0,authenticationModel:e.authenticationModel,serviceURI:e.serviceURI,jsdosession:this,authProvider:e.authProvider});try{e.context&&this.setContext(e.context),t.subscribe("online",this._onlineHandler,this),t.subscribe("offline",this._offlineHandler,this)}catch(e){throw t=void 0,e}},progress.data.JSDOSession.prototype=new progress.util.Observable,progress.data.JSDOSession.prototype.constructor=progress.data.JSDOSession,progress.data.JSDOSession.prototype._eventNames=["offline","online"],progress.data.JSDOSession.prototype.validateSubscribe=function(e,t,r){r.operation=void 0;var s=!1;if(this._eventNames.forEach(function(e){t===e.toLowerCase()&&(s=!0)}),!s)throw new Error(progress.data._getMsgText("jsdoMSG042",t));if(e.length<2)throw new Error(progress.data._getMsgText("jsdoMSG038",2));if("string"!=typeof e[0])throw new Error(progress.data._getMsgText("jsdoMSG039"));if("function"!=typeof e[1])throw new Error(progress.data._getMsgText("jsdoMSG040"));if(r.fn=e[1],e.length>2){if("object"!=typeof e[2])throw new Error(progress.data._getMsgText("jsdoMSG041",t));r.scope=e[2]}},progress.data.JSDOSession.prototype.toString=function(e){return"progress.data.JSDOSession"},progress.data.getSession=function(e){var t,r=new progress.util.Deferred,s={};function o(e,s,o){if(e=progress.util.Deferred.getParamObject(e,s,o),t&&t.hasClientCredentials()){var i=function(){r.reject(e.result,e.info)};t.logout().then(i,i)}else r.reject(e.result,e.info)}function i(e){r.reject(progress.data.Session.GENERAL_FAILURE,{reason:e})}function a(t){var s;try{s=new progress.data.JSDOSession(e);try{s.isAuthorized().then(function(){return s.addCatalog(e.catalogURI)},o).then(function(e,t,s){e=progress.util.Deferred.getParamObject(e,t,s),r.resolve(e.jsdosession,progress.data.Session.SUCCESS)},o)}catch(e){o(s,progress.data.Session.GENERAL_FAILURE,{errorObject:e})}}catch(e){o(s,progress.data.Session.GENERAL_FAILURE,{errorObject:e})}}if("object"!=typeof e)throw new Error(progress.data._getMsgText("jsdoMSG503","getSession()","options","object"));if(void 0!==e.loginCallback&&"function"!=typeof e.loginCallback)throw new Error(progress.data._getMsgText("jsdoMSG503","getSession()","options.loginCallback","function"));try{if(!(e.authenticationModel!==progress.data.Session.AUTH_TYPE_SSO||e.authenticationURI&&e.authProviderAuthenticationModel))throw new Error(progress.data._getMsgText("jsdoMSG509"));if(e.authenticationURI){if(s.uri=e.authenticationURI,s.authenticationModel=e.authProviderAuthenticationModel,"string"!=typeof s.authenticationModel)throw new Error(progress.data._getMsgText("jsdoMSG502","progress.data.getSession","object","getSession","authProviderAuthenticationModel"))}else s.uri=e.serviceURI,s.authenticationModel=e.authenticationModel;t=new progress.data.AuthenticationProvider(s),e.authProvider=t,t.hasClientCredentials()?a():t.authenticationModel===progress.data.Session.AUTH_TYPE_ANON?t.login().then(a,o):function(t){var r;if(void 0!==e.loginCallback)e.loginCallback().then(function(e){try{t.login(e.username,e.password).then(a,o)}catch(e){o(t,progress.data.Session.GENERAL_FAILURE,{errorObject:e})}},i);else if(e.username&&e.password)try{t.login(e.username,e.password).then(a,o)}catch(e){o(t,progress.data.Session.GENERAL_FAILURE,{errorObject:e})}else r=new Error(progress.data._getMsgText("jsdoMSG052","getSession()")),o(t,progress.data.Session.AUTHENTICATION_FAILURE,{errorObject:r})}(t)}catch(e){o(null,progress.data.Session.GENERAL_FAILURE,{errorObject:e})}return r.promise()},progress.data.invalidateAllSessions=function(){var e,t,r=new progress.util.Deferred,s=progress.data.ServicesManager._jsdosessions,o=[];try{for(t in s)s.hasOwnProperty(t)&&(e=s[t],o.push(e.invalidate()));progress.util.Deferred.when(o).then(function(){r.resolve(progress.data.Session.SUCCESS)},function(e,t,s){e=progress.util.Deferred.getParamObject(e,t,s),r.reject(progress.data.Session.GENERAL_FAILURE,s)})}catch(e){if(progress.util.Deferred.useJQueryPromises)throw e;r.reject(progress.data.Session.GENERAL_FAILURE,{errorObject:e})}return r.promise()}}(),"undefined"!=typeof exports&&(exports.progress=progress),"undefined"!=typeof kendo&&function(){var e,t,r=new kendo.Observable;e=kendo.data.readers.json.extend({init:function(e){var t,s={};r.trigger("info",s),t=this.transport=s.sender._events.info.transport,kendo.data.readers.json.fn.init.call(this,e),this.model=kendo.data.Model.define({init:function(e){var r;e&&!jQuery.isEmptyObject(e)||(e=t._getInitialValues()),r=t._convertDataTypes(e),t.jsdo._deleteProdsProperties(r,!0),kendo.data.Model.fn.init.call(this,r)},id:"_id",fields:t._getModel()})},total:function(e){return e.total||(e.data?e.data.length:e.length)},data:function(e){return e.data||e}}),t=kendo.data.RemoteTransport.extend({init:function(e){var t,s=this;if(void 0!==e.tableRef&&(s.tableRef=e.tableRef),s.jsdo=function(e,t){var r,s;if(t.jsdo instanceof progress.data.JSDO)r=t.jsdo;else{if("string"!=typeof t.jsdo)throw new Error("JSDO: jsdo property must be either a JSDO instance or a string.");s=t.jsdo,r=new progress.data.JSDO({name:s})}if(void 0===e.tableRef&&r._defaultTableRef&&(e.tableRef=r._defaultTableRef._name),void 0===e.tableRef)throw new Error("JSDO: A tableRef must be specified when using a multi-table DataSet.");if(void 0===r[e.tableRef])throw new Error("JSDO: tableRef '"+e.tableRef+"' is not present in JSDO definition.");return r}(s,e),s._initFromServer=!1,s.autoSave=void 0===e.autoSave||e.autoSave,s.readLocal=void 0!==e.readLocal&&e.readLocal,s.countFnName=e.countFnName,s.useArrays=void 0!==e.useArrays&&e.useArrays,void 0!==s.countFnName){if("function"!=typeof s.jsdo[s.countFnName])throw new Error("Invoke operation '"+s.countFnName+"' for countFnName is not defined.")}else if(void 0!==s.jsdo._resource.generic.count)for(t in s.jsdo._resource.fn)if(s.jsdo._resource.fn.hasOwnProperty(t)&&s.jsdo._resource.generic.count===s.jsdo._resource.fn[t].function){s.countFnName=t;break}r.one("info",function(e){e.sender._events.info.transport=s}),s._initConvertTypes(),kendo.data.RemoteTransport.fn.init.call(this,e)},_initConvertTypes:function(){var e,t,r,s=[],o=[],i=!1;for(this._convertTypes=!1,t=this.jsdo[this.tableRef].getSchema(),e=0;e<t.length;e+=1)(r=t[e].name).length>0&&"_"!==r.charAt(0)&&("string"===t[e].type&&t[e].format&&-1!==t[e].format.indexOf("date")?(s.push(r),i||(i=!0)):this.useArrays||"array"!==t[e].type||(o.push(r),!i&&t[e].ablType&&0===t[e].ablType.indexOf("DATE")&&(i=!0)));(s.length>0||o.length>0)&&(this._convertTypes=!0,this._convertFields={},this._convertFields._arrayFields=[],this._convertFields._dateFields=[]),s.length>0&&(this._convertFields._dateFields=s),i&&(this._convertFields._datePattern=new RegExp("^([0-9]+)?-([0-9]{2})?-([0-9]{2})?$"),this._convertFields._dateTimePattern=new RegExp("^([0-9]+)?-([0-9]{2})?-([0-9]{2})?T([0-9]{2})?:([0-9]{2})?:([0-9]{2})?.([0-9]{3})?$")),o.length>0&&(this._convertFields._arrayFields=o)},_convertStringToDate:function(e,t,r){var s,o;if(r||(r=t),(s=this._convertFields._datePattern.exec(e[r])||[]).length>0)e[r]=new Date(parseInt(s[1],10),parseInt(s[2],10)-1,parseInt(s[3],10));else if("DATETIME"===this.jsdo[this.tableRef]._fields[t.toLowerCase()].ablType&&(s=this._convertFields._dateTimePattern.exec(e[r])||[]).length>0&&(e[r]=new Date(parseInt(s[1],10),parseInt(s[2],10)-1,parseInt(s[3],10),parseInt(s[4],10),parseInt(s[5],10),parseInt(s[6],10),parseInt(s[7],10))),"string"==typeof e[r]){o=e[r];try{e[r]=new Date(e[r])}catch(t){e[r]=o,console.log(progress.data._getMsgText("jsdoMSG000","_convertStringToDate() could not convert to date object: "+o))}}},_convertDataTypes:function(e){var t,r,s,o,i,a,n;if(!this.useArrays&&this._convertTypes&&this._convertFields._arrayFields.length>0&&(n={},this.jsdo._copyRecord(this.jsdo._buffers[this.tableRef],e,n),e=n),!this._convertTypes)return e;for(r=0;r<this._convertFields._arrayFields.length;r+=1)if(e[s=this._convertFields._arrayFields[r]]){for(o=this.jsdo[this.tableRef]._fields[s.toLowerCase()],i=this.jsdo._getArrayField(s),t=0;t<o.maxItems;t+=1)a=i.name+(t+1),this.jsdo[this.tableRef]._fields[a.toLowerCase()]||(e[a]=e[s][t],o.ablType&&0===o.ablType.indexOf("DATE")&&"string"==typeof e[a]&&this._convertStringToDate(e,s,a));this.useArrays||delete e[s]}for(r=0;r<this._convertFields._dateFields.length;r+=1)"string"==typeof e[s=this._convertFields._dateFields[r]]&&this._convertStringToDate(e,s);return e},_getModel:function(){var e,t,r,s,o,i,a={};for(r=this.jsdo[this.tableRef].getSchema(),e=0;e<r.length;e+=1)if(r[e].name.length>0&&"_"!==r[e].name.charAt(0))if("integer"===(o=r[e].type)?o="number":"string"===o&&r[e].format&&-1!==r[e].format.indexOf("date")&&(o="date"),"array"===o)for(t=0;t<r[e].maxItems;t+=1)s=this.jsdo._getDefaultValue(r[e]),i=this.jsdo._getArrayField(r[e].name,t),this.jsdo[this.tableRef]._fields[i.name.toLowerCase()]||("integer"===(o=r[e].items.type)?o="number":"string"===o&&r[e].ablType&&-1!==r[e].ablType.indexOf("DATE")&&(o="date"),a[i.name]={},a[i.name].type=o,void 0!==s&&(a[i.name].defaultValue=s));else s=this.jsdo._getDefaultValue(r[e]),a[r[e].name]={},a[r[e].name].type=o,void 0!==s&&(a[r[e].name].defaultValue=s);return a},_getInitialValues:function(){var e,t,r,s,o={};for(r=this.jsdo[this.tableRef].getSchema(),e=0;e<r.length;e+=1)if(r[e].name.length>0&&"_"!==r[e].name.charAt(0))if(s=this.jsdo._getDefaultValue(r[e]),"array"===r[e].type)for(o[r[e].name]=[],t=0;t<r[e].maxItems;t+=1)o[r[e].name][t]=s;else o[r[e].name]=s;return o},_getData:function(e){var t,r,s=this.jsdo,o={};return e&&e.data?(t={tableRef:this.tableRef,filter:e.data.filter,sort:e.data.sort,skip:e.data.skip,top:e.data.take},r=s[this.tableRef].getData({filter:void 0}),o.total=r.length,r=s[this.tableRef].getData(t),o.data=r):(r=s[this.tableRef].getData(),o.data=r,o.total=r.length),o},read:function(e){try{var t,r,s,o,i=this.jsdo,a={},n=this,d={filter:"filter",take:"top",skip:"skip",sort:"sort"};if(this._initFromServer||(i[this.tableRef]._parent?this._initFromServer=i[i[this.tableRef]._parent]._data&&i[i[this.tableRef]._parent]._data.length>0||i[this.tableRef]._data instanceof Array&&i[this.tableRef]._data.length>0:this._initFromServer=i[this.tableRef]._data instanceof Array&&i[this.tableRef]._data.length>0),a.data=[],this.readLocal&&this._initFromServer)return o=i.useRelationships,i.useRelationships=!1,a=this._getData(e),i.useRelationships=o,void e.success(a);if(!this.readLocal&&e.data){for(s in e.data)e.data.hasOwnProperty(s)&&void 0!==e.data[s]&&d[s]&&(void 0===t&&(t={}),t[d[s]]=e.data[s]);t&&(t.tableRef=this.tableRef)}r=function(t,r,s){var o,i,a,d,h={};if(d=(t=progress.util.Deferred.getParamObject(t,r,s)).jsdo,r=t.success,s=t.request,r)if(o=d.useRelationships,d.useRelationships=!1,n.readLocal?h=n._getData(e):(h.data=d[n.tableRef].getData(),(i=d.getProperty("server.count"))&&(h.total=i)),d.useRelationships=o,n._initFromServer=!0,e.data&&e.data.take)if(n.readLocal||void 0===n.countFnName||"function"!=typeof d[n.countFnName])e.success(h);else{if(0===e.data.skip&&e.data.take>h.data.length)return void e.success(h);d.invoke(n.countFnName,{filter:s.objParam.filter}).then(function(t,r,s){var o,i;(t=progress.util.Deferred.getParamObject(t,r,s)).jsdo,r=t.success,s=t.request;try{"object"==typeof s.response&&1===Object.keys(s.response).length&&"number"!=typeof(i=s.response[Object.keys(s.response)])&&(i=void 0)}catch(e){}void 0!==i?(i&&(h.total=i),e.success(h)):(o=new Error("Unexpected response from '"+n.countFnName+"' operation."),e.error(s.xhr,s.xhr.status,o))},function(t,r,s){var o;(t=progress.util.Deferred.getParamObject(t,r,s)).jsdo,r=t.success,s=t.request,o=new Error("Error invoking '"+n.countFnName+"' operation."),e.error(s.xhr,s.xhr.status,o)})}else e.success(h);else a=new Error("Error while reading records."),e.error(s.xhr,s.xhr.status,a)},i.fill(t).then(r,r)}catch(t){e.error(null,null,t)}},_processChanges:function(e,t){var r,s,o,i,a,n=this.jsdo;if(e.batch){if(r=[],e.data.created instanceof Array)for(s=0;s<e.data.created.length;s+=1)if(o=n[this.tableRef].findById(e.data.created[s]._id))a=this._convertDataTypes(o.data),r.push(a);else if(n.autoApplyChanges)return void e.error(null,null,new Error("Created record was not found in memory."));if(e.success(r,"create"),r=[],e.data.updated instanceof Array)for(s=0;s<e.data.updated.length;s+=1)if(o=n[this.tableRef].findById(e.data.updated[s]._id))a=this._convertDataTypes(o.data),r.push(a);else if(n.autoApplyChanges)return void e.error(null,null,new Error("Updated record not found in memory."));if(e.success(r,"update"),r=[],e.data.destroyed instanceof Array)for(s=0;s<e.data.destroyed.length;s+=1)if((o=n[this.tableRef].findById(e.data.destroyed[s]._id))&&n.autoApplyChanges)return void e.error(null,null,new Error("Deleted record was found in memory."));e.success(r,"destroy")}else n._resource.idProperty?t&&t.batch&&t.batch.operations instanceof Array&&1===t.batch.operations.length&&(i=t.batch.operations[0].jsrecord.data._id):i=e.data._id,(o=n[this.tableRef].findById(i))?(a=this._convertDataTypes(o.data),e.success(a)):e.success({})},_saveChanges:function(e){var t=this,r=function(r,s,o){var i,a,n;(r=progress.util.Deferred.getParamObject(r,s,o)).jsdo,s=r.success,o=r.request,s?t._processChanges(e,o):(o.batch&&o.batch.operations instanceof Array&&1===o.batch.operations.length?(i=o.batch.operations[0].xhr,a=o.batch.operations[0].xhr.status):o.jsrecords&&(i=o.xhr,a=o.xhr.status),n=new Error("Error while saving changes."),e.error(i,a,n))};this.autoSave?this.jsdo.saveChanges(this.jsdo._hasSubmitOperation).then(r,r):this._processChanges(e)},create:function(e){var t,r=this.jsdo,s=r.useRelationships;e.batch=e.data.models instanceof Array;try{r.useRelationships=!1,e.batch?e.error(null,null,new Error("A newer version of Kendo UI is expected for batching support.")):(t=r[this.tableRef].add(e.data),e.data._id=t.data._id,this._saveChanges(e))}catch(t){r.autoApplyChanges&&r[this.tableRef].rejectChanges(),e.error(null,null,t)}finally{r.useRelationships=s}},update:function(e){var t=this.jsdo,r=t.useRelationships;e.batch=e.data.models instanceof Array;try{t.useRelationships=!1,e.batch?e.error(null,null,new Error("A newer version of Kendo UI is expected for batching support.")):(t[this.tableRef].findById(e.data._id).assign(e.data),this._saveChanges(e))}catch(r){t.autoApplyChanges&&t[this.tableRef].rejectChanges(),e.error(null,null,r)}finally{t.useRelationships=r}},destroy:function(e){var t=this.jsdo,r=t.useRelationships;e.batch=e.data.models instanceof Array;try{t.useRelationships=!1,e.data.models instanceof Array?e.error(null,null,new Error("A newer version of Kendo UI is expected for batching support.")):(t[this.tableRef].findById(e.data._id).remove(),this._saveChanges(e))}catch(r){t.autoApplyChanges&&t[this.tableRef].rejectChanges(),e.error(null,null,r)}finally{t.useRelationships=r}},submit:function(e){var t,r,s=this.jsdo,o=s.useRelationships;e.batch=!0;try{if(s.useRelationships=!1,e.data.created instanceof Array)for(t=0;t<e.data.created.length;t+=1)r=s[this.tableRef].add(e.data.created[t]),e.data.created[t]._id=r.data._id;if(e.data.updated instanceof Array)for(t=0;t<e.data.updated.length;t+=1)(r=s[this.tableRef].findById(e.data.updated[t]._id))?r.assign(e.data.updated[t]):e.error(null,null,new Error("Record not found in memory."));if(e.data.destroyed instanceof Array)for(t=0;t<e.data.destroyed.length;t+=1)(r=s[this.tableRef].findById(e.data.destroyed[t]._id))?r.remove():e.error(null,null,new Error("Record not found in memory."));this._saveChanges(e)}catch(t){s.autoApplyChanges&&s[this.tableRef].rejectChanges(),e.error(null,null,t)}finally{s.useRelationships=o}}}),jQuery.extend(!0,kendo.data,{schemas:{jsdo:{type:"jsdo",model:{id:"_id"}}},transports:{jsdo:t},readers:{jsdo:e}})}();